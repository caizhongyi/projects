<!-- Content Header (Page header) -->
<section class="content-header" >
    <h1>
        {{ $state.current.page.title }}
        <small></small>
    </h1>
    <ol class="breadcrumb">
        <li ui-sref-active="active"><a href="#" ui-sref="mbs-index-home"><i class="fa fa-dashboard"></i>首页</a>
        </li>
        <li class="active">  {{ $state.current.page.title }} </li>
    </ol>
</section>

<!-- Main content -->
<section class="content slide" >
    <div class="box" senior-table="shorturl" added-reload="false">
        <div class="box-header ">
            <h3 class="box-title" >
                <button class="btn btn-primary modv2-btn" type="button" ng-click="urladd()">添加一条</button>
                <br/>
                <br/>
            </h3>
            <div class="form form-inline form-alignment" >

                <div>
                    <div class="form-group form-group-alignment">
                        <label>提交账号</label>
                        <input type="text" placeholder="提交账号" ng-change="searchChange()" ng-model="searchCondition.submit_account" class="form-control" >
                    </div>

                    <div class="form-group">
                        <label>应用:</label>
                        <select type="text" ng-model="searchCondition.app" class="form-control">
                            <option value="" class="">全部</option>
                            <option ng-repeat="app_code in appcodeList" ng-selected="searchCondition.app == app_code.id" value="{{app_code.id}}">{{app_code.account}}</option>
                        </select>
                    </div>

                    <div class="form-group form-group-alignment">
                        <label>提交日期</label>
                          <span class="input-group datepicker modv2-sel-warap" datepicker-click="startdOpened">
                                <input type="hidden"  ng-model="searchCondition.start_date" />
                                <input placeholder="日/月" type="datetime"  name="start_date"  required ng-model="start_date" sync="searchCondition.start_date"
                                       class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="startdOpened"
                                       datepicker-options="dateOptions"  ng-required="true"  current-text="今天" clear-text="清空" close-text="关闭"  readonly />
                            </span>
                    </div>
                    <div class="form-group form-group-alignment">
                        <label>至</label>
                        <span class="input-group datepicker modv2-sel-warap" datepicker-click="endOpened">
                             <input type="hidden"  ng-model="searchCondition.end_date"/>
                             <input placeholder="日/月" type="datetime"  name="end_date"  required ng-model="end_date" sync="searchCondition.end_date"
                                    class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="endOpened"
                                    datepicker-options="dateOptions"  ng-required="true"  min-date="start_date" current-text="今天" clear-text="清空" close-text="关闭"  readonly />

                        </span>
                    </div>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <div class="form-group modv2-formg">
                        <button class="btn btn-default" ng-click="searchInfo()"  type="button" ><i class="fa fa-search"></i> 搜索</button>
                    </div>

                </div>

            </div>

        </div><!-- /.box-header -->
        <div class="box-body no-padding">
            <table class="table table-hover" >
                <tbody>
                <tr>
                    <th width="5%">序号</th>
                    <th width="5%">应用</th>
                    <th width="5%">提交账号</th>
                    <th width="10%">提交日期</th>
                    <th width="20%">原网址</th>
                    <th width="10%">短网址</th>
                    <th width="5%">访问次数</th>
                    <th width="5%">状态</th>
                    <th width="5%">操作</th>
                </tr>
                <tr ng-repeat="item in list" class="list-animation">
                    <td>{{item.id}}</td>
                    <td>{{item.app_name}}</td>
                    <td>{{item.submit_account}}</td>
                    <td>{{item.create_time * 1000 |  date:"yyyy-MM-dd HH:mm:ss"}}</td>
                    <td>{{item.long_url}}</td>
                    <td>{{item.short_url}}</td>
                    <td>{{item.visit_number}}</td>
                    <td>{{item.status}}</td>

                    <td>
                        <div class="btn-group">
                            <div class="btn-group" dropdown is-open="status.isopen">
                                <button type="button" class="btn btn-primary dropdown-toggle" dropdown-toggle ng-disabled="disabled">
                                    操作 <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="javascript:;" ng-click="update($index)"><i class="fa fa-edit"></i> 修改</a></li>
                                    <li><a href="javascript:;" ng-click="finish($index)"><i class="fa fa-edit"></i> 屏蔽</a></li>
                                </ul>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div><!-- /.box-body -->
        <div class="box-footer clearfix ">
            <pagination num-pages="numPages"  boundary-links="true" max-size="maxSize"   ng-change="pageChanged()" total-items="totalItems" ng-model="currentPage" class="pagination pull-right no-margin" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
            <div class="pull-right ng-binding modv2-pageinfo">
                <span class="modv2-pagecur"> {{currentPage}} </span> / {{numPages}} 页 | 共 {{ totalItems }} 条
            </div>
        </div>
    </div>
</section>
<!-- /.content -->
<script type="text/ng-template" id="tpl-update.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate >
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <!-- <h3 class="modal-title">修改</h3>-->
        </div>
        <div class="modal-body">
            <div class="box-body">

                <div class="form-group">

                    <label for="long_url"><span class="text-danger">*</span> 原网址：</label>
                    <input type="text" placeholder="原网址" id="update-long_url" class="form-control" name="long_url" ng-model="item.long_url" value="{{ item.long_url }}"    required=""  >
                    <div class="has-feedback text-danger" ng-messages="addForm.long_url.$error" ng-show="interacted(addForm.long_url)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i> 原网址必须！</div>
                    </div>
                </div>


                <div class="form-group">
                    <label for="short_url"><span class="text-danger">*</span> 短网址：</label>
                    <input type="text" placeholder="短网址" id="update-short_url" class="form-control" name="short_url" ng-model="item.short_url" value="{{ item.short_url }}"  required=""  ng-readonly="true">
                    <div class="has-feedback text-danger" ng-messages="addForm.short_url.$error" ng-show="interacted(addForm.short_url)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i> 短网址必须！</div>
                    </div>
                </div>

                <div class="form-group">

                    <label for="long_url"><span class="text-danger">*</span> 应用：</label>
                    <input type="text" placeholder="应用" id="update-app_name" class="form-control" name="app_name" ng-model="item.app_name" value="{{ item.app_name }}"    required="" ng-readonly="true" >
                    <div class="has-feedback text-danger" ng-messages="addForm.app_name.$error" ng-show="interacted(addForm.app_name)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i> 应用必须！</div>
                    </div>
                </div>


            </div><!-- /.box-body -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" ng-click="update()" >保存</button>
            <button class="btn btn-primary modv2-btn"  ng-click="cancel()" type="button" >取消</button>
        </div>
    </form>
</script>
<script type="text/ng-template" id="tpl-urladd.html">
    <form role="form" name="addurlForm" ng-submit="submitAddForm(addurlForm.$valid)" novalidate >
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
                <h3 class="modal-title">新增</h3>
        </div>
        <div class="modal-body">
            <div class="box-body">

                <div class="form-group">

                    <label for="long_url"><span class="text-danger">*</span> 原网址：</label>
                    <input type="text" placeholder="原网址" id="long_url" class="form-control" name="long_url" ng-model="item.long_url" value=""    required="" >
                    <div class="has-feedback text-danger" ng-messages="addurlForm.long_url.$error" ng-show="interacted(addurlForm.long_url)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i> 原网址必须！</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>应用:</label>
                    <select type="text" id="app"   name="app"  ng-model="item.app" class="form-control">
                        <option ng-repeat="app_code in appcodeList" ng-selected="searchCondition.app == app_code.id" value="{{app_code.id}}">{{app_code.account}}</option>
                    </select>
                </div>

            </div><!-- /.box-body -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" ng-click="urladd()" >保存</button>
            <button class="btn btn-primary modv2-btn"  ng-click="cancel()" type="button" >取消</button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="tpl-message.html">
    <form role="form" name="messageForm" ng-submit="submitMessageForm(messageForm.$valid)" >
        <div class="modal-header">
            <!-- <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>-->
            <h3 class="modal-title">地址重复提醒</h3>
        </div>
        <div class="modal-body">
            <form role="form">
                <div class="box-body">
                    <div class="box-body">
                        <div class="form-group">
                            长地址 <strong class="text-success">{{ item.long_url }}</strong>  已建立过
                        </div>
                    </div><!-- /.box-body -->
                </div><!-- /.box-body -->
            </form>
        </div>

    </form>

</script>

<script type="text/ng-template" id="tpl-success.html">
    <form role="form" name="messageForm" >
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">长短地址生成成功</h3>
        </div>

        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" ng-click="cancel()"  type="button">回到列表</button>
        </div>
    </form>

</script>

<script type="text/ng-template" id="tpl-finish.html">
    <form role="form" name="noticeForm" >
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">地址屏蔽提醒</h3>
        </div>
        <div class="modal-body">
            <form role="form">
                <div class="box-body">
                    <div class="box-body">
                        <div class="form-group">
                            <span ng-if="!res.code" style="color:red;">地址屏蔽成功！</span>
                            <span ng-if="res.code" style="color:red;">{{ res.msg }}</span>
                        </div>
                    </div><!-- /.box-body -->
                </div><!-- /.box-body -->
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" ng-click="cancel()" type="button" >我知道了</button>
        </div>
    </form>
</script>
