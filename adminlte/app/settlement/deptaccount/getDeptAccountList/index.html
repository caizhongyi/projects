<!-- Content Header (Page header) -->
<section class="content-header" >
    <h1>
        {{ $state.current.page.title }}
        <small></small>
    </h1>
    <ol class="breadcrumb">
        <li ui-sref-active="active"><a href="#" ui-sref="mbs-index-home"><i class="fa fa-dashboard"></i>首页</a>
        </li>
        <li class="active">  {{ $state.current.page.title }} </li>
    </ol>
</section>
<!-- Main content -->
<section class="content slide" >
    <div class="box"  senior-table="deptAccount" >
        <div class="box-header ">

            <div class="form form-inline form-alignment">
                <div class="form-group" select-store="" ng-show="utils.hasRoleCode('cfb.caiwu.manage,cfb.caiwu.recheck,cfb.caiwu.pay')">
                    <div class="form-group modv2-formg">
                        <label class="form-label" >门店名称</label>
                        <select id="province" class="form-control province" name="province" ng-model="searchCondition.province"  ng-options="item.id as item.name  for item in province "  >
                            <option value="">省份</option>
                        </select>
                    </div>
                    <div class="form-group modv2-formg">
                        <select id="city" class="form-control city" name="city" ng-model="searchCondition.city"  ng-options="item.id as  item.name for item in city "  >
                            <option value="">市/区</option>
                        </select>
                    </div>
                    <div class="form-group modv2-formg">
                        <select id="shop" class="form-control shop" name="shop" ng-model="searchCondition.dept_id"  ng-options="item.id as  item.name for item in shop" >
                            <option value="">门店</option>
                        </select>
                    </div>
                </div>
                <div class="form-group"  ng-show="utils.hasRoleCode('cfb.caiwu.manage,cfb.caiwu.recheck,cfb.caiwu.pay')">
                    <div class="form-group">
                        <label class="form-label" >收款行</label>
                        <select  id="pos_receiving_bank" class="form-control input-control" name="bank" ng-model="searchCondition.pos_receiving_bank" select-bank>
                            <option value="">请选择</option>
                        </select>
                    </div>
                    <div class="form-group modv2-formg">
                        <label class="form-label" >状态</label>
                        <select class="form-control input-control" name="status"  ng-model="searchCondition.status"   select-fee-status="" >
                            <option value="">请选择</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="" >&nbsp;</label>
                        <button class="btn btn-default" ng-click="searchInfo()"><i class="fa fa-search"></i> 搜索</button>
                        <button class="btn btn-primary modv2-btn" type="button" ng-show="utils.hasCode('settlement|deptaccount|adddeptaccount')" ng-click="goToAdd()"> 开通</button>
                    </div>
                </div>
            </div>

        </div><!-- /.box-header -->
        <div class="box-body no-padding">
            <table class="table table-hover" >
                <tbody>
                <tr>
                    <th >城市</th>
                    <th >门店名称</th>
                    <th >联系人</th>
                    <!--<th >收款账号</th>-->
                    <th ng-if="utils.hasRoleCode('cfb.caiwu,cfb.caiwu.manage')">收款行</th>
                    <th >收款公司</th>
                    <th width="150" class="text-right">预存款余额( 元 )</th>
                    <th width="100">状态</th>
                    <th width="130">操作</th>
                </tr>
                <tr ng-repeat="item in list" class="list-animation">
                    <td class="text-center" >
                        {{ item.province_name }} <br/>  {{ item.city_name }}
                    </td>
                    <td class="text-center" >
                        {{ item.dept_name }}
                    </td>
                    <td class="text-center" >
                        {{ item.linkman }}
                    </td>
                    <!--<td class="text-center">-->
                        <!--{{ item.account_name }}-->
                    <!--</td>-->
                    <td class="text-center" ng-if="utils.hasRoleCode('cfb.caiwu,cfb.caiwu.manage')">
                        {{ item.pos_receiving_bank }}
                    </td>
                    <td class="text-center" >
                        {{ item.company_name }}
                    </td>
                    <td class="text-right">
                        {{ item.balance }}
                    </td>
                    <td class="text-center" >
                        {{ item.status }}
                    </td>
                    <td class="text-center" >
                        <!--<a href="javascript:;"  class="modv2-link " style="color: #ff8a42" ng-show="utils.hasCode('settlement|order|createdeptaccount')" data-ng-click="noticeTransfer()">通知转账收款</a>-->
                        <a href="javascript:;" class="modv2-link" ng-if="item.status=='暂停'" ng-show="utils.hasCode('settlement|deptaccount|setdeptaccountstatus')" ng-click="statusOpen()">恢复</a>
                        <a href="javascript:;" class="modv2-link" ng-if="item.status=='正常'" ng-show="utils.hasCode('settlement|deptaccount|setdeptaccountstatus')" ng-click="statusStop()">停用</a>
                        <a href="javascript:;" class="modv2-link" ng-show="utils.hasCode('settlement|deptaccount|updatedeptaccount')" ng-click="goToEdit()">编辑</a>
                        <a href="javascript:;" class="modv2-link" ng-show="utils.hasCode('settlement|deptaccountdepositapply|adddeptaccountdepositapply')" ng-click="open()">存款</a>
                        <a href="javascript:;" class="modv2-link" ng-show="utils.hasCode('settlement|deptaccountrefundapply|adddeptaccountrefundapply')" ng-click="refund()">退款</a>
						<a href="javascript:;" class="modv2-link" ng-show="utils.hasCode('settlement|deptaccount|getdeptaccountdetail')" ng-click="reportDetail()">刷卡手续费明细</a>
                    </td>
                </tr>
                </tbody>
            </table>

        </div><!-- /.box-body -->
        <div class="box-footer clearfix ">
            <pagination num-pages="numPages"  boundary-links="true" max-size="maxSize" ng-change="pageChanged()" total-items="totalItems" ng-model="currentPage" class="pagination pull-right no-margin" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
            <div class="pull-right ng-binding modv2-pageinfo">
                <span class="modv2-pagecur"> {{currentPage}} </span> / {{numPages}} 页 | 共 {{ totalItems }} 条
            </div>
       </div>
    </div>
</section>
<!-- /.content -->

<script type="text/ng-template" id="tpl-update.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate>
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">门店预存款</h3>
        </div>
        <div class="modal-body">

            <div class="box-body ">
                <div class="form-group">
                    <label><span class="text-danger">*</span> 所属城市：</label> {{ item.province_name }} {{ item.city_name }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger">*</span> 门店名称：</label> {{ item.dept_name }}
                </div>
                <div class="form-group form-inline">
                    <label><span class="text-danger">*</span> 交款金额：</label>
                    <div class="input-group" >
                        <input type="text" placeholder="交款金额" id="fee" class="form-control" name="fee" ng-model="item.fee" money-validator=""   required >
                        <div class="input-group-addon">元</div>
                    </div>
                    <div class="has-feedback text-danger" ng-messages="addForm.fee.$error" ng-show="interacted(addForm.fee)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入交款金额！</div>
                        <div ng-message="moneyValidator"><i class="fa fa-info-circle"></i>请输入交款金额格式不正确！</div>
                    </div>
                </div>
                <div class="form-group form-inline">
                    <label><span class="text-danger">*</span> 交款日期：</label>
                      <span class="input-group datepicker modv2-sel-warap" datepicker-click="tradeTime">
                            <input type="hidden"  ng-model="item.trade_time" />
                            <input type="datetime"  name="trade_time"  ng-model="trade_time" sync="item.trade_time"
                                   class="form-control" datepicker-popup="yyyy-MM-dd" max-date="maxDate" is-open="tradeTime"
                                   datepicker-options="dateOptions" ng-required="true"  current-text="今天" clear-text="清空" close-text="关闭"  readonly  required/>

                        </span>
                    <div class="has-feedback text-danger" ng-messages="addForm.trade_time.$error" ng-show="interacted(addForm.trade_time)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请选择交款日期！</div>
                    </div>
                </div>
                <div class="form-group form-inline">
                    <label for="bill_no"><span class="text-danger">*</span> 汇款单号：</label>
                    <input type="text" placeholder="汇款单号" id="bill_no" class="form-control" name="bill_no" ng-model="item.bill_no" required >
                    <div class="has-feedback text-danger" ng-messages="addForm.bill_no.$error" ng-show="interacted(addForm.bill_no)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入汇款单号！</div>
                    </div>
                </div>
                <div class="form-group form-inline">
                    <label for="entry_account"><span class="text-danger">*</span> 汇入账户：</label>
                    <input type="text" placeholder="汇入账户" id="entry_account" class="form-control" name="entry_account" ng-model="item.entry_account" required>
                    <div class="has-feedback text-danger" ng-messages="addForm.entry_account.$error" ng-show="interacted(addForm.entry_account)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入汇入账户！</div>
                    </div>
                </div>
                <div class="form-group ">
                    <label><span class="text-danger">*</span> 录入人：</label>
                    {{ item.create_user_name }}
                    <label><span class="text-danger">*</span> 录入时间：</label>
                    {{ item.create_time }}
                </div>
            </div><!-- /.box-body -->

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn">确 定</button>
            <button class="btn btn-primary modv2-btn" type="button" ng-click="cancel()">关  闭</button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="tpl-refund.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate>
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">申请退款</h3>
        </div>
        <div class="modal-body">

            <div class="box-body">
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款门店：</label> {{ item.province_name }} {{ item.city_name }} {{ item.dept_name }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 收款人：</label> {{ item.payee_realname }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 收款帐号：</label>
                    {{ item.payee_bank_card_number }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 开户银行：</label>
                    {{ item.payee_bank_branch }}
                </div>
                <div class="form-group form-inline">
                    <label for="money_refund"><span class="text-danger">*</span> 退款金额：</label>
                    <div class="input-group" >
                        <input type="text" placeholder="退款金额" id="money_refund" class="form-control" ng-pattern="/^([0-9]*|[0-9]*\.[0-9]*)$/"  name="money_refund" ng-model="item.money_refund" required >
                        <div class="input-group-addon">元</div>
                    </div>
                    账户余额：{{ item.balance | number: 2 }} 元
                    <div class="has-feedback text-danger" ng-messages="addForm.money_refund.$error" ng-show="interacted(addForm.money_refund)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入退款金额！</div>
                        <div ng-message="pattern"><i class="fa fa-info-circle"></i>输入的退款金额格式不正确！</div>
                    </div>
                </div>
                <div class="form-group ">
                    <label for="create_memo"><span class="text-danger">*</span> 原因说明：</label>
                    <textarea class="form-control" placeholder="原因说明" id="create_memo" name="create_memo" ng-model="item.create_memo" required></textarea>
                    <div class="has-feedback text-danger" ng-messages="addForm.create_memo.$error" ng-show="interacted(addForm.create_memo)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入原因说明！</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="entry_account"><span class="text-danger">*</span> 申请人：</label>
                    {{ item.create_user_name }}
                </div>
                <div class="form-group">
                    <label for="entry_account"><span class="text-danger">*</span> 申请时间：</label>
                    {{ item.create_time }}
                </div>
            </div><!-- /.box-body -->

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn">确 定</button>
            <button class="btn btn-primary modv2-btn" type="button" ng-click="cancel()">关  闭</button>
        </div>
    </form>
</script>
<script type="text/ng-template" id="tpl-notice-transfer.html">

    <form role="form" name="noticeForm" ng-submit="ok(noticeForm.$valid)" class="form-inline" novalidate="">
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">通知转账</h3>
        </div>
        <div class="modal-body">
            <div class="box-body">
                <div class="form-group" >
                    <div style="color:#ff7200">转账收款账号将以短信方式通知店长或店秘</div>
                    <div style="margin:10px;padding: 10px; border:2px dashed #ff7200;">{{item.dept_name }},您可通过网银或手机银行转账，将门店预存款转至以下公司账号，收款人：福州车友网络科技有限公司，账号：{{item.account_name}}，收款银行：平安银行福州分行</div>
                    <div><span class="text-danger">*</span>付款人手机号：<input type="text"  id="mobile" mobile-validator class="form-control modv2-inputg" value="{{ submitter.mobile }}" name="mobile"  ng-model="submitter.mobile" required>
                        <div class="has-feedback text-danger" ng-messages="noticeForm.mobile.$error" ng-show="interacted(noticeForm.mobile)">
                            <div ng-message="required"><i class="fa fa-info-circle"></i>请输入手机码！</div>
                            <div ng-message="mobileValidator"><i class="fa fa-info-circle"></i>请输入手机码必须11位！</div>
                        </div>
                    </div>
                </div>
            </div><!-- /.box-body -->
        </div>
        <div class="modal-footer">
            <div class="form-group modv2-formg">
                <button class="btn btn-default" type="submit"> 发送</button>
                <button class="btn btn-primary modv2-btn" ng-click="cancel()" type="button" >取消</button>
            </div>
        </div>
    </form>
</script>