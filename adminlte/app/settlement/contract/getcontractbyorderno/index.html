<!-- Content Header (Page header) -->
<section class="content-header" >
    <h1>
        {{ $state.current.page.title }}
        <small></small>
    </h1>
    <ol class="breadcrumb">
        <li ui-sref-active="active"><a href="#" ui-sref="mbs-index-home"><i class="fa fa-dashboard"></i>首页</a>
        </li>
        <li class="active">  {{ $state.current.page.title }} </li>
    </ol>
</section>
<!-- Main content -->
<section class="content slide" >
    <div class="box">
        <form name="form" ng-submit="submit(form.$valid)"  role="form" novalidate>
        <div class="box-header row">
            <div class=" col-md-20">
                <span>
                    <label>订单编号：</label>
                    {{ item.order_no }}
                    <label style="margin-left: 50px;" >收款账号：</label>
                    <span >{{ item.sub_account }}</span>
                </span>
                <a href="javascript:;" class="badge badge-warning"  data-ng-click="noticeTransfer()">通知转账收款</a>
            </div>
        </div><!-- /.box-header -->

            <div class="modv2-bheader clearfix">
                <div class="modv2-bheader-in col-md-6">
                    <span class="modv2-c">合同编号：{{ item.contract_no }} </span>|<span class="modv2-c">车牌号：{{ item.car_number }} </span>|<span class="modv2-c">成交价：<span class="modv2-imp">{{ item.sale_price }}</span></span>
                </div>
                <div class="col-md-6 text-right">
                    <!--<button ng-click="editContract()" class="btn btn-primary modv2-btn-modify"><i class="fa fa-file-text"></i> 修改记录</button>-->
                </div>
            </div>

            <div class="box-body  no-padding">
                <div class="box-body no-padding">
                    <table class="modv2-table table-hover">
                        <tbody><tr>
                            <th width="12%"><h4 class="box-title">卖方信息</h4></th>
                            <td>
                                <!-- <div class="form-group ng-binding"><label><span class="text-danger"></span> 信息编号：</label> {{ item.information_no }} </div> -->
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 卖方姓名：</label>{{ item.seller_name }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 联系方式：</label> {{ item.seller_phone }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 证件号码：</label> {{ item.seller_cert_no }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 代理姓名：</label> {{ item.seller_agent_name }}</div>
								<div class="form-group ng-binding"><label><span class="text-danger"></span> 联系电话：</label> {{ item.seller_agent_phone }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 代理证件：</label> {{ item.seller_agent_cert_no }}</div>
                                <!-- <div class="form-group ng-binding"><label><span class="text-danger"></span> 业务顾问：</label> {{ item.seller_tracer}}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 所属门店：</label> {{ item.seller_tracer_shop }}</div> -->
                            </td>
                            <th width="12%"><h4 class="box-title">买方信息</h4></th>
                            <td>
                                <!-- <div class="form-group ng-binding"><label><span class="text-danger"></span> 信息编号：</label>  {{ item.information_no }}   </div> -->
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 买方姓名：</label> {{ item.buyer_name }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 联系方式：</label>  {{ item.buyer_phone }} </div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 证件号码：</label> {{ item.buyer_cert_no }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 代理姓名：</label>  {{ item.buyer_agent_name }} </div>
								<div class="form-group ng-binding"><label><span class="text-danger"></span> 联系电话：</label>  {{ item.buyer_agent_phone }} </div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 代理证件：</label> {{ item.buyer_agent_cert_no }} </div>
                                <!-- <div class="form-group ng-binding"><label><span class="text-danger"></span> 业务顾问：</label> {{ item.buyer_tracer}} </div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 所属门店：</label> {{ item.buyer_tracer_shop}} </div> -->
                            </td>
                        </tr>
                        <tr>
                            <th><h4 class="box-title">车辆信息</h4></th>
                            <td>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 车型品牌：</label> {{ item.vehicle_brand }} {{ item.vehicle_series }} {{ item.vehicle_model }}</div>
                                <div class="form-group ng-binding" ng-if="item.vehicle_guide_price"><label><span class="text-danger"></span> 出厂报价：</label> {{ item.vehicle_guide_price }} + {{item.vehicle_guide_price_tax}}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 车辆类型：</label> {{ item.vehicle_type }} </div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 车牌号码：</label> {{ item.car_number }}</div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 车架号：</label> {{ item.frame_number }}</div>
                            </td>
                            <th><h4 class="box-title">交易信息</h4></th>
                            <td>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 车辆成交价：</label><span  ng-bind-html="item.sale_price | price : 'modv2-impb'"></span></div>
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 信息服务费：</label><span  ng-bind-html="item.cont_brokerage | price : 'modv2-impb'"></span></div>
                                <!--<div class="form-group ng-binding"><label><span class="text-danger"></span> 过户费：</label>{{ item.transfer_fee | price : 'modv2-impb'  }}</div>-->
                                <!--<div class="form-group ng-binding"><label><span class="text-danger"></span> 代办过户费：</label>{{ item.anency_fee | price : 'modv2-impb'  }}</div>-->
                                <!--<div class="form-group ng-binding"><label><span class="text-danger"></span> 其它费用：</label>{{ item.other_fee | price : 'modv2-impb'  }}</div>-->
                                <div class="form-group ng-binding"><label><span class="text-danger"></span> 签订日期：</label>
                                    {{ item.trade_time  ? (item.trade_time * 1000 | date:"yyyy-MM-dd") : ''}}
                                </div>
                            </td>

                        </tr>
                        </tbody></table>
                </div>
				<br />
				<table class="table modv2-table table-hover">
				<tr >
					<td colspan="100%">      
						<a href="javascript:;" style="margin-right: 10px;"  ng-repeat="row in item.pics track by $index" ><img ng-src="{{row.url}}" alt="" class="img-rounded" ng-click="showImage(row.url)"/></a>
						<br /><br />
					</td>
				</tr>
				<tr ng-show="cropZoomImage">
					<td colspan="100%">
						<div class="img-container text-center" crop-zoom="cropZoomImage" >
							<div class="image-btns">
								<button class="btn btn-primary modv2-btn rotate-left"  type="button">左旋转</button>
								<button class="btn btn-primary modv2-btn rotate-right" type="button">右旋转</button>
								<button class="btn btn-primary modv2-btn delete" type="button">关闭</button>
							</div>
							<div class="image-crop">
								<img  src="{{cropZoomImage}}" />
							</div>
						</div>
					</td>
				</tr>
				</table>
                <div class="box-footer"></div>

                <div class="box-body no-padding">
                    <table class="modv2-table modv2-table-ex table-hover">
                        <tbody><tr>
                            <th width="12%" rowspan="2"><h3 class="box-title">订单金额</h3></th>
                            <th width="10%">车款</th>
                            <th width="8%">信息服务费</th>
                            <th width="13%">过户费</th>
                            <th>代办过户费</th>
                            <th width="15%">其它费用(元)</th>
                        </tr>
                        <tr>
                            <td>{{ item.order.car_fee }}</td>
                            <td>{{ item.order.brokerage }}</td>
                            <td>{{ item.order.transfer_fee }}</td>
                            <td>{{ item.order.anency_fee }}</td>
                            <td>{{ item.order.other_fee }}</td>
                        </tr>
                        </tbody></table>
                </div>


                <div class="box-footer"></div>

                <div class="box-body no-padding">
                    <table class="modv2-table modv2-table-ex table-hover">
                        <tbody><tr>
                            <th width="12%" rowspan="{{transfer_info.length+1}}"><h3 class="box-title">收款记录</h3></th>
                            <th width="10%">收款方式</th>
                            <th width="10%">参考信息</th>
                            <th width="8%">收款金额</th>
                            <th width="8%">手续费</th>
                            <th width="8%">卡别</th>
                            <th width="8%">收款银行</th>
                            <th width="15%">收款时间</th>
                            <!--<th width="10%">操作</th>-->
                        </tr>
                        <tr ng-repeat="list in transfer_info" class="list-animation">
                            <td class="text-center"> {{ list.pay_channel |pay_channel }} </td>
                            <td> {{item.pay_channel ==4 ? item.opp_account_name : item.voucher_no}}</td>
                            <td> {{ list.payment_amount | price }}<span data-ng-show="list.pay_channel != 4 && utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')">( {{ list.entry_time ? '已到账' : '未到账'}} )</span></td>
                            <td ng-if="utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')"> {{ list.handling_fee }} <span class="text-danger" ng-if="list.is_free_handling_fee">(免收)</span></td>
                            <td ng-if="!utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')"> {{ list.dept_handling_fee }} <span class="text-danger" ng-if="list.is_free_handling_fee">(免收)</span></td>
                            <td>{{ list.card_type_name }}</td>
                            <td>{{ list.pay_channel == 4 ? '平安银行福州分行' : list.receiving_bank }}</td>
                            <td>{{ list.trans_time  ? ( list.trans_time * 1000 | date:"yyyy-MM-dd HH:mm:ss") : '' }}</td>
                            <!--<td><span ng-href="{{list.sign_url}}">{{ list.sign_url == "" ? "无签购单" : "查看签购单" }}</span></td>-->
                        </tr>
                        <tr class="modv2-num">
                            <td class="text-center" colspan="1"> 合计</td>
                            <td></td>
                            <td></td>
                            <td> <span class="modv2-imp">{{ payment_amount_sum | price}}</span></td>
                            <td ng-if="utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')"> <span class="modv2-imp">{{ handling_fee_sum }}</span></td>
                            <td ng-if="!utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')"> <span class="modv2-imp">{{ dept_handling_fee_sum | number:2 }}</span></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <!--<td></td>-->
                        </tr>
                        </tbody></table>
                </div>

                <div class="box-footer"></div>

                <div class="box-body no-padding">
                    <table class="modv2-table modv2-table-ex table-hover">
                        <tbody><tr>
                            <th width="12%" rowspan="{{apply_info.length+1}}"><h3 class="box-title">付款记录</h3></th>
                            <th width="18%">申请支付用途</th>
                            <th width="8%">申请金额</th>
                            <th width="8%">收款人</th>
                            <th width="13%">卡号</th>
                            <th>收款银行</th>
                            <th width="15%">付款时间</th>
                            <th width="10%">付款状态</th>
                        </tr>
                        <tr ng-repeat="list in apply_info" class="list-animation">
                            <td>{{ list.fee_type_name }}</td>
                            <td> {{ list.fee }}</td>
                            <td> {{ list.payee_realname }} </td>
                            <td>{{ list.payee_cardno }}</td>
                            <td>{{ list.payee_bank }}</td>
                            <td>{{ list.pay_time  ? ( list.pay_time * 1000 | date:"yyyy-MM-dd") : '-' }}</td>
                            <td> {{ list.pay_status_name }} </td>
                        </tr>
                        <tr class="modv2-num">
                            <td  class="text-center"> 合计</td>
                            <td></td>
                            <td> <span class="modv2-imp">{{ fee_sum }}</span></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody></table>
                </div>

                <div class="box-footer"></div>
            </div>
    </form>
    </div>

</section>
<script type="text/ng-template" id="tpl-notice-transfer.html">
    <form role="form" name="noticeForm" ng-submit="ok(noticeForm.$valid)" class="form-inline" novalidate="">
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">通知转账收款</h3>
        </div>
        <div class="modal-body">
            <div class="box-body">
                <div class="box-body">
                    <div class="form-group" >
                        <div>转账收款账号将以短信方式通知买主，买主可通过网银或手机银行转账付款。（17点以后及非工作日，单笔金额超过5万将无法实时到账，可建议买主拆分转账）</div>
                        <div style="margin:10px;padding: 10px; border:2px dashed #ff7200;">您在273{{item.dept_name }}成交{{ item.car_number }}，可网银或手机银行转账至以下公司账户，收款人：福州车友网络科技有限公司，账号：302015********，收款银行：平安银行福州市分行。</div>
                        <div><span class="text-danger">*</span>付款人手机号：<input type="text" placeholder="手机号码" id="mobile" mobile-validator class="form-control modv2-inputg"  name="mobile"  ng-model="submitter.mobile" required>
                            <div class="has-feedback text-danger" ng-messages="noticeForm.mobile.$error" ng-show="interacted(noticeForm.mobile)">
                                <div ng-message="required"><i class="fa fa-info-circle"></i>请输入手机码！</div>
                                <div ng-message="mobileValidator"><i class="fa fa-info-circle"></i>请输入手机码必须11位！</div>
                            </div>
                        </div>
                    </div>
                </div><!-- /.box-body -->
            </div><!-- /.box-body -->
        </div>
        <div class="modal-footer">
            <div class="form-group modv2-formg">
                <button class="btn btn-default" type="submit"> 发送</button>
                <button class="btn btn-primary modv2-btn" ng-click="cancel()" type="button" >取消</button>
            </div>
        </div>
    </form>
</script>
<!-- /.content -->


