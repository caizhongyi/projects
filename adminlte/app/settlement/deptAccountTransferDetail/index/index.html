<!-- Content Header (Page header) -->
<section class="content-header" >
    <h1>
        {{ $state.current.page.title }}
        <small></small>
    </h1>
    <ol class="breadcrumb">
        <li ui-sref-active="active"><a href="#" ui-sref="mbs-index-home"><i class="fa fa-dashboard"></i>首页</a>
        </li>
        <li class="active">  {{ $state.current.page.title }} </li>
    </ol>
</section>
<!-- Main content -->
<section class="content slide" >
    <div class="box" senior-table="transferDetail">
        <div class="box-header ">
            <div class="form form-inline form-alignment">
                <div class="form-group form-group-alignment">
                    <label class="form-label">订单号：</label>
                    <input type="text" placeholder="订单号" ng-model="searchCondition.order_no" class="form-control" >
                </div>
                <div class="form-group form-group-alignment">
                    <label class="form-label">车牌号：</label>
                    <input type="text" placeholder="车牌号"  ng-model="searchCondition.car_number" class="form-control" >
                </div>
                <div class="form-group form-group-alignment">
                    <label class="form-label">收款行：</label>
                    <select id="select_bank" class="form-control input-control" ng-model="searchCondition.pay_bank" name="select_bank" ng-model="searchCondition.fee_type" select-bank="" >
                        <option value="">请选择</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">订单类型</label>
                    <select  class="form-control input-control" name="order_type" ng-model="searchCondition.order_type" select-order-type="">
                        <option value="">请选择</option>
                    </select>
                </div>
                <div>
                    <div class="form-group form-group-alignment">
                        <label class="form-label">开始时间：</label>
                          <span class="input-group datepicker modv2-sel-warap" datepicker-click="startdOpened">
                                <input type="hidden"  ng-model="searchCondition.start_date" />
                                <input placeholder="开始时间" type="datetime"  name="start_date"  required ng-model="start_date" sync="searchCondition.start_date"
                                       class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="startdOpened"
                                       datepicker-options="dateOptions"  ng-required="true"  current-text="今天" clear-text="清空" close-text="关闭"  readonly />
                            </span>
                    </div>
                    <div class="form-group form-group-alignment">
                        <label class="form-label">结束时间：</label>
              <span class="input-group datepicker modv2-sel-warap" datepicker-click="endOpened">
                     <input type="hidden"  ng-model="searchCondition.end_date"/>
                     <input placeholder="结束时间" type="datetime"  name="end_date"  required ng-model="end_date" sync="searchCondition.end_date"
                            class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="endOpened"
                            datepicker-options="dateOptions"  ng-required="true"  min-date="start_date" current-text="今天" clear-text="清空" close-text="关闭"  readonly />

                </span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">卡别：</label>
                        <select  class="form-control input-control" name="status" ng-model="searchCondition.card_type"  select-card-type=""  >
                            <option value="">请选择</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">收款方式：</label>
                        <select  class="form-control input-control" name="pay-channel-type" ng-model="searchCondition.pay_channel_type"  select-pay-channel-type=""  >
                            <option value="">请选择</option>
                        </select>
                    </div>
                    <div class="form-group modv2-formg" ng-if="!utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')">
                        <label class="" >&nbsp;</label>
                        <button class="btn btn-default" ng-click="searchInfo()"  type="button" ><i class="fa fa-search"></i> 搜索</button>
                        <!-- <button class="btn btn-primary modv2-btn" type="button" ng-click="add()">添加一条</button>-->
                    </div>
                </div>
                <div class="form-group" select-store="" ng-if="utils.hasRoleCode('cfb.caiwu,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay,cfb.business')">
                    <div class="form-group">
                        <div class="form-group modv2-formg">
                            <label class="form-label">门店名称：</label>
                            <select id="province" class="form-control province" name="province" ng-model="searchCondition.province"  ng-options="item.id as item.name  for item in province "  >
                                <option value="">省份</option>
                            </select>
                        </div>
                        <div class="form-group modv2-formg">
                            <select id="city" class="form-control city" name="city" ng-model="searchCondition.city"  ng-options="item.id as  item.name for item in city "  >
                                <option value="">市/区</option>
                            </select>
                        </div>
                        <div class="form-group modv2-formg">
                            <select id="shop" class="form-control shop" name="shop" ng-model="searchCondition.dept"  ng-options="item.id as  item.name for item in shop" >
                                <option value="">门店</option>
                            </select>
                        </div>
                        <div class="form-group modv2-formg">
                            <label class="" >&nbsp;</label>
                            <button class="btn btn-default" ng-click="searchInfo()"  type="button" ><i class="fa fa-search"></i> 搜索</button>
							<button class="btn btn-primary modv2-btn" type="button" ng-click="showExcel()">导出表格</button>
                            <!-- <button class="btn btn-primary modv2-btn" type="button" ng-click="add()">添加一条</button>-->
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- /.box-header -->
        <div class="box-body  no-padding">
            <!-- 1、pos刷卡 -->
            <p align="right" ng-if="searchCondition.pay_channel_type && searchCondition.pay_channel_type != 4 ">刷卡总笔数：{{item.total}}，刷卡总金额：{{item.sumPrice | price}}</p>
            <!-- 2、智能转账 -->
            <p align="right" ng-if="searchCondition.pay_channel_type == 4">转账总笔数：{{item.total}}，转账总金额：{{item.sumPrice | price}}</p>
            <!-- 3、pay_channel_type为空 -->
            <span ng-if="!searchCondition.pay_channel_type">
                <p align="right">刷卡总笔数：{{item.pos.total}}，刷卡总金额：{{item.pos.sumPrice | price}}</p>
                <p align="right">转账总笔数：{{item.transfer.total}}，转账总金额：{{item.transfer.sumPrice | price}}</p>
            </span>

            <table class="table table-hover" >
                <tbody>
                <tr>
                    <th >收款时间</th>
                    <th> 订单编号 </th>
                    <th>收款方式</th>
                    <th width="15%">参考信息</th>
                    <th ng-hide="utils.hasRoleCode('cfb.dept,cfb.secret')">所属门店</th>
                    <th >车牌号</th>
                    <th> 合同编号 </th>
                    <th >收款金额(元)</th>
                    <th >手续费(元)</th>
                    <th >卡别</th>
                    <th >订单类型</th>
                    <th width="150">操作</th>
                </tr>
                <tr ng-repeat="item in list" class="list-animation">
                    <td  class="text-center">
                        {{ item.trans_time * 1000 | date : 'yyyy-MM-dd HH:mm:ss'}}
                    </td>
                    <td class="text-center"> {{item.order_no}}</td>
                    <td class="text-center"> {{item.pay_channel | pay_channel}}</td>
                    <td class="text-center">{{item.pay_channel ==4 ? item.opp_account_name : item.voucher_no}}</td>
                    <td class="text-center" ng-hide="utils.hasRoleCode('cfb.dept,cfb.secret')">
                        {{item.dept_name}}
                    </td>
                    <td class="text-center">{{item.order.car_number}}</td>
                    <td class="text-center">
                        <a href="javascript:;" ng-click="contractInfo()" class="modv2-num">{{item.order_contract.contract_no}}</a>
                    </td>
                    <td  class="text-right">
                        {{ item.payment_amount | price }}
                    </td>
                    <td  class="text-right">
                        {{ item.handling_fee }}<span class='text-danger'> {{ item.is_free }} </span>
                    </td>
                    <td  class="text-center">
                        {{ item.card_type}}
                    </td>
                    <td  class="text-center">
                        {{ item.order.is_jhc | order_type }}
                    </td>
                    <td>
                        <a href="javascript:;" modal-sign-info="" class="modv2-link" ng-show="item.sign_url != '' && utils.hasCode('settlement|deptaccounttransferdetail|showsginimg') " >查看签购单</a>
                        <a href="javascript:;" modal-sign-info="" class="modv2-link" ng-show="item.sign_url == '' && utils.hasCode('settlement|deptaccounttransferdetail|updatesignimg') && (item.pay_channel ==3 || item.pay_channel ==5 || item.pay_channel ==6)" ng-click="showSign()">上传签购单</a>
                        <a href="javascript:;" class="modv2-link" ng-show="item.is_free_handling_fee == 1 && utils.hasCode('settlement|deptaccounttransferdetail|setdeptaccountfee')"ng-click="setFee()">扣除手续费</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div><!-- /.box-body -->
        <div class="box-footer clearfix ">
            <pagination num-pages="numPages"  boundary-links="true" max-size="maxSize"   ng-change="pageChanged()" total-items="totalItems" ng-model="currentPage" class="pagination pull-right no-margin" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
            <div class="pull-right ng-binding modv2-pageinfo">
                <span class="modv2-pagecur"> {{currentPage}}</span> / {{numPages}} 页 | 共 {{ totalItems }} 条
            </div>
        </div>
    </div>
</section>
<!-- /.content -->
