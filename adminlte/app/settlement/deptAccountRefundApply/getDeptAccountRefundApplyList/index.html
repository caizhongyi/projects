<!-- Content Header (Page header) -->
<section class="content-header" >
    <h1>
        {{ $state.current.page.title }}
        <small></small>
    </h1>
    <ol class="breadcrumb">
        <li ui-sref-active="active"><a href="#" ui-sref="mbs-index-home"><i class="fa fa-dashboard"></i>首页</a>
        </li>
        <li class="active">  {{ $state.current.page.title }} </li>
    </ol>
</section>
<!-- Main content -->
<section class="content slide" >
    <div class="box" senior-table="refundApply">
        <div class="box-header ">
            <div class="form form-inline form-alignment">
                <div class="form-group" select-store="">
                    <div class=" modv2-formg">
                        <label class="form-label" >门店名称</label>
                        <select id="province" class="form-control province" name="province" ng-model="searchCondition.province"  ng-options="item.id as item.name  for item in province "  >
                            <option value="">省份</option>
                        </select>
                    </div>
                    <div class=" modv2-formg">
                        <select id="city" class="form-control city" name="city" ng-model="searchCondition.city"  ng-options="item.id as  item.name for item in city "  >
                            <option value="">市/区</option>
                        </select>
                    </div>
                    <div class=" modv2-formg">
                        <select id="shop" class="form-control shop" name="shop" ng-model="searchCondition.dept_id"  ng-options="item.id as  item.name for item in shop" >
                            <option value="">门店</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                        <label class="" >&nbsp;</label>
                        <button class="btn btn-default" ng-click="searchInfo()"><i class="fa fa-search"></i> 搜索</button>
                </div>
            </div>
        </div><!-- /.box-header -->
        <div class="box-body no-padding ">
            <table class="table table-hover" >
                <tbody>
                <tr>
                    <th width="100">城市</th>
                    <th >退款门店</th>
                    <th >退款金额</th>
                    <th >支付金额</th>
                    <th >收款人名称</th>
                    <th >收款账号</th>
                    <th >开户行</th>
                    <th >申请日期</th>
                    <th >申请人</th>
                    <th width="70">状态</th>
                    <th width="50">操作</th>
                </tr>
                <tr ng-repeat="item in list" class="list-animation">
                    <td class="text-center">
                        {{ item.province_name }} <br/> {{ item.city_name }}
                    </td>
                    <td class="text-center">
                        {{ item.dept_name }}
                    </td>
                    <td  class="text-right">
                       {{ item.money_refund | price }}
                    </td>
                    <td  class="text-right">
                        {{ item.pay_money | price }}
                    </td>
                    <td class="text-center">
                        {{ item.pay_realname }}
                    </td>
                    <td class="text-center">
                        {{ item.bank_cardno }}
                    </td>
                    <td class="text-center">
                        {{ item.bank_branch }}
                    </td>
                    <td class="text-center">
                        {{ item.create_time }}
                    </td>
                    <td class="text-center">
                        {{ item.create_real_name }}
                    </td>
                    <td class="text-center">
                        {{ item.status }}
                    </td>
                    <td class="text-center">
                        <a  href="javascript:;" class="modv2-link " ng-click="preview()" >查看</a>
                        <a  href="javascript:;" class="modv2-link " ng-click="check()" ng-show="utils.hasCode('settlement|deptaccountrefundapply|checkdeptaccountrefundapply')" ng-if="item.status == '未复核'">复核</a>
                        <a  href="javascript:;" class="modv2-link " ng-click="pay()" ng-if="item.status == '已复核'">支付</a>
                    </td>
                </tr>
                </tbody>
            </table>


        </div><!-- /.box-body -->
        <div class="box-footer clearfix ">
            <pagination num-pages="numPages"  boundary-links="true" max-size="maxSize"   ng-change="pageChanged()" total-items="totalItems" ng-model="currentPage" class="pagination pull-right no-margin" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
            <div class="pull-right ng-binding modv2-pageinfo">
                <span class="modv2-pagecur"> {{currentPage}} </span> / {{numPages}} 页 | 共 {{ totalItems }} 条
            </div>
        </div>
    </div>
</section>
<!-- /.content -->

<script type="text/ng-template" id="tpl-preview.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate>
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">查看</h3>
        </div>
        <div class="modal-body">

            <div class="box-body ">
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款门店：</label> {{ item.dept_name }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 收款人：</label> {{ item.pay_realname }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 收款帐号：</label> {{ item.bank_cardno }}
                    </div>
                </div>
                <div class="form-group ">
                    <label><span class="text-danger"></span> 开户行：</label>   {{ item.bank_branch }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款金额：</label> {{ item.money_refund | price }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款原因：</label> {{ item.create_memo }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 申请人：</label> {{ item.create_real_name }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 申请时间：</label> {{ item. create_time }}
                    </div>
                </div>
            </div><!-- /.box-body -->

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" type="button" ng-click="cancel()">关闭</button>
        </div>
    </form>
</script>
<script type="text/ng-template" id="tpl-check.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate>
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">复核</h3>
        </div>
        <div class="modal-body">

            <div class="box-body ">
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款门店：</label> {{ item.dept_name }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 收款人：</label> {{ item.pay_realname }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 收款帐号：</label> {{ item.bank_cardno }}
                    </div>
                </div>
                <div class="form-group ">
                    <label><span class="text-danger"></span> 开户行：</label>   {{ item.bank_branch }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款金额：</label> {{ item.money_refund | price }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款原因：</label> {{ item.create_memo }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 申请人：</label> {{ item.create_real_name }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 申请时间：</label> {{ item. create_time }}
                    </div>
                </div>
                <div class="form-group" >
                    <label for="check_memo"><span class="text-danger"></span> 审核意见：</label>
                    <textarea  placeholder="审核意见" id="check_memo" class="form-control" name="check_memo" ng-model="item.check_memo" ></textarea>
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 复核人：</label> {{ item.check_real_name }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 复核时间：</label> {{ item.check_time }}
                    </div>
                </div>
            </div><!-- /.box-body -->

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn">确 定</button>
            <button class="btn btn-danger modv2-btn" type="button" ng-click="rejected()">拒 绝</button>
            <button class="btn btn-primary modv2-btn" type="button" ng-click="cancel()">取 消</button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="tpl-pay.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate>
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">支付</h3>
        </div>
        <div class="modal-body">

            <div class="box-body ">
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款门店：</label> {{ item.dept_name }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 收款人：</label> {{ item.pay_realname }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 收款帐号：</label> {{ item.bank_cardno }}
                    </div>
                </div>
                <div class="form-group ">
                    <label><span class="text-danger"></span> 开户行：</label>   {{ item.bank_branch }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款金额：</label> {{ item.money_refund | price }}
                </div>
                <div class="form-group">
                    <label><span class="text-danger"></span> 退款原因：</label> {{ item.create_memo }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 申请人：</label> {{ item.create_real_name }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 申请时间：</label> {{ item. create_time }}
                    </div>
                </div>
                <div class="form-group" >
                    <label for="check_memo"><span class="text-danger"></span> 审核意见：</label>
                    {{ item.check_memo }}
                </div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 复核人：</label> {{ item.check_real_name }}
                    </div>
                    <div class="form-group col-md-6">
                        <label><span class="text-danger"></span> 复核时间：</label> {{ item.check_time }}
                    </div>
                </div>
                <div class="form-group ">
                    <label><span class="text-danger">*</span> 付款日期：</label>
                      <span class="input-group datepicker modv2-sel-warap" datepicker-click="payTime">
                            <input type="hidden"  ng-model="item.pay_time" />
                            <input type="datetime"  name="pay_time"  ng-model="pay_time" sync="item.pay_time"
                                   class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="payTime"
                                   datepicker-options="dateOptions" ng-required="true"  current-text="今天" clear-text="清空" close-text="关闭"  readonly  required/>
                        </span>
                    <div class="has-feedback text-danger" ng-messages="addForm.pay_time.$error" ng-show="interacted(addForm.pay_time)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请选择付款日期！</div>
                    </div>
                </div>

                <div class="form-group ">
                    <label><span class="text-danger">*</span> 付款凭证号：</label>
                    <input type="text" placeholder="付款凭证号" id="pay_voucher_no" class="form-control" name="pay_voucher_no" ng-model="item.pay_voucher_no" required >
                    <div class="has-feedback text-danger" ng-messages="addForm.pay_voucher_no.$error" ng-show="interacted(addForm.pay_voucher_no)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入付款凭证号！</div>
                    </div>
                </div>

                <div class="form-group ">
                    <label><span class="text-danger">*</span> 支付金额：</label>
                    <input type="text" placeholder="支付金额" id="pay_money" ng-disabled="true" class="form-control" name="pay_money" ng-model="item.pay_money" required  money-validator >
                    <div class="has-feedback text-danger" ng-messages="addForm.pay_money.$error" ng-show="interacted(addForm.pay_money)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入支付金额！</div>
                        <div ng-message="moneyValidator "><i class="fa fa-info-circle"></i>输入的支付金额格式不正确！</div>
                    </div>
                </div>

                <div class="form-group ">
                    <label><span class="text-danger">*</span> 支付行：</label>
                    <select  id="pay_bank" class="form-control input-control" name="pay_bank" ng-model="item.pay_bank" select-bank>
                        <option value="">请选择</option>
                    </select>
                    <div class="has-feedback text-danger" ng-messages="addForm.pay_bank.$error" ng-show="interacted(addForm.pay_bank)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i>请输入支付行！</div>
                    </div>
                </div>

            </div><!-- /.box-body -->

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn">确 定</button>
            <button class="btn btn-primary modv2-btn" type="button" ng-click="cancel()">取 消</button>
        </div>
    </form>
</script>
