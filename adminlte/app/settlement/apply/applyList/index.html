<!-- Content Header (Page header) -->
<section class="content-header" >
    <h1>
        {{ $state.current.page.title }}
        <small></small>
    </h1>
    <ol class="breadcrumb">
        <li ui-sref-active="active"><a href="#" ui-sref="mbs-index-home"><i class="fa fa-dashboard"></i>首页</a>
        </li>
        <li class="active">  {{ $state.current.page.title }} </li>
    </ol>
</section>
<!-- Main content -->
<section class="content slide" >
    <div class="box"  senior-table="applyList">
        <div class="box-header ">
            <div class="form form-inline form-alignment">
                <div class="form-group form-group-alignment">
                    <label class="form-label">订单号：</label>
                    <input type="text" placeholder="订单号" ng-change="searchChange()" ng-model="searchCondition.order_no" class="form-control" >
                </div>

                <div class="form-group form-group-alignment">
                    <label class="form-label">车牌号：</label>
                    <input type="text" placeholder="车牌号" ng-change="searchChange()" ng-model="searchCondition.car_number" class="form-control" >
                </div>

                <div class="form-group form-group-alignment">
                    <label class="form-label">合同号：</label>
                    <input type="text" placeholder="合同号" ng-change="searchChange()" ng-model="searchCondition.contract_no" class="form-control" >
                </div>
                <div class="form-group">
                    <label class="form-label">申请类型：</label>
                    <select  class="form-control input-control" name="fee_type" ng-model="searchCondition.fee_type"  select-apply-type=""  >
                        <option value="">请选择</option>
                    </select>
                </div>

                <div>
                    <div class="form-group form-group-alignment">
                        <label class="form-label">开始时间：</label>
                          <span class="input-group datepicker modv2-sel-warap" datepicker-click="startdOpened">
                                <input type="hidden"  ng-model="searchCondition.start_date" />
                                <input placeholder="开始时间" type="datetime"  name="start_date"  required ng-model="start_date" sync="searchCondition.start_date"
                                       class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="startdOpened"
                                       datepicker-options="dateOptions"  ng-required="true"  current-text="今天" clear-text="清空" close-text="关闭"  readonly />
                            </span>
                    </div>
                    <div class="form-group form-group-alignment">
                        <label class="form-label">结束时间：</label>
              <span class="input-group datepicker modv2-sel-warap" datepicker-click="endOpened">
                     <input type="hidden"  ng-model="searchCondition.end_date"/>
                     <input placeholder="结束时间" type="datetime"  name="end_date"  required ng-model="end_date" sync="searchCondition.end_date"
                            class="form-control" datepicker-popup="yyyy-MM-dd"  is-open="endOpened"
                            datepicker-options="dateOptions"  ng-required="true"  min-date="start_date" current-text="今天" clear-text="清空" close-text="关闭"  readonly />

                </span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">状态：</label>
                        <select  class="form-control input-control" name="status" ng-model="searchCondition.status"  select-apply-status=""  >
                            <option value="">请选择</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">订单类型</label>
                        <select  class="form-control input-control" name="order_type" ng-model="searchCondition.order_type" select-order-type="">
                            <option value="">请选择</option>
                        </select>
                    </div>


                    <div class="form-group">
                        <label class="form-label">付款状态</label>
                        <select  class="form-control input-control" name="order_type" ng-model="searchCondition.pay_status">
                            <option value="">请选择</option>
                            <option value="1">已付款</option>
                            <option value="999">未付款</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">是否转账</label>
                        <select  class="form-control input-control" name="order_type" ng-model="searchCondition.is_channel4" select-yes-or-no="">
                            <option value="">请选择</option>
                        </select>
                    </div>


                    <div class="form-group" ng-if="!utils.hasRoleCode('cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay')">
                        <label class=""> </label>
                        <button class="btn btn-default" ng-click="searchInfo()"><i class="fa fa-search"></i> 搜索</button>
                     </div>
                </div>

                <div class="form-group" select-store="" ng-if="utils.hasRoleCode('cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay')">
                    <div class="form-group modv2-formg">
                        <label class="form-label" >门店名称：</label>
                        <select id="province" class="form-control province" name="province" ng-model="searchCondition.province"  ng-options="item.id as item.name  for item in province "  >
                            <option value="">省份</option>
                        </select>
                    </div>
                    <div class="form-group modv2-formg">
                        <select id="city" class="form-control city" name="city" ng-model="searchCondition.city"  ng-options="item.id as  item.name for item in city "  >
                            <option value="">市/区</option>
                        </select>
                    </div>
                    <div class="form-group modv2-formg">
                        <select id="shop" class="form-control shop" name="shop" ng-model="searchCondition.dept"  ng-options="item.id as  item.name for item in shop" >
                            <option value="">门店</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-default" ng-click="searchInfo()"><i class="fa fa-search"></i> 搜索</button>
                     </div>
                </div>

            </div>

        </div><!-- /.box-header -->
        <div class="box-body no-padding">
            <table class="table table-hover" >
                <tbody>
                <tr>
                    <th >订单日期</th>
                    <th width="15%">门店</th>
                    <th  width="8%">订单号</th>
                    <th  width="12%">合同号</th>
                    <th width="13%">车辆信息</th>
                    <th width="8%">未付款</th>
                    <th width="8%">费用类型</th>
                    <th >申请金额</th>
                    <th width="8%">状态</th>
                    <th >订单类型</th>
                    <th width="7%">操作</th>
                </tr>
                <tr ng-repeat="item in list" class="list-animation">
                    <td class="text-center">
                        {{ item.order_create_time ? ( item.order_create_time * 1000 | date : 'yyyy-MM-dd' ) : '--'}}
                    </td>
                    <td class="text-center">
                        {{item.dept_name}}
                    </td>
                    <td class="text-center">
                        {{item.order_no}}
                        <!--<div class="clearfix modv2-tdb">-->
                            <!--<span class="pull-right  ng-binding">{{item.order_no}}</span>-->
                            <!--<span class="">订单号</span>-->
                        <!--</div>-->
                    </td>
                    <td  class="text-center">
                        {{item.order_contract.contract_no}}
                        <!--<div class="clearfix modv2-tdb">-->
                            <!--<span class="pull-right  ng-binding">{{item.order_contract.contract_no}}</span>-->
                            <!--<span class="">合同号</span>-->
                        <!--</div>-->
                    </td>
                    <td  class="text-center">
                        {{item.order_contract.car_number}}
                        <!-- <div class="clearfix modv2-tdb">
                            <span class="pull-right  ng-binding">{{item.order_contract.car_number}} </span>
                            <span class="">车牌号</span>
                        </div>
                        <div class="clearfix modv2-tdb" ng-if="item.order_contract.vehicle_brand">
                            <span class="pull-right  ng-binding"> {{item.order_contract.vehicle_brand}}</span>
                            <span class="">车型品牌</span>
                        </div> -->
                    </td>
                    <td class="text-center">
                        {{ item.unpay | price }}
                    </td>
                    <td class="text-center">
                        {{ item.fee_type }}
                    </td>
                    <td >
                        <div class="text-danger text-center">  {{ item.fee | number }}</div>
                    </td>
                    <td  class="text-center">
                        <span >{{item.pay_status == 1 ? '财务已付款' : item.status_name }}</span>
                        <div title="{{ item.caiwu_check_note ? item.caiwu_check_note : item.dept_check_note }}" class="text-danger text-ellipsis " style="width: 120px;margin: 0 auto;" ng-if="item.status == 3 || item.status == 4">{{ item.caiwu_check_note ? item.caiwu_check_note : item.dept_check_note }}</div>
                        <div class="text-danger text-center" ng-if="item.is_unusual != 0">异常登录</div>
                    </td>
                    <td  class="text-center">
                        {{ item.order.is_jhc | order_type }}
                    </td>
                    <td class="text-center" >
                        <!-- 店长除待店长审核状态外有查看权限
                        结算除待财务审核状态外有查看权限
                        除店长及结算其他角色一直有查看权限 -->
                        <a href="javascript:;" class="modv2-link" ng-show="(utils.hasRoleCode('cfb.dept') && item.status != 0) || (utils.hasRoleCode('cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay') && item.status != 1) || !utils.hasRoleCode('cfb.dept,cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay')" ng-click="preview()">查看</a>
                        <a href="javascript:;"  class="modv2-link" ng-show="utils.hasCode('settlement|apply|applycheck') && utils.hasRoleCode('cfb.dept') && item.status == 0" ui-sref="settlement-apply-applyInfo({ id : item.id })" target="_blank">审核</a>
                        <a href="javascript:;" class="modv2-link" ng-show="utils.hasCode('settlement|apply|applycheck') && utils.hasRoleCode('cfb.caiwu.recheck,cfb.caiwu.manage,cfb.caiwu.pay') && item.status == 1" ui-sref="settlement-apply-applyInfo({ id : item.id })" target="_blank" >审核</a>
                        <a href="javascript:;"  class="modv2-link" ng-show="utils.hasCode('settlement|contract|contractrefund') && item.order_contract.status == 2"  ng-click="return()">合同驳回</a>
                        <span title="{{item.order_contract.check_note}}" class="text-danger" ng-if="item.order_contract.status == 3">合同已驳回</span>

                    </td>
                </tr>
                </tbody>
            </table>

        </div><!-- /.box-body -->
        <div class="box-footer clearfix ">
            <pagination num-pages="numPages"  boundary-links="true" max-size="maxSize"   ng-change="pageChanged()" total-items="totalItems" ng-model="currentPage" class="pagination pull-right no-margin" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
            <div class="pull-right ng-binding modv2-pageinfo">
                <span class="modv2-pagecur"> {{currentPage}} </span> / {{numPages}} 页 | 共 {{ totalItems }} 条
            </div>
        </div>
    </div>
</section>
<!-- /.content -->

<script type="text/ng-template" id="tpl-confirm.html">
    <form role="form" name="addForm">
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">提示</h3>
        </div>
        <div class="modal-body text-center">
            确定要驳回该支付审核吗
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" ng-click="ok()" type="button" >确认</button>
            <button class="btn btn-primary modv2-btn"  ng-click="cancel()" type="button" >取消</button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="tpl-return.html">
    <form role="form" name="addForm" ng-submit="submitAddForm(addForm.$valid)" novalidate >
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">合同驳回</h3>
        </div>
        <div class="modal-body">
            <div class="box-body">
                <div class="form-group">
                     输入驳回原因：
                </div>
                <div class="form-group">
                    <!--<input type="text" placeholder="输入原因" id="check_note" class="form-control" name="check_note" ng-model="check_note"  required value=""   >-->
                    <textarea class="form-control" placeholder="输入原因" id="check_note" name="check_note" ng-model="check_note" required></textarea>
                    <div class="has-feedback text-danger" ng-messages="addForm.check_note.$error" ng-show="interacted(addForm.check_note)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i> 请输入原因！</div>
                        <div ng-if="check_error"><i class="fa fa-info-circle"></i> {{check_error}}！</div>
                    </div>
                </div>
            </div><!-- /.box-body -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" >确认</button>
            <button class="btn btn-primary modv2-btn"  ng-click="cancel()" type="button" >取消</button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="tpl-reject.html">
    <form role="form" name="rejectForm" ng-submit="rejectSubmitAddForm(rejectForm.$valid)" novalidate >
        <div class="modal-header">
            <button aria-label="Close" data-dismiss="modal" class="close" type="button" ng-click="cancel()"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title">付款审核驳回</h3>
        </div>
        <div class="modal-body">
            <div class="box-body">
                <div class="form-group">
                     输入驳回原因：
                </div>
                <div class="form-group">
                    <!--<input type="text" placeholder="输入原因" id="reject_check_note" class="form-control" name="reject_check_note" ng-model="reject_check_note"  required value=""   >-->
                    <textarea class="form-control" placeholder="输入原因" id="reject_check_note" name="reject_check_note" ng-model="reject_check_note" required></textarea>
                    <div class="has-feedback text-danger" ng-messages="rejectForm.reject_check_note.$error" ng-show="interacted(rejectForm.reject_check_note)">
                        <div ng-message="required"><i class="fa fa-info-circle"></i> 请输入原因！</div>
                        <div ng-if="check_error"><i class="fa fa-info-circle"></i> {{check_error}}！</div>
                    </div>
                </div>
            </div><!-- /.box-body -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modv2-btn" >确认</button>
            <button class="btn btn-primary modv2-btn"  ng-click="cancel()" type="button" >取消</button>
        </div>
    </form>
</script>