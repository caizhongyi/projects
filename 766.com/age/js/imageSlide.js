//2011-07-18 wangwei
(function(a){var b={spacing:130,navNum:4,playerWidth:950,playerHeight:390,preloadingImg:"http://tv.sohu.com/upload/moviefocus1129/img/loading_black.gif",preloading:!0,hoverPause:!0,animateSpeed:"fast",autoPlay:!0,autoScrollSpeed:4e3,loop:!0,ptStepX:5};a.ImgSlide=function(c,d){this.$container=a(c).addClass("fi_movie"),this.config=a.extend({},b,d||{}),this.target=this.config.target||"_blank";var e={_blank:!0,_top:!0,_self:!0,_parent:!0};e[this.target]||(this.target="_blank"),this.spacing=this.config.spacing,this.animateSpeed=this.config.animateSpeed,this.data=this.config.data,this.autoPlay=this.config.autoPlay,this.timeout=this.config.timeout,this.autoScrollSpeed=this.config.autoScrollSpeed,this.index=0,this.loop=this.config.loop,this.imgComplete=[],this.clickDone=!0,this._autoPlay=!0,this._firstPlay=!0,this.navNum=this.config.navNum,this.timeoutId=null,this.ptStepX=this.config.ptStepX;if(this.config.data)this.totalNum=this.config.data.length,this.initImgSlide(),this.start();else return};var c=a.ImgSlide;c.fn=c.prototype={version:"1.0.0"},c.extend=c.fn.extend=a.extend,c.fn.extend({initImgSlide:function(){this.initHTML(),this.initEvents()},initHTML:function(){var b=this;this.slides=[],this.$player=a('<div class="fi_ct"></div>'),this.$preloading=a(['<div class="fi_loading" style="display:none;z-index:-999;"><img src="',this.config.preloadingImg,'"/><div>'].join("")).css({opacity:.5}),this.$player.append(this.$preloading),this.$nav=a('<div class="fi_tab"></div>'),this.$preBtn=a('<div class="fi_btn fi_prev"><a href="javascript:void(0)"></a></div>'),this.$nextBtn=a('<div class="fi_btn fi_next"><a href="javascript:void(0)"></a></div>'),this.$list=a('<div class="fi_tab_inner"></div>'),this.$list.css({width:this.config.spacing*this.config.navNum+"px"});var c=a('<ul style="left:0px;" class="fi_tab_ "></ul>'),d,e,f,g,h;for(d=0,e=this.config.data.length;d<e;d++)g=this.config.data[d],h=a(['<a href="',g.l,'" target="',this.target,'"><img lazysrc="',g.p,'" class="fi_player" height="',this.config.playerHeight,'" width="',this.config.playerWidth,'"></a>'].join("")).css({opacity:0,position:"absolute",left:0,top:0}),this.slides.push(h),this.$player.append(h),f=a(['<li><a target="',this.target,'" href="',g.l,'"><img height="45" width = "80" src="',g.p1,'"><div class="fi_ovl_tab" style="opacity: 0.3; display: block;"></div></a></li>'].join("")),f.find("div.fi_ovl_tab").css({opacity:.3}),f.data("data",g),f.data("index",d),c.append(f);c.css({width:this.spacing*e+"px"}),this.$list.append(c),this.$pointer=a('<div class="fi_pointer" style="left: 5px; display: block;"></div>'),this.$list.append(this.$pointer),this.$note=a('<div class="fi_note"></div>'),this.$acts=a('<div class="fi_acts"></div>'),this.$noteBackground=a('<div class="fi_ovl_note"></div>').css({opacity:.7}),this.$nav.append(this.$preBtn,this.$list,this.$nextBtn),this.$container.append(this.$player,this.$nav,this.$note,this.$acts,this.$noteBackground),this.$list.css({height:c.find("li:first").outerHeight()}),this.$list=c,this.config.loop&&this.$list.find("li").each(function(c){a(this).css({position:"absolute",left:c*b.spacing})})},initEvents:function(){var a=this;this.$nextBtn.bind("click",{self:this},this.nextClick[this.config.loop]),this.$preBtn.bind("click",{self:this},this.preClick[this.config.loop]),this.$list.find("li").bind("mouseenter",{self:this},this.hoverHandler),this.config.hoverPause&&this.$container.hover(function(){a.stop()},function(){a.start()})},hoverHandler:function(b){var c=b.data.self,d=a(this),e=d.data("index");c.loop&&c.setPointer(d,!1),e!=c.index&&c.display(d)},showPreloading:function(){this.getSlide(this.index).animate({opacity:0},this.animateSpeed),this.$preloading.show()},hidePreloading:function(){this.$preloading.hide()},nextClick:{"true":function(b){var c=b.data.self;if(!!c.clickDone){c.clickDone=!1;var d=c.spacing,e=c.config.navNum,f=c.$list;$pointer=c.$pointer,f.find("li").each(function(b){a(this).animate({left:d*(b-1)},c.animateSpeed,function(){b===c.totalNum-1&&(c.clickDone=!0,f.find("li:first").insertAfter(f.find("li:last")).css({left:(c.totalNum-1)*d}))})});var g=c.indexAt(c.index);parseInt(g.css("left"))===0?$pointer.css({left:c.ptStepX+(c.totalNum-1)*d}):$pointer.animate({left:c.ptStepX+parseInt(g.css("left"))-d},c.animateSpeed)}},"false":function(a){var b=a.data.self;if(!!b.clickDone){var c=b.spacing,d=b.config.navNum,e=b.totalNum,f=b.$list;b.enablePreBtn();if(Math.abs(parseInt(f.css("left")))===(e-d)*c)return;b.clickDone=!1,b.pointerPre(),b.scrollNext(function(){Math.abs(parseInt(f.css("left")))===(e-d)*c&&b.disableNextBtn(),b.clickDone=!0})}}},preClick:{"true":function(b){var c=b.data.self;if(!!c.clickDone){c.clickDone=!1;var d=c.$list,e=c.spacing,f=c.$pointer;d.find("li:last").insertBefore(d.find("li:first")).css({left:-e});var g=c.indexAt(c.index);d.find("li").each(function(b){a(this).animate({left:e*b},c.animateSpeed,function(){b===c.totalNum-1&&(c.clickDone=!0,parseInt(f.css("left"))===c.ptStepX+(c.totalNum-1)*e&&f.css({left:c.ptStepX}))})}),parseInt(f.css("left"))!==c.ptStepX+(c.totalNum-1)*e&&f.animate({left:c.ptStepX+parseInt(g.css("left"))+e},c.animateSpeed)}},"false":function(a){var b=a.data.self;if(!!b.clickDone){var c=b.$list,d=b.spacing;b.enableNextBtn();if(parseInt(c.css("left"))===0)return;b.clickDone=!1,b.pointerNext(),b.scrollPre(function(){parseInt(c.css("left"))===0&&b.disablePreBtn(),b.clickDone=!0})}}},setMovieInfo:function(a){function f(a){return typeof a=="string"}var b,c,d,e;info=['<div class="fi_jb"></div>'];if(a.minfo&&f(a.minfo))this.$note.html(a.minfo);else{a.t&&info.push('<h2 class="fi_tt"><a target="',this.target,'" href="',a.l,'">',a.t,"</a></h2>"),a.t_&&info.push('<h3 class="fi_tt0"><a target="',this.target,'" href="',a.l,'">',a.t_,"</a></h3>"),info.push('<div class="fi_meta">');if(a.mtype&&a.mtype.length>0)if(f(a.mtype))info.push(a.mtype);else{f(a.mtype[0])?(e=a.mtype[0],b=1):(e="\u7c7b\u578b",b=0),info.push('<div class="fi_mtype"><label>',e,"\uff1a</label><p>");for(d=a.mtype.length;b<d;b++)c=a.mtype[b],info.push('<a target="',this.target,'" href="',c.l,'">',c.t,"</a>");info.push("</p></div>")}if(a.mdirector&&a.mdirector.length>0)if(f(a.mdirector))info.push(a.mdirector);else{f(a.mdirector[0])?(e=a.mdirector[0],b=1):(e="\u5bfc\u6f14",b=0),info.push('<div class="fi_mdirector"><label>',e,"\uff1a</label><p>");for(d=a.mdirector.length;b<d;b++)c=a.mdirector[b],info.push('<a target="',this.target,'" href="',c.l,'">',c.t,"</a>");info.push("</p></div>")}if(a.mactor&&a.mactor.length>0)if(f(a.mactor))info.push(a.mactor);else{f(a.mactor[0])?(e=a.mactor[0],b=1):(e="\u4e3b\u6f14",b=0),info.push('<div class="fi_mactor"><label>',e,"\uff1a</label><p>");for(d=a.mactor.length;b<d;b++)c=a.mactor[b],info.push('<a target="',this.target,'" href="',c.l,'">',c.t,"</a>");info.push("</p></div>")}a.t1&&info.push('<div class="fi_mdesc">',a.t1,"<div>"),info.push("</div>"),this.$note.html(info.join("")),this.$acts.html(['<a class="fi_btnplay" target="',this.target,'" href="',a.l,'"><span></span></a>'].join(""))}},startAt:function(a){var b=this.indexAt(a),c=this.$pointer,d=this.$list,e=this.spacing;this._autoPlay=!0,this.loop&&parseInt(c.css("left"))>(this.navNum-1)*e+this.ptStepX&&(b=d.find("li:first")),this.setPointer(b,!1),this.display(b)},start:function(){this.startAt(this.index)},stop:function(){this.clearLoadTimout();var a=this.getSlideImage(this.index);a.unbind("load.scroll"),clearTimeout(this.timer),this.timer=null,this._autoPlay=!1},navReset:function(a){this.$list.animate({left:0},"fast",a)},pointerNext:function(a,b){var c=this.$pointer,d=this.spacing,a=a||1,b=typeof b=="undefined"?!0:b;b?c.animate({left:parseInt(c.css("left"))+a*d},this.animateSpeed):c.css({left:parseInt(c.css("left"))+a*stspacing})},pointerPre:function(a,b){var c=this.$pointer,d=this.spacing,a=a||1,b=typeof b=="undefined"?!0:b;b?c.animate({left:parseInt(c.css("left"))-a*d},this.animateSpeed):c.css({left:parseInt(c.css("left"))-a*stspacing})},scrollPre:function(a){var b=this.spacing,c=this.$list,a=a||function(){};c.animate({left:parseInt(c.css("left"))+b},this.animateSpeed,a)},scrollNext:function(b){var c=this,d=this.spacing,e=this.$list,b=b||function(){},f;this.loop?e.find("li").each(function(b){a(this).animate({left:d*(b-1)},c.animateSpeed,function(){b===c.totalNum-1&&(c.clickDone=!0,e.find("li:first").insertAfter(e.find("li:last")).css({left:(c.totalNum-1)*d}))})}):e.animate({left:parseInt(e.css("left"))-d},this.animateSpeed,b)},enablePreBtn:function(){this.$preBtn.find("a").removeClass("fi_off")},disablePreBtn:function(){this.$preBtn.find("a").addClass("fi_off")},enableNextBtn:function(){this.$nextBtn.find("a").removeClass("fi_off")},disableNextBtn:function(){this.$nextBtn.find("a").addClass("fi_off")},displayNext:function(){var b=this,c=this.spacing,d=this.config.navNum,e=this.$list,f=null,g=this.$pointer,h=!0;if(this.loop){var f=this.indexAt(this.index).next(),i=!1;parseInt(f.css("left"))>=this.navNum*c&&(parseInt(g.css("left"))>=(this.navNum-1)*c+this.ptStepX&&g.hide(),e.find("li").each(function(d){a(this).animate({left:c*(d-1)},b.animateSpeed,function(){d===b.totalNum-1&&(b.clickDone=!0,g.show(),e.find("li:first").insertAfter(e.find("li:last")).css({left:(b.totalNum-1)*c}))})})),parseInt(g.css("left"))<(this.navNum-1)*c+this.ptStepX&&this.setPointer(f,i),this.display(f,!1,h)}else f=this.$list.find("li:eq("+(this.index+1)+")"),this.index+1!==this.data.length?((f.data("index")+1)*c+parseInt(e.css("left"))>d*c&&(this.scrollNext(),h=!1),this.display(f,!1,h)):(this.stop(),this.navReset(function(){b.startAt(0)}))},setPointer:function(a,b){var c=this.$list,d=this.$pointer,e=this.spacing,b=b||!1,f=this.indexOf(a);this.loop?b?d.animate({left:this.ptStepX+f*e},this.animateSpeed):d.css({left:this.ptStepX+f*e}):b?d.animate({left:this.ptStepX+f*e+parseInt(c.css("left"))},this.animateSpeed):d.css({left:this.ptStepX+f*e+parseInt(c.css("left"))})},indexOf:function(b){var c=this.$list.find("li"),d,e,f=-1;for(d=0,e=c.length;d<e;d++)if(a(c[d]).data("index")===b.data("index")){f=d;break}return f},indexAt:function(b){var c=this.$list.find("li"),d,e,f=null,g;for(d=0,e=c.length;d<e;d++){g=a(c[d]);if(g.data("index")===b){f=g;break}}return f},display:function(b,c,d){function p(){h.imgUnbind(h.index),h.autoPlay&&h._autoPlay&&h.autoPlayNext(0)}function o(b){var c=b.data.self,d=b.data.index;c.clearLoadTimout(),a(this).unbind("load.animate"),a(this).unbind("load.scroll"),c.autoPlayNext()}function n(b){var c=b.data.self,d=b.data.index;c.autoPlayNext(),a(this).unbind("load.scroll")}function m(b){var c=b.data.self,e=b.data.index;c.clearLoadTimout(),c.hidePreloading(),c.doAnimate(c.getSlide(c.index)||[],c.getSlide(e),d),a(this).unbind("load.animate")}function l(b){var c=b.data.self,d=b.data.index;c.imgComplete[d]=!0,a(this).unbind("load.action")}var e=this.$list,f=this.$player,g=this.$pointer,c=c||!1,d=typeof d=="undefined"?!0:d,h=this;e.find("li").removeClass("fi_now"),e.find("li a div").css({display:"block"}),b.addClass("fi_now"),b.find("a div").css({display:"none"}),d&&!this.loop&&this.setPointer(b,c);var i=b.data("data"),j=b.data("index"),k=this.getSlide(j);j==this.index&&!this._firstPlay&&this.imgComplete[j]?this._autoPlay&&this.autoPlayNext():(this._firstPlay=!1,this.setMovieInfo(b.data("data")),this.imgUnbind(this.index),this.clearLoadTimout(),clearTimeout(this.timer),this.timer=null,this.imgComplete[j]?(this.doAnimate(this.getSlide(this.index),k,d),this.index=j,this.autoPlayNext()):(h.config.preloading&&(h.showPreloading(),this.setFront(j)),this.index=j,this.loadImage(j,[m,l,n],o,this.timeout?function(){p()}:null)))},imgUnbind:function(a){var b=this.getSlideImage(a);b.unbind("load.animate"),b.unbind("load.scroll"),b.unbind("error")},allImgUnbind:function(){var a,b,c;for(a=0,c=this.data.length;a<c;a++)b=this.getSlideImage(a),b.unbind("load.animate"),b.unbind("load.scroll"),b.unbind("error")},autoPlayNext:function(a){var b=this;a=a==null||typeof a=="undefined"?this.autoScrollSpeed:a,this.autoPlay&&this._autoPlay&&(this.timer=setTimeout(function(){b.displayNext()},a))},doAnimate:function(a,b,c){var d=this,e=this.$pointer;this.setFront(b),c?(a.animate({opacity:0},this.config.animateSpeed),b.animate({opacity:1},this.config.animateSpeed,function(){b.css("filter","")})):(e.hide(),a.animate({opacity:0},this.config.animateSpeed),b.animate({opacity:1},this.config.animateSpeed,function(){b.css("filter",""),e.show()}))},setFront:function(a){var b,c;for(b=0,c=this.slides.length;b<c;b++)this.slides[b].css({"z-index":-100});var d=typeof a=="number"?this.getSlide(a):a;d.css({"z-index":0})},loadImage:function(a,b,c,d){var e=this.getSlideImage(a);b&&b.length>0&&(e.bind("load.animate",{self:this,index:a},b[0]),e.bind("load.action",{self:this,index:a},b[1]),e.bind("load.scroll",{self:this,index:a},b[2])),c&&e.bind("error",{self:this,index:a},c),d&&(this.timeoutId=setTimeout(d,this.timeout)),e[0].src=e.attr("lazysrc")},clearLoadTimout:function(){clearTimeout(this.timeoutId),this.timeoutId=null},getSlide:function(a){return this.slides[a]},getSlideImage:function(a){return this.getSlide(a).find("img")}}),a.fn.ImgSlide=function(b){return this.each(function(){a(this).data("imgslide",new c(this,b))})}})(jQuery)