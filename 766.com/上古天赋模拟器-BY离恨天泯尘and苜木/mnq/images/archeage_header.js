(function(a){ArcheAge.namespace("ListForMain");ArcheAge.ListForMain=Class.extend({init:function(){this.url=ArcheAge.domains.www+"/ajax/mainlist";this.bannerObj=a("#eventBanner");this.noticeObj=a("#mainNotice");this.eventWinnerObj=a("#eventWinner");this.getData();this.bindClientDownBtn()},getData:function(){var b=this;a.ajax({url:b.url,dataType:"jsonp",timeout:2E3,type:"get",crossDomain:!0,disableGlobalErrorProcessor:!0,error:function(){}}).done(function(a){b.data=a.data;b.showData();new ArcheAge.ListForMain.EventBanner(b.bannerObj)})},
showData:function(){a("#noticeTmpl").tmpl(this.data).appendTo(this.noticeObj);a("#eventBannerTmpl").tmpl(this.data).appendTo(this.bannerObj);a("#eventWinnerTmpl").tmpl(this.data).appendTo(this.eventWinnerObj);a("#asideArea").show()},bindClientDownBtn:function(){a("#clientDownBtn").on("click",function(b){b.preventDefault();location.href="http://download.xlgames.gscdn.com/cbt5/install/SetupArcheAge.exe"})}});ArcheAge.ListForMain.EventBanner=Class.extend({init:function(b){this.$obj=b;this.$imgArea=this.$obj.find(".img_area");
this.$btnAreaObj=this.$obj.find(".page_num > a");b=this.getRandomValue();this.hideAll();this.$imgArea.eq(b).show();this.$btnAreaObj.eq(b).addClass("active");this.btnInit()},hideAll:function(){this.$imgArea.hide();this.$btnAreaObj.each(function(){a(this).removeClass()})},btnInit:function(){var b=this;b.$btnAreaObj.on("click",function(c){c.preventDefault();b.hideAll();a(this).addClass("active");var d=b.$btnAreaObj.index(a(this));b.$imgArea.each(function(b){b==d&&a(this).show()})})},getRandomValue:function(){var b=
this.$imgArea.length;return(Math.floor(10*Math.random())+1)%b}});ArcheAge.namespace("Common.LnbTopMenu");ArcheAge.Common.LnbTopMenu=Class.extend({init:function(){this.data=null;this.bindNoticeTabButton();this.bindUpdateTabButton()},bindNoticeTabButton:function(){a("#noticeTab").click(function(b){b.preventDefault();a("#mainNotice").css("display","");a("#updateNotice").css("display","none");a("#updateList").removeClass("active");a("#noticeList").addClass("active")})},bindUpdateTabButton:function(){var b=
this;a("#updateTab").click(function(c){c.preventDefault();null==b.data&&a.ajax({url:ArcheAge.domains.www+"/ajax/updatelist",type:"GET",dataType:"jsonp",crossDomain:!0,disableGlobalErrorProcessor:!0,error:function(b,a){console.log("local error="+b.responseText+",textStatus="+a)},success:function(a){b.data=a.data;b.showData()}});a("#mainNotice").css("display","none");a("#updateNotice").css("display","");a("#noticeList").removeClass("active");a("#updateList").addClass("active")})},showData:function(){a("#updateTmpl").tmpl(this.data).appendTo(a("#updateNotice"))}});
ArcheAge.namespace("Common.GnbTopMenu");ArcheAge.Common.GnbTopMenu=Class.extend({init:function(){this.$navi=a("#navi");this.$gnbListWrap=a(".gnb_list_wrap",this.$navi);this.$accountUtil=a("#account_util");this.$characterLayer=a(".account_character_layer",this.$accountUtil);this.$expeditionLayer=a("#expeditionLayer",this.$accountUtil);this.bindMenuToggleButton();this.bindAccountUtilCharacterButton();this.bindAccountUtilExpeditionButton()},start:function(){(new ArcheAge.Account.GnbLogin(a("form[name='authenticate']",
this.$accountUtil))).processSubmit();ArcheAge.Web.isLogined()&&((new ArcheAge.Notification.Perception(a("#alimLayer",this.$accountUtil),ArcheAge.LoginUser.ArticleChannel)).process(),null!=ArcheAge.LoginUser.representativeUserCharacter&&this.getNewMessageCount())},bindMenuToggleButton:function(){var b=this;a("a.toggle_btn",b.$navi).focus(function(){this.blur()}).click(function(c){var d=a(this);c.preventDefault();b.$gnbListWrap.toggle();"block"==b.$gnbListWrap.css("display")&&(d.unbind("clickoutside"),
d.bind("clickoutside",function(){b.$gnbListWrap.hide()}))})},bindAccountUtilCharacterButton:function(){var b=this;a("a.character_inner",b.$accountUtil).focus(function(){this.blur()}).click(function(c){var d=a(this);c.preventDefault();b.$characterLayer.toggle();"block"==b.$characterLayer.css("display")&&(d.unbind("clickoutside"),d.bind("clickoutside",function(){b.$characterLayer.hide()}))})},bindAccountUtilExpeditionButton:function(){var b=this;a("a.expeditionBtn",b.$accountUtil).focus(function(){this.blur()}).click(function(c){var d=
a(this);c.preventDefault();"block"==b.$expeditionLayer.css("display")?b.$expeditionLayer.hide():(b.showExpeditionHistory(),d.unbind("clickoutside"),d.bind("clickoutside",function(){b.$expeditionLayer.hide()}))})},showExpeditionHistory:function(){var b=this;a.ajax({dataType:"json",url:ArcheAge.domains.play+"/api/accounts/"+ArcheAge.LoginUser.encrytedAccountNo+"/expeditions?callback=?",type:"get",disableGlobalErrorProcessor:!0,error:function(){},success:function(a){b.$expeditionLayer.html(b.createHtmlExpeditions(a));
b.$expeditionLayer.show()}})},createHtmlExpeditions:function(b){var c="";0==b.length?c='<li class="empty"><p>가입한 원정대가 없습니다.</p></li>':a.each(b,function(b,a){c+='<li><a href="'+ArcheAge.domains.play+"/expeditions/"+a.expeditionId.serverCode+"/"+a.expeditionId.id+'"><div class="cont">'+a.name+'<em class="server">@'+a.expeditionId.serverName+"</em></div></a></li>"});return'<div class="box"><ul class="list">'+c+'</ul></div><i class="tail top"><i class="tail_outer"></i><i class="tail_inner"></i></i>'},
getNewMessageCount:function(){var b=this;a.ajax({url:ArcheAge.LoginUser.representativeUserCharacter.network+"/participants/count/ajax?callback=?",type:"get",dataType:"jsonp",disableGlobalErrorProcessor:!0,error:function(){},success:function(c){"undefined"!=typeof c&&0<c&&(c=a('<em class="new"><span class="message_count">'+c+'</span><span class="txt_hidden">개</span></em>'),a(".msg",b.$accountUtil).after(c))}})}})})(jQuery);