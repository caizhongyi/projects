(function(b){ArcheAge.namespace("CommonUI");ArcheAge.CommonUI.LoginUserCharacterSelector=Class.extend({init:function(a,d){null===a||0===a.length||(this.$charSelector=a,this.$charImgSelector=d,this.$selectedInfo=b(".btn_sel",this.$charSelector),this.$selectedUuidField=b(".selected_uuid",this.$charSelector),this.$characters=b("ul.list li a",this.$charSelector),this.bind())},bind:function(){this.bindToggleSelector();this.bindCharacters()},bindToggleSelector:function(){var a=this;a.$charSelector.bind("clickoutside",
function(){a.hideList()});a.$selectedInfo.bind("click",function(b){try{ArcheAge.Web.CharacterTooltip.hide()}catch(c){}b.stopPropagation();a.toggleList();return!1})},hideList:function(){"undefined"!=typeof this.$charSelector&&(this.$charSelector.removeClass("open"),b(".oldie-zIndex").removeClass("oldie-zIndex"))},toggleList:function(){this.$charSelector.hasClass("open")?this.hideList():(b(".comment_character_selector").hasClass("open")&&(b(".comment_character_selector").removeClass("open"),b(".oldie-zIndex").removeClass("oldie-zIndex")),
this.$charSelector.addClass("open"),this.$charSelector.parents().each(function(){"static"!=b(this).css("position")&&b(this).addClass("oldie-zIndex")}))},bindCharacters:function(){var a=this;a.$characters.bind("click",function(){a.select(b(this));return!1})},select:function(a){var b=a.find(".char_name").text(),c=a.find(".server").text(),e=a.data("uuid"),a=a.data("profileimg");this.$charSelector.attr("data-uuid",e);this.$selectedInfo.find(".char_name").text(b);this.$selectedInfo.find(".server").text(c);
this.$selectedUuidField.val(e);void 0!==this.$charImgSelector&&this.$charImgSelector.attr("src",a);this.refineListView(e);this.toggleList()},refineListView:function(a){this.$characters.each(function(){var d=b(this);d.data("uuid")===a?d.parent("li").hide():d.parent("li").show()})}});ArcheAge.CommonUI.filestyle=function(a,d){if(!(b.browser.msie&&7>=b.browser.version)){var d=b.extend({height:"20px",inputTextWidth:"200px",inputTextClass:"",buttonClass:""},d),c,e=b('<span style="display: inline-block;vertical-align:middle;overflow:hidden;" class="inp_txt" readonly="readonly"></span> '),
f=b('<button type="button" class="btn">찾아보기</button>');e.css("height",d.height).css("padding",0);b.browser.msie?(c=b('<div style="display:inline-block; position:relative;"></div>'),a.wrap(c).css({position:"absolute",top:"0",left:"0",width:"100%",overflow:"hidden",height:d.height,"font-size":"200px",opacity:"0",cursor:"pointer"})):(a.css("left","-9999px").css("position","absolute").css("top","0"),e.on("click",function(){a.trigger("click")}),f.on("click",function(){a.trigger("click")}));e.css("width",
d.inputTextWidth);e.addClass(d.inputTextClass);f.addClass(d.buttonClass);a.bind("change",function(){var b=a.val().substring(a.val().lastIndexOf("\\")+1);e.text(b)});a.after(f).after("&nbsp;").after(e)}};ArcheAge.CommonUI.Accusation=Class.extend({init:function(a){if(1!==a.length)throw"신고 버튼 링크는 하나만 허용됩니다.";this.$accusationLink=a;this.accusationTargetType=this.$accusationLink.data("accusationTargetType");this.targetIndicator=this.$accusationLink.data("targetIndicator");this.summary=this.$accusationLink.data("summary");
this.comment=this.$accusationLink.data("comment");this.$form=null;this.bindAccusation()},bindAccusation:function(){var a=this;a.$accusationLink.on("click",function(){a.showForm();return!1})},showForm:function(){null===this.$form&&(this.$form=b(ArcheAge.CommonUI.Accusation.FORM),this.$accusationTypeRadioButton=b('input[name="accusationType"]',this.$form),this.$reasonArea=b(".accusation_direct_input, .accusation_direct_write",this.$form),this.$reasonField=b('input[name="reason"]',this.$form),this.$reasonError=
b(".accusation_direct_write",this.$form),this.bindForm(),b("body").append(this.$form),b("section",this.$form).aaModalDialog({zIndex:5E4}),b("section",this.$form).aaModalDialog("open"))},bindForm:function(){var a=this;b('input[name="accusationTargetType"]',a.$form).val(a.accusationTargetType);b('input[name="targetIndicator"]',a.$form).val(a.targetIndicator);b('input[name="summary"]',a.$form).val(a.summary);b('input[name="comment"]',a.$form).val(a.comment);a.bindFormButtons();a.bindReasonInput();a.$form.ajaxForm({url:"/accusation",
type:"post",dataType:"json",beforeSerialize:function(){return!a.isEtcChecked()?(a.$reasonField.val(""),!0):!a.checkValidReason()?!1:!0},success:function(b){a.hideForm();a.preventAccusation();"success"===b.result?ArcheAge.alert(AL10N.Accusation.success()):ArcheAge.alert(AL10N.Accusation.fail())}})},checkValidReason:function(){var a=b.trim(this.$reasonField.val()).length;if(5>a||20<a)return this.showReasonWarning(),!1;this.hideReasonWarning();return!0},bindFormButtons:function(){var a=this;b("button.close",
a.$form).on("click",function(){a.hideForm();return!1});a.$form.on("clickoutside",function(){a.hideForm();return!1});a.$accusationTypeRadioButton.on("change",function(){a.isEtcChecked()?(a.$reasonArea.show(),a.$reasonField.focus()):(a.$reasonField.val(""),a.$reasonArea.hide())})},bindReasonInput:function(){var a=this;a.$reasonField.on("keyup",function(){a.checkValidReason();return!0})},showReasonWarning:function(){this.$reasonError.show()},hideReasonWarning:function(){this.$reasonError.hide()},isEtcChecked:function(){return b("#accusationTypeEtc",
this.$form).is(":checked")},hideForm:function(){b("section",this.$form).aaModalDialog("destroy");this.$form.remove();this.$form=null},preventAccusation:function(){this.$accusationLink.unbind("click");this.$accusationLink.on("click",function(){ArcheAge.alert(AL10N.Accusation.fail());return!1})}});ArcheAge.CommonUI.Accusation.FORM='<form id="accusationForm" class="reportPop">\n    <input type="hidden" name="accusationTargetType" value=""/>\n    <input type="hidden" name="targetIndicator" value=""/>\n    <input type="hidden" name="summary" value=""/>\n    <input type="hidden" name="comment" value=""/>\n\n    <section class="layer_comm v2">\n    <div class="head">\n        <h2>신고하기</h2>\n        <button type="button" class="ico_comm close" title="닫기"></button>\n    </div>\n    <div class="cont">\n        <div class="wrap_row">\n            <div class="row">\n                <input id="accusationTypeSpam" type="radio" name="accusationType" value= "SPAM" checked />\n                <label for="accusationTypeSpam"><strong>광고/스팸</strong> (주먹을 부르는 글!)</label>\n            </div>\n            <div class="row">\n                <input id="accusationTypeInsult" type="radio" name="accusationType" value= "INSULT" />\n                <label for="accusationTypeInsult"><strong>욕설/비방</strong> (어글은 모두 내꺼!)</label>\n            </div>\n            <div class="row">\n                <input id="accusationTypeObscen" type="radio" name="accusationType" value= "OBSCENE" />\n                <label for="accusationTypeObscen"><strong>음란/선정</strong> (어머! 우리 아이가 보고 있어요~)</label>\n            </div>\n            <div class="row">\n                <input id="accusationTypeEtc" type="radio" name="accusationType" value="ETC" />\n                <label for="accusationTypeEtc"><strong>직접작성</strong></label>\n                <span class="accusation_direct_input" style="display:none;">\n                    <input id="accusation_etc_reason" type="text" class="inp_txt reason" name="reason" maxlength="20" value="" />\n                </span>\n                <div class="accusation_direct_write" style="display:none;">\n                    <label class="error error_reason" for="accusation_etc_reason">\n                        <i class="ico_comm alert"></i>\n                        <span>5~20자 사이로 입력해 주세요.</span>\n                    </label>\n                </div>\n            </div>\n        </div>\n        <ul class="list">\n            <li>꼭 필요한 경우에만 신고하기를 이용해 주세요.</li>\n        </ul>\n    </div>\n    <div class="wrap_btn">\n        <button type="submit" class="accsationDo btn big">신고</button>\n    </div>\n</section>\n</form>';
ArcheAge.CommonUI.Accusation.instanciate=function(a){a.each(function(){new ArcheAge.CommonUI.Accusation(b(this))})};ArcheAge.CommonUI.SNSButtons=Class.extend({init:function(a){this.buttons=b.extend({},{$facebook:b("#snsbutton_facebook"),$twitter:b("#snsbutton_twitter"),$me2day:b("#snsbutton_me2day")},a);this.clearButtons();this._bindFacebook(this.buttons.$facebook);this._bindTwitter(this.buttons.$twitter);this._bindMe2day(this.buttons.$me2day)},clearButtons:function(){for(var a in this.buttons)this.buttons.hasOwnProperty(a)&&
this.buttons[a].unbind("click")},_bindFacebook:function(a){var b=this;if(0!==a.length)a.on("click",function(){var c=b._getTitle(a),e=b._getShareUrl(a),c="http://www.facebook.com/sharer.php?u="+encodeURI(e)+"&t="+encodeURI(c);window.open(c,"share_on_facebook","width=640,height=300,scrollbars=0,resizable=1");return!1})},_bindTwitter:function(a){var b=this;if(0!==a.length)a.on("click",function(){var c=b._getTitle(a),e=b._getShareUrl(a),c="http://twitter.com/share?lang=ko&url="+encodeURI(e)+"&text="+
encodeURI(c);window.open(c,"share_on_twitter","width=640,height=260,scrollbars=1,resizable=1");return!1})},_bindMe2day:function(a){var b=this;if(0!==a.length)a.on("click",function(){var c=b._getTitle(a),e=b._getShareUrl(a),c="http://me2day.net/posts/new?new_post[body]="+encodeURI('"'+c+'"')+":"+encodeURI(e);window.open(c,"share_on_me2day","width=1024,height=364,scrollbars=1,resizable=1");return!1})},_getTitle:function(a){return a.data("title")},_getShareUrl:function(a){return a.attr("href")},setTitleAndShareUrl:function(a,
b){for(var c in this.buttons)this.buttons.hasOwnProperty(c)&&(this.buttons[c].data("title",a),this.buttons[c].attr("href",b))}});ArcheAge.namespace("CommonUI.Menubar");ArcheAge.CommonUI.Menubar=Class.extend({init:function(){this.$menuBar=b("#account_util");this._bindNewMessageCount()},_bindNewMessageCount:function(){var a=this;try{b.ajax({url:ArcheAge.LoginUser.representativeUserCharacter.network+"/participants/count/ajax?callback=?",type:"get",dataType:"jsonp",disableGlobalErrorProcessor:!0,error:function(){},
success:function(c){"undefined"!=typeof c&&0<c&&(c=b('<em class="new"><span class="message_count">'+c+'</span><span class="txt_hidden">개</span></em>'),b(".msg",a.$menuBar).after(c))}})}catch(d){}}});ArcheAge.CommonUI.LoadingImage={AFTER:"after",APPEND:"append",REPLACE:"replace",$image:null,$target:null,positionType:null,$buttons:null,loading:function(a,d,c){var e=ArcheAge.Url.img("/beta/images/common/loading.gif");this.unloading();this.$image=b('<div style="width: 100%; text-align: center;"><img src="'+
e+'"/></div>');this.positionType=d;this.positionType||(this.positionType=this.AFTER);this.$target=a;this.$buttons=c;this.positionType===this.AFTER?this.$image.insertAfter(this.$target):this.positionType===this.REPLACE?(this.$image.insertAfter(this.$target),this.$target.hide()):this.$target.append(this.$image);this._makeButtonsDisabled()},_makeButtonsDisabled:function(){this.$buttons&&this.$buttons.attr("disabled","disabled")},_makeButtonsActive:function(){this.$buttons&&this.$buttons.removeAttr("disabled")},
loadingAfter:function(a,b){this.loading(a,this.AFTER,b)},loadingAppend:function(a,b){this.loading(a,this.APPEND,b)},loadingReplace:function(a,b){this.loading(a,this.REPLACE,b)},unloading:function(){null!==this.$image&&(this.$image.remove(),this.positionType!==this.AFTER&&this.positionType===this.REPLACE&&this.$target.show(),this._makeButtonsActive(),this.$image=null,this.positionType=!1,this.$target=null)}};ArcheAge.CommonUI.loginRequired=function(a){a||(a=b(".loginRequired"));a.off("click").on("click",
function(a){a.preventDefault();ArcheAge.alert(AL10N.Global.loginRequired())})};ArcheAge.CommonUI.characterRequired=function(a){a||(a=b(".characterRequired"));a.off("click").on("click",function(a){a.preventDefault();ArcheAge.alert(AL10N.Global.characterRequired())})};ArcheAge.CommonUI.bindTopButton=function(){var a=b(".btn_top");a.hide();b(window).on("scroll",function(){a.show();b(window).off("scroll")});a.on("click",function(a){a.preventDefault();window.scroll(0,0);return!1})};ArcheAge.namespace("CommonUI.Message");
ArcheAge.CommonUI.Message.dialog={width:425,height:504,draggable:!1,resizable:!1,modal:!0,position:"center"};ArcheAge.CommonUI.Message.gamedialog={width:430,height:340,draggable:!1,resizable:!1,modal:!0,position:"center"};ArcheAge.CommonUI.jqueryUiDialog=function(a,d){b(".ui-dialog").removeClass("ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable");b(".ui-dialog").css({padding:"0em",overflow:""});b(".ui-dialog-titlebar",a.parent()).remove();b(".m_head",a).addClass("ui-dialog-titlebar").css({padding:"0"});
b(".ui-widget-overlay").css({background:"none","z-index":"1001","background-color":"black",height:"100%",width:"100%",left:"0",top:"0",position:"fixed",opacity:"0.7"});a.removeClass("ui-dialog-content ui-widget-content");a.css({"margin-left":"0px","margin-top":"0px",height:d+"px"});if("expeditions"==ArcheAge.currentMenu){var c=b("#container").height()/2-ArcheAge.CommonUI.Message.dialog.height/2;b(".ui-dialog").css({top:c+"px"})}ArcheAge.isArcheAgeBrowser&&b(".ui-dialog").css({top:"100px",height:d})};
ArcheAge.CommonUI.Message.showfrom=function(a){if(ArcheAge.LoginUser.isRestrictedAccount)return ArcheAge.alert(AL10N.Notice.restrictedAccount()),!1;var d=ArcheAge.CommonUI.Message.dialog,a="/message/form/ajax?targetUuid="+a,c=b('<div class="ig_msglayer"/>');ArcheAge.isArcheAgeBrowser&&(d=ArcheAge.CommonUI.Message.gamedialog);b.ajax({dataType:"html",url:a,type:"get",success:function(a){b("body").find(".ig_msglayer").remove();var a=b(a),f=b('<div class="simpleMessageDiv" id="simpleMessageDiv"/>');c.html(f.html(a)).dialog(d);
ArcheAge.isArcheAgeBrowser&&c.css({"z-index":"2000"});ArcheAge.CommonUI.jqueryUiDialog(c,d.height);ArcheAge.CommonUI.Message.bindSendButton();new ArcheAge.CommonUI.LoginUserCharacterSelector(b(".message_character_selector",c));c.find(".m_btn_close").unbind("click").bind("click",function(){c.dialog("destroy").remove();b(".ui-widget-overlay").remove()});var g=b(".textLengthSpan",c);b("#contents",c).autogrow();b(".m_inp_msg",c).unbind("keydown").bind("keydown",function(){var a=b(this).val().length;g.text(a);
300<a?g.css("color","red"):g.css("color","");b(".error").is(":visible")&&b(".error").hide()})},error:function(){}});return!1};ArcheAge.CommonUI.Message.bindSendButton=function(){var a=b(".ig_msglayer"),d;a.find(".sendBtn").on("click",function(){d=b(this);ArcheAge.isArcheAgeView&&(clientObject.JavaCallbackRequestData(),b("#mapPositionX").val(clientObject.posX),b("#mapPositionY").val(clientObject.posY),b("#mapPositionId").val(clientObject.zoneId),b("#mapPositionWorld").val(clientObject.world));var c;
c=b.trim(b(".m_inp_msg",a).val());if(0==c.length)b(".error_m_content",a).show(),c=!1;else if(300<c.length){var e=b(".textLengthSpan",a);e.text(c.length);e.css("color","red");c=!1}else d.unbind("click"),c=!0;if(!c)return!1;d.hide();b("#sendWait").show();b("#messageCreateForm",a).ajaxSubmit({dataType:"json",type:"post",cache:!1,success:function(a){if("success"==a.result){try{b(".ig_msglayer").dialog("destroy").remove()}catch(c){b(".ig_msglayer").remove()}b(".ui-widget-overlay").remove()}},error:function(a,
b){ArcheAge.alert(b)}})})}})(jQuery);