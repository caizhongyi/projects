<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>系统首页</title>

    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

  </head>

  <body>
  <table id="dg" toolbar="#tb"  pagination="true" sortName="id" sortOrder="desc" title="广告" fitColumns="true" class="datagrid">
      <thead>
      <tr>
          <th data-options="field:'ck',checkbox:true">删除</th>
          <th field="id" width="80">Item ID</th>
          <th field="name" width="100">Product ID</th>
          <th field="code" align="right" width="80">List Price</th>
          <th field="addr" align="right" width="80">Unit Cost</th>
      </tr>
      </thead>
  </table>
  <a href="javascript:void(0);" class="easyui-linkbutton" >提交</a>
  <div id="tb" style="padding:5px; height:auto; display: none">
      <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="User.showWindow();">添加</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="remove()">Remove</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="accept()">Accept</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true" onclick="reject()">Reject</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true" onclick="getChanges()">GetChanges</a>
        用户名：<input type="text"  class="">
      <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="User.query();">查询</a>
  </div>

  <div id="display-div" style="display: none">
        <div id="user-window" class="easyui-dialog" title="添加用户" style="padding:10px 20px;width:300px;" buttons="#user-buttons"
             iconCls="icon-add" modal="true" closed="true">
            <form id="adv-form" method="post" class="form">
                <table width="100%" cellspacing="5">
                    <tr>
                        <td align="right" width="120">用户组：</td>
                        <td><select class="easyui-combobox" name="" id=""></select></td>
                    </tr>
                    <tr>
                        <td align="right" >用户名：</td>
                        <td><input type="text"></td>
                    </tr>

                </table>
            </form>
        </div>

        <div id="user-buttons">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="User.add();">确定</a>
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#user-window').dialog('close');">取消</a>
        </div>
    </div>


  <script type="text/javascript" src="common/easyui/datagrid-detailview.js"></script>
  <script type="text/javascript">

      $(function(){
          $('#dg').datagrid({
              url:'data/grid.json',
              view: detailview,
              singleSelect : 0,
              detailFormatter:function(index,row){
                  return '<div id="ddv-' + index + '" style="padding:5px 0"></div>';
              },

              onExpandRow: function(index,row){
                  $('#ddv-'+index).panel({
                      height:80,
                      border:false,
                      cache:false,
                      href:'datagrid21_getdetail.php?itemid='+row.itemid,
                      onLoad:function(){
                          $('#dg').datagrid('fixDetailRowHeight',index);
                      }
                  });
                  $('#dg').datagrid('fixDetailRowHeight',index);
              }
          });
      });

      var User = {
          showWindow: function() {
              $('#user-window').dialog('open');
          },

          add: function() {
              $.ajax({
                  url: 'action/add.jsp',
                  type: 'get',
                  success: function(data) {
                      $.messager.alert('操作提示', "添加成功", 'info');

                      $('#user-window').dialog('close');
                      $('#user-geid').datagrid("reload");
                      $.messager.alert('错误提示', "添加失败", 'error', function() {
                          alert("点击了失败后的按钮");
                      });
                  }
              });

              /*$('#user-form').form('submit', {
               url: 'action/add.jsp',
               onSubmit : function() {
               return $(this).form('validate');
               },
               success : function(data) {
               alert(data);
               }
               });*/
          },

          query: function() {
              $('#user-geid').datagrid("reload", {id: 1, name: "aaa"});
          }
      };
  </script>
  <script type="text/javascript">
      var editIndex = undefined;
      function endEditing(){
          if (editIndex == undefined){return true}
          if ($('#dg').datagrid('validateRow', editIndex)){
              var ed = $('#dg').datagrid('getEditor', {index:editIndex,field:'id'});
              var productname = $(ed.target).combobox('getText');
              $('#dg').datagrid('getRows')[editIndex]['productname'] = productname;
              $('#dg').datagrid('endEdit', editIndex);
              editIndex = undefined;
              return true;
          } else {
              return false;
          }
      }
      function onClickRow(index){
          if (editIndex != index){
              if (endEditing()){
                  $('#dg').datagrid('selectRow', index)
                          .datagrid('beginEdit', index);
                  editIndex = index;
              } else {
                  $('#dg').datagrid('selectRow', editIndex);
              }
          }
      }
      function append(){
          if (endEditing()){
              $('#dg').datagrid('appendRow',{status:'P'});
              editIndex = $('#dg').datagrid('getRows').length-1;
              $('#dg').datagrid('selectRow', editIndex)
                      .datagrid('beginEdit', editIndex);
          }
      }
      function remove(){
          if (editIndex == undefined){return}
          $('#dg').datagrid('cancelEdit', editIndex)
                  .datagrid('deleteRow', editIndex);
          editIndex = undefined;
      }
      function accept(){
          if (endEditing()){
              $('#dg').datagrid('acceptChanges');
          }
      }
      function reject(){
          $('#dg').datagrid('rejectChanges');
          editIndex = undefined;
      }
      function getChanges(){
          var rows = $('#dg').datagrid('getChanges');
          alert(rows.length+' rows are changed!');
      }
  </script>
  </body>
</html>
