<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>系统首页</title>

    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

  </head>

  <body>
  <table id="dg" class="easyui-datagrid" title="Row Editing DataGrid"
         data-options="
                iconCls: 'icon-edit',
                singleSelect: false,
                toolbar: '#tb',
                url: 'data/grid.json',
                onClickRow: onClickRow,
                pagination : true,
                sortName:'id',
                sortOrder:'desc'
            ">
      <thead>
      <tr>
          <th data-options="field:'ck',checkbox:true">Item ID</th>
          <th data-options="field:'id',width:80">Item ID</th>
          <th data-options="field:'code',width:100,
                        formatter:function(value,row){
                            return row.code;
                        },
                        editor:{
                            type:'combobox',
                            options:{
                                valueField:'productid',
                                textField:'productname',
                                url:'data/products.json',
                                required:true
                            }
                        }">Product</th>
          <th data-options="field:'name',width:80,align:'right',editor:{type:'numberbox',options:{precision:1}}">List Price</th>
          <th data-options="field:'addr',width:80,align:'right',editor:'numberbox'">Unit Cost</th>
      </tr>
      </thead>
  </table>

  <div id="tb" style="height:auto">
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="append()">Append</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="remove()">Remove</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="accept()">Accept</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-undo',plain:true" onclick="reject()">Reject</a>
      <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search',plain:true" onclick="getChanges()">GetChanges</a>
  </div>

  <script type="text/javascript">
      var editIndex = undefined;
      function endEditing(){
          if (editIndex == undefined){return true}
          if ($('#dg').datagrid('validateRow', editIndex)){
              var ed = $('#dg').datagrid('getEditor', {index:editIndex,field:'code'});

              var productname = $(ed.target).combobox('getText');
              $('#dg').datagrid('getRows')[editIndex]['code'] = productname;
              $('#dg').datagrid('endEdit', editIndex);
              editIndex = undefined;
              return true;
          } else {
              return false;
          }
      }
      function onClickRow(index){
          if (editIndex != index){
              if (endEditing()){
                  $('#dg').datagrid('selectRow', index)
                          .datagrid('beginEdit', index);
                  editIndex = index;
              } else {
                  $('#dg').datagrid('selectRow', editIndex);
              }
          }
      }
      function append(){
          if (endEditing()){
              $('#dg').datagrid('appendRow',{status:'P'});
              editIndex = $('#dg').datagrid('getRows').length-1;
              $('#dg').datagrid('selectRow', editIndex)
                      .datagrid('beginEdit', editIndex);
          }
      }
      function remove(){
          if (editIndex == undefined){return}
          $('#dg').datagrid('cancelEdit', editIndex)
                  .datagrid('deleteRow', editIndex);
          editIndex = undefined;
      }
      function accept(){
          if (endEditing()){
              $('#dg').datagrid('acceptChanges');
          }
      }
      function reject(){
          $('#dg').datagrid('rejectChanges');
          editIndex = undefined;
      }
      function getChanges(){
          var rows = $('#dg').datagrid('getChanges');
          alert(rows.length+' rows are changed!');
      }
  </script>
  </body>
</html>
