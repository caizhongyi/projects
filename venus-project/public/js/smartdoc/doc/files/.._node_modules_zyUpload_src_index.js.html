<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..\node_modules\zyUpload\src\index.js - SmartDoc</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="https://github.com/zhh77/smartdoc">
             
            <img alt="SmartDoc" src="../assets/css/logo.png" title="SmartDoc">
            
                SmartDoc
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="https://github.com/zhh77/smartdoc">Home</a>
                    </li>
                    
                    <li><a href="/">Document</a>
                    </li>
                    
                    <li><a href="https://github.com/zhh77/smartdoc">About</a>
                    </li>
                    
                </ul>
               <div class="navbar-form navbar-right filterAPi" autocomplete="off">
                <input type="text" id='txtSearchAPI' class="form-control search-query" placeholder="Search for API" />
                 <ul id="filterList" class="filterItems dropdown-menu" role="menu"></ul>
                </div>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>Modules/Classes</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to filter Modules/Classes">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/273.html">273</a>
                </dt>
                <dd>
                    <ul>
                   
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/alienjs.html">alienjs</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/window.require.html">window.require</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Countdown.html">Countdown</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/Date.html">Date</a>
                </dt>
                <dd>
                    <ul>
                   
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/jquery.html">jquery</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/jquery.transitionEnd.html">jquery.transitionEnd</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/jquery.support.transition.html">jquery.support.transition</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/jquery.animationEnd.html">jquery.animationEnd</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/jquery-ui.html">jquery-ui</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/jquery.ajaxPanel.html">jquery.ajaxPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/jquery.dialog.html">jquery.dialog</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Array.html">Array</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/jquery.browserLowVersion.html">jquery.browserLowVersion</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/jquery.confirm.html">jquery.confirm</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/jquery.alert.html">jquery.alert</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ng.html">ng</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/EventEmitter Manages event registering and emitting..html">EventEmitter Manages event registering and emitting.</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ngMock.html">ngMock</a>
                </dt>
                <dd>
                    <ul>
                   
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ngMockE2E.html">ngMockE2E</a>
                </dt>
                <dd>
                    <ul>
                   
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ui.html">ui</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/AjaxPanel.html">AjaxPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Date.Dialog.html">Date.Dialog</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/WebUploader.html">WebUploader</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Base.html">Base</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Mediator.html">Mediator</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/options.Uploader.html">options.Uploader</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/File.File.html">File.File</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/File.Queue.html">File.Queue</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Uploader.html">Uploader</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/window.html">window</a>
                </dt>
                <dd>
                    <ul>
                   
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <!--     <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

 -->
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>..\node_modules\zyUpload\src\index.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
var ZYFILE = {
    fileInput : null,             // 选择文件按钮dom对象
    uploadInput : null,           // 上传文件按钮dom对象
    dragDrop: null,				  //拖拽敏感区域
    url : &quot;&quot;,  					  // 上传action路径
    uploadFile : [],  			  // 需要上传的文件数组
    lastUploadFile : [],          // 上一次选择的文件数组，方便继续上传使用
    perUploadFile : [],           // 存放永久的文件数组，方便删除使用
    fileNum : 0,                  // 代表文件总个数，因为涉及到继续添加，所以下一次添加需要在它的基础上添加索引
    /* 提供给外部的接口 */
    filterFile : function(files){ // 提供给外部的过滤文件格式等的接口，外部需要把过滤后的文件返回
        return files;
    },
    onSelect : function(selectFile, files){      // 提供给外部获取选中的文件，供外部实现预览等功能  selectFile:当前选中的文件  allFiles:还没上传的全部文件

    },
    onDelete : function(file, files){            // 提供给外部获取删除的单个文件，供外部实现删除效果  file:当前删除的文件  files:删除之后的文件

    },
    onProgress : function(file, loaded, total){  // 提供给外部获取单个文件的上传进度，供外部实现上传进度效果

    },
    onSuccess : function(file, responseInfo){    // 提供给外部获取单个文件上传成功，供外部实现成功效果

    },
    onFailure : function(file, responseInfo){    // 提供给外部获取单个文件上传失败，供外部实现失败效果

    },
    onComplete : function(responseInfo){         // 提供给外部获取全部文件上传完成，供外部实现完成效果

    },

    /* 内部实现功能方法 */
    // 获得选中的文件
    //文件拖放
    funDragHover: function(e) {
        e.stopPropagation();
        e.preventDefault();
        this[e.type === &quot;dragover&quot;? &quot;onDragOver&quot;: &quot;onDragLeave&quot;].call(e.target);
        return this;
    },
    // 获取文件
    funGetFiles : function(e){
        var self = this;
        // 取消鼠标经过样式
        this.funDragHover(e);
        // 从事件中获取选中的所有文件
        var files = e.target.files || e.dataTransfer.files;
        self.lastUploadFile = this.uploadFile;
        this.uploadFile = this.uploadFile.concat(this.filterFile(files));
        var tmpFiles = [];

        // 因为jquery的inArray方法无法对object数组进行判断是否存在于，所以只能提取名称进行判断
        var lArr = [];  // 之前文件的名称数组
        var uArr = [];  // 现在文件的名称数组
        $.each(self.lastUploadFile, function(k, v){
            lArr.push(v.name);
        });
        $.each(self.uploadFile, function(k, v){
            uArr.push(v.name);
        });

        $.each(uArr, function(k, v){
            // 获得当前选择的每一个文件   判断当前这一个文件是否存在于之前的文件当中
            if($.inArray(v, lArr) &lt; 0){  // 不存在
                tmpFiles.push(self.uploadFile[k]);
            }
        });

        // 如果tmpFiles进行过过滤上一次选择的文件的操作，需要把过滤后的文件赋值
        //if(tmpFiles.length!=0){
        this.uploadFile = tmpFiles;
        //}

        // 调用对文件处理的方法
        this.funDealtFiles();

        return true;
    },
    // 处理过滤后的文件，给每个文件设置下标
    funDealtFiles : function(){
        var self = this;
        // 目前是遍历所有的文件，给每个文件增加唯一索引值
        $.each(this.uploadFile, function(k, v){
            // 因为涉及到继续添加，所以下一次添加需要在总个数的基础上添加
            v.index = self.fileNum;
            // 添加一个之后自增
            self.fileNum++;
        });
        // 先把当前选中的文件保存备份
        var selectFile = this.uploadFile;
        // 要把全部的文件都保存下来，因为删除所使用的下标是全局的变量
        this.perUploadFile = this.perUploadFile.concat(this.uploadFile);
        // 合并下上传的文件
        this.uploadFile = this.lastUploadFile.concat(this.uploadFile);

        // 执行选择回调
        this.onSelect(selectFile, this.uploadFile);
        console.info(&quot;继续选择&quot;);
        console.info(this.uploadFile);
        return this;
    },
    // 处理需要删除的文件  isCb代表是否回调onDelete方法
    // 因为上传完成并不希望在页面上删除div，但是单独点击删除的时候需要删除div   所以用isCb做判断
    funDeleteFile : function(delFileIndex, isCb){
        var self = this;  // 在each中this指向没个v  所以先将this保留

        var tmpFile = [];  // 用来替换的文件数组
        // 合并下上传的文件
        var delFile = this.perUploadFile[delFileIndex];
        console.info(delFile);
        // 目前是遍历所有的文件，对比每个文件  删除
        $.each(this.uploadFile, function(k, v){
            if(delFile != v){
                // 如果不是删除的那个文件 就放到临时数组中
                tmpFile.push(v);
            }else{

            }
        });
        this.uploadFile = tmpFile;
        if(isCb){  // 执行回调
            // 回调删除方法，供外部进行删除效果的实现
            self.onDelete(delFile, this.uploadFile);
        }

        console.info(&quot;还剩这些文件没有上传:&quot;);
        console.info(this.uploadFile);
        return true;
    },
    // 上传多个文件
    funUploadFiles : function(){
        var self = this;  // 在each中this指向没个v  所以先将this保留
        // 遍历所有文件  ，在调用单个文件上传的方法
        $.each(this.uploadFile, function(k, v){
            self.funUploadFile(v);
        });
    },
    // 上传单个个文件
    funUploadFile : function(file){
        var self = this;  // 在each中this指向没个v  所以先将this保留

        var formdata = new FormData();
        formdata.append(&quot;fileList&quot;, file);
        var xhr = new XMLHttpRequest();
        // 绑定上传事件
        // 进度
        xhr.upload.addEventListener(&quot;progress&quot;,	 function(e){
            // 回调到外部
            self.onProgress(file, e.loaded, e.total);
        }, false);
        // 完成
        xhr.addEventListener(&quot;load&quot;, function(e){
            // 从文件中删除上传成功的文件  false是不执行onDelete回调方法
            self.funDeleteFile(file.index, false);
            // 回调到外部
            self.onSuccess(file, xhr.responseText);
            if(self.uploadFile.length==0){
                // 回调全部完成方法
                self.onComplete(&quot;全部完成&quot;);
            }
        }, false);
        // 错误
        xhr.addEventListener(&quot;error&quot;, function(e){
            // 回调到外部
            self.onFailure(file, xhr.responseText);
        }, false);

        xhr.open(&quot;POST&quot;,self.url, true);
        xhr.setRequestHeader(&quot;X_FILENAME&quot;, file.name);
        xhr.send(formdata);
    },
    // 返回需要上传的文件
    funReturnNeedFiles : function(){
        return this.uploadFile;
    },

    // 初始化
    init : function(){  // 初始化方法，在此给选择、上传按钮绑定事件
        var self = this;  // 克隆一个自身

        if (this.dragDrop) {
            this.dragDrop.addEventListener(&quot;dragover&quot;, function(e) { self.funDragHover(e); }, false);
            this.dragDrop.addEventListener(&quot;dragleave&quot;, function(e) { self.funDragHover(e); }, false);
            this.dragDrop.addEventListener(&quot;drop&quot;, function(e) { self.funGetFiles(e); }, false);
        }

        // 如果选择按钮存在
        if(self.fileInput){
            // 绑定change事件
            this.fileInput.addEventListener(&quot;change&quot;, function(e) {
                self.funGetFiles(e);
            }, false);
        }

        // 如果上传按钮存在
        if(self.uploadInput){
            // 绑定click事件
            this.uploadInput.addEventListener(&quot;click&quot;, function(e) {
                self.funUploadFiles(e);
            }, false);
        }
    }
};


(function($,undefined){
    $.fn.zyUpload = function(options,param){
        var otherArgs = Array.prototype.slice.call(arguments, 1);
        if (typeof options == &#x27;string&#x27;) {
            var fn = this[0][options];
            if($.isFunction(fn)){
                return fn.apply(this, otherArgs);
            }else{
                throw (&quot;zyUpload - No such method: &quot; + options);
            }
        }

        return this.each(function(){
            var para = {};    // 保留参数
            var self = this;  // 保存组件对象

            var defaults = {
                width            : &quot;700px&quot;,  					// 宽度
                height           : &quot;400px&quot;,  					// 宽度
                itemWidth        : &quot;140px&quot;,                     // 文件项的宽度
                itemHeight       : &quot;120px&quot;,                     // 文件项的高度
                url              : &quot;/upload/UploadAction&quot;,  	// 上传文件的路径
                multiple         : true,  						// 是否可以多个文件上传
                dragDrop         : true,  						// 是否可以拖动上传文件
                del              : true,  						// 是否可以删除文件
                finishDel        : false,  						// 是否在上传文件完成后删除预览
                /* 提供给外部的接口方法 */
                onSelect         : function(selectFiles, files){},// 选择文件的回调方法  selectFile:当前选中的文件  allFiles:还没上传的全部文件
                onDelete		 : function(file, files){},     // 删除一个文件的回调方法 file:当前删除的文件  files:删除之后的文件
                onSuccess		 : function(file){},            // 文件上传成功的回调方法
                onFailure		 : function(file){},            // 文件上传失败的回调方法
                onComplete		 : function(responseInfo){}   // 上传完成的回调方法
            };

            para = $.extend(defaults,options);

            this.init = function(){
              //  this.createHtml();  // 创建组件html
                this.addEvent();
                this.createCorePlug();  // 调用核心js
            };

            /**
             * 功能：创建上传所使用的html
             * 参数: 无
             * 返回: 无
             */
            this.createHtml = function(){
                var multiple = &quot;&quot;;  // 设置多选的参数
                para.multiple ? multiple = &quot;multiple&quot; : multiple = &quot;&quot;;
                var html= &#x27;&#x27;;

                if(para.dragDrop){
                    // 创建带有拖动的html
                    html += &#x27;&lt;form id=&quot;uploadForm&quot; action=&quot;&#x27;+para.url+&#x27;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;&#x27;;
                    html += &#x27;	&lt;div class=&quot;upload_box&quot;&gt;&#x27;;
                    html += &#x27;		&lt;div class=&quot;upload_main&quot;&gt;&#x27;;
                    html += &#x27;			&lt;div class=&quot;upload_choose&quot;&gt;&#x27;;
                    html += &#x27;				&lt;div class=&quot;convent_choice&quot;&gt;&#x27;;
                    html += &#x27;					&lt;div class=&quot;andArea&quot;&gt;&#x27;;
                    html += &#x27;						&lt;div class=&quot;filePicker&quot;&gt;点击选择文件&lt;/div&gt;&#x27;;
                    html += &#x27;						&lt;input id=&quot;fileImage&quot; type=&quot;file&quot; size=&quot;30&quot; name=&quot;fileselect[]&quot; &#x27;+multiple+&#x27;&gt;&#x27;;
                    html += &#x27;					&lt;/div&gt;&#x27;;
                    html += &#x27;				&lt;/div&gt;&#x27;;
                    html += &#x27;				&lt;span id=&quot;fileDragArea&quot; class=&quot;upload_drag_area&quot;&gt;或者将文件拖到此处&lt;/span&gt;&#x27;;
                    html += &#x27;			&lt;/div&gt;&#x27;;
                    html += &#x27;			&lt;div class=&quot;status_bar&quot;&gt;&#x27;;
                    html += &#x27;				&lt;div id=&quot;status_info&quot; class=&quot;info&quot;&gt;选中0张文件，共0B。&lt;/div&gt;&#x27;;
                    html += &#x27;				&lt;div class=&quot;btns&quot;&gt;&#x27;;
                    html += &#x27;					&lt;div class=&quot;webuploader_pick&quot;&gt;继续选择&lt;/div&gt;&#x27;;
                    html += &#x27;					&lt;div class=&quot;upload_btn&quot;&gt;开始上传&lt;/div&gt;&#x27;;
                    html += &#x27;				&lt;/div&gt;&#x27;;
                    html += &#x27;			&lt;/div&gt;&#x27;;
                    html += &#x27;			&lt;div id=&quot;preview&quot; class=&quot;upload_preview&quot;&gt;&lt;/div&gt;&#x27;;
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;		&lt;div class=&quot;upload_submit&quot;&gt;&#x27;;
                    html += &#x27;			&lt;button type=&quot;button&quot; id=&quot;fileSubmit&quot; class=&quot;upload_submit_btn&quot;&gt;确认上传文件&lt;/button&gt;&#x27;;
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;		&lt;div id=&quot;uploadInf&quot; class=&quot;upload_inf&quot;&gt;&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;/div&gt;&#x27;;
                    html += &#x27;&lt;/form&gt;&#x27;;
                }else{
                    var imgWidth = parseInt(para.itemWidth.replace(&quot;px&quot;, &quot;&quot;))-15;

                    // 创建不带有拖动的html
                    html += &#x27;&lt;form id=&quot;uploadForm&quot; action=&quot;&#x27;+para.url+&#x27;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;&#x27;;
                    html += &#x27;	&lt;div class=&quot;upload_box&quot;&gt;&#x27;;
                    html += &#x27;		&lt;div class=&quot;upload_main single_main&quot;&gt;&#x27;;
                    html += &#x27;			&lt;div class=&quot;status_bar&quot;&gt;&#x27;;
                    html += &#x27;				&lt;div id=&quot;status_info&quot; class=&quot;info&quot;&gt;选中0张文件，共0B。&lt;/div&gt;&#x27;;
                    html += &#x27;				&lt;div class=&quot;btns&quot;&gt;&#x27;;
                    html += &#x27;					&lt;input id=&quot;fileImage&quot; type=&quot;file&quot; size=&quot;30&quot; name=&quot;fileselect[]&quot; &#x27;+multiple+&#x27;&gt;&#x27;;
                    html += &#x27;					&lt;div class=&quot;webuploader_pick&quot;&gt;选择文件&lt;/div&gt;&#x27;;
                    html += &#x27;					&lt;div class=&quot;upload_btn&quot;&gt;开始上传&lt;/div&gt;&#x27;;
                    html += &#x27;				&lt;/div&gt;&#x27;;
                    html += &#x27;			&lt;/div&gt;&#x27;;
                    html += &#x27;			&lt;div id=&quot;preview&quot; class=&quot;upload_preview&quot;&gt;&#x27;;
                    html += &#x27;				&lt;div class=&quot;add_upload&quot;&gt;&#x27;;
                    html += &#x27;					&lt;a style=&quot;height:&#x27;+para.itemHeight+&#x27;;width:&#x27;+para.itemWidth+&#x27;;&quot; title=&quot;点击添加文件&quot; id=&quot;rapidAddImg&quot; class=&quot;add_imgBox&quot; href=&quot;javascript:void(0)&quot;&gt;&#x27;;
                    html += &#x27;						&lt;div class=&quot;uploadImg&quot; style=&quot;width:&#x27;+imgWidth+&#x27;px&quot;&gt;&#x27;;
                    html += &#x27;							&lt;img class=&quot;upload_image&quot; src=&quot;control/images/add_img.png&quot; style=&quot;width:expression(this.width &gt; &#x27;+imgWidth+&#x27; ? &#x27;+imgWidth+&#x27;px : this.width)&quot; /&gt;&#x27;;
                    html += &#x27;						&lt;/div&gt;&#x27;;
                    html += &#x27;					&lt;/a&gt;&#x27;;
                    html += &#x27;				&lt;/div&gt;&#x27;;
                    html += &#x27;			&lt;/div&gt;&#x27;;
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;		&lt;div class=&quot;upload_submit&quot;&gt;&#x27;;
                    html += &#x27;			&lt;button type=&quot;button&quot; id=&quot;fileSubmit&quot; class=&quot;upload_submit_btn&quot;&gt;确认上传文件&lt;/button&gt;&#x27;;
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;		&lt;div id=&quot;uploadInf&quot; class=&quot;upload_inf&quot;&gt;&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;/div&gt;&#x27;;
                    html += &#x27;&lt;/form&gt;&#x27;;
                }

                $(self).append(html).css({&quot;width&quot;:para.width,&quot;height&quot;:para.height});

                // 初始化html之后绑定按钮的点击事件

            };

            /**
             * 功能：显示统计信息和绑定继续上传和上传按钮的点击事件
             * 参数: 无
             * 返回: 无
             */
            this.funSetStatusInfo = function(files){
                var size = 0;
                var num = files.length;
                $.each(files, function(k,v){
                    // 计算得到文件总大小
                    size += v.size;
                });

                // 转化为kb和MB格式。文件的名字、大小、类型都是可以现实出来。
                if (size &gt; 1024 * 1024) {
                    size = (Math.round(size * 100 / (1024 * 1024)) / 100).toString() + &#x27;MB&#x27;;
                } else {
                    size = (Math.round(size * 100 / 1024) / 100).toString() + &#x27;KB&#x27;;
                }

                // 设置内容
                $(&quot;#status_info&quot;).html(&quot;选中&quot;+num+&quot;张文件，共&quot;+size+&quot;。&quot;);
            };

            /**
             * 功能：过滤上传的文件格式等
             * 参数: files 本次选择的文件
             * 返回: 通过的文件
             */
            this.funFilterEligibleFile = function(files){
                var arrFiles = [];  // 替换的文件数组
                for (var i = 0, file; file = files[i]; i++) {
                    if (file.size &gt;= 51200000) {
                        alert(&#x27;您这个&quot;&#x27;+ file.name +&#x27;&quot;文件大小过大&#x27;);
                    } else {
                        // 在这里需要判断当前所有文件中
                        arrFiles.push(file);
                    }
                }
                return arrFiles;
            };

            /**
             * 功能： 处理参数和格式上的预览html
             * 参数: files 本次选择的文件
             * 返回: 预览的html
             */
            this.funDisposePreviewHtml = function(file, e){
                var html = &quot;&quot;;
                var imgWidth = parseInt(para.itemWidth.replace(&quot;px&quot;, &quot;&quot;))-15;

                // 处理配置参数删除按钮
                var delHtml = &quot;&quot;;
                if(para.del){  // 显示删除按钮
                    delHtml = &#x27;&lt;span class=&quot;file_del&quot; data-index=&quot;&#x27;+file.index+&#x27;&quot; title=&quot;删除&quot;&gt;&lt;/span&gt;&#x27;;
                }

                // 处理不同类型文件代表的图标
                var fileImgSrc = &quot;control/images/fileType/&quot;;
                if(file.type.indexOf(&quot;rar&quot;) &gt; 0){
                    fileImgSrc = fileImgSrc + &quot;rar.png&quot;;
                }else if(file.type.indexOf(&quot;zip&quot;) &gt; 0){
                    fileImgSrc = fileImgSrc + &quot;zip.png&quot;;
                }else if(file.type.indexOf(&quot;text&quot;) &gt; 0){
                    fileImgSrc = fileImgSrc + &quot;txt.png&quot;;
                }else{
                    fileImgSrc = fileImgSrc + &quot;file.png&quot;;
                }


                // 图片上传的是图片还是其他类型文件
                if (file.type.indexOf(&quot;image&quot;) == 0) {
                    html += &#x27;&lt;div id=&quot;uploadList_&#x27;+ file.index +&#x27;&quot; class=&quot;upload_append_list&quot;&gt;&#x27;;
                    html += &#x27;	&lt;div class=&quot;file_bar&quot;&gt;&#x27;;
                    html += &#x27;		&lt;div style=&quot;padding:5px;&quot;&gt;&#x27;;
                    html += &#x27;			&lt;p class=&quot;file_name&quot;&gt;&#x27; + file.name + &#x27;&lt;/p&gt;&#x27;;
                    html += delHtml;   // 删除按钮的html
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;a style=&quot;height:&#x27;+para.itemHeight+&#x27;;width:&#x27;+para.itemWidth+&#x27;;&quot; href=&quot;#&quot; class=&quot;imgBox&quot;&gt;&#x27;;
                    html += &#x27;		&lt;div class=&quot;uploadImg&quot; style=&quot;width:&#x27;+imgWidth+&#x27;px&quot;&gt;&#x27;;
                    html += &#x27;			&lt;img id=&quot;uploadImage_&#x27;+file.index+&#x27;&quot; class=&quot;upload_image&quot; src=&quot;&#x27; + e.target.result + &#x27;&quot; style=&quot;width:expression(this.width &gt; &#x27;+imgWidth+&#x27; ? &#x27;+imgWidth+&#x27;px : this.width)&quot; /&gt;&#x27;;
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;/a&gt;&#x27;;
                    html += &#x27;	&lt;p id=&quot;uploadProgress_&#x27;+file.index+&#x27;&quot; class=&quot;file_progress&quot;&gt;&lt;/p&gt;&#x27;;
                    html += &#x27;	&lt;p id=&quot;uploadFailure_&#x27;+file.index+&#x27;&quot; class=&quot;file_failure&quot;&gt;上传失败，请重试&lt;/p&gt;&#x27;;
                    html += &#x27;	&lt;p id=&quot;uploadSuccess_&#x27;+file.index+&#x27;&quot; class=&quot;file_success&quot;&gt;&lt;/p&gt;&#x27;;
                    html += &#x27;&lt;/div&gt;&#x27;;

                }else{
                    html += &#x27;&lt;div id=&quot;uploadList_&#x27;+ file.index +&#x27;&quot; class=&quot;upload_append_list&quot;&gt;&#x27;;
                    html += &#x27;	&lt;div class=&quot;file_bar&quot;&gt;&#x27;;
                    html += &#x27;		&lt;div style=&quot;padding:5px;&quot;&gt;&#x27;;
                    html += &#x27;			&lt;p class=&quot;file_name&quot;&gt;&#x27; + file.name + &#x27;&lt;/p&gt;&#x27;;
                    html += delHtml;   // 删除按钮的html
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;a style=&quot;height:&#x27;+para.itemHeight+&#x27;;width:&#x27;+para.itemWidth+&#x27;;&quot; href=&quot;#&quot; class=&quot;imgBox&quot;&gt;&#x27;;
                    html += &#x27;		&lt;div class=&quot;uploadImg&quot; style=&quot;width:&#x27;+imgWidth+&#x27;px&quot;&gt;&#x27;;
                    html += &#x27;			&lt;img id=&quot;uploadImage_&#x27;+file.index+&#x27;&quot; class=&quot;upload_image&quot; src=&quot;&#x27; + fileImgSrc + &#x27;&quot; style=&quot;width:expression(this.width &gt; &#x27;+imgWidth+&#x27; ? &#x27;+imgWidth+&#x27;px : this.width)&quot; /&gt;&#x27;;
                    html += &#x27;		&lt;/div&gt;&#x27;;
                    html += &#x27;	&lt;/a&gt;&#x27;;
                    html += &#x27;	&lt;p id=&quot;uploadProgress_&#x27;+file.index+&#x27;&quot; class=&quot;file_progress&quot;&gt;&lt;/p&gt;&#x27;;
                    html += &#x27;	&lt;p id=&quot;uploadFailure_&#x27;+file.index+&#x27;&quot; class=&quot;file_failure&quot;&gt;上传失败，请重试&lt;/p&gt;&#x27;;
                    html += &#x27;	&lt;p id=&quot;uploadSuccess_&#x27;+file.index+&#x27;&quot; class=&quot;file_success&quot;&gt;&lt;/p&gt;&#x27;;
                    html += &#x27;&lt;/div&gt;&#x27;;
                }

                return html;
            };

            /**
             * 功能：调用核心插件
             * 参数: 无
             * 返回: 无
             */
            this.createCorePlug = function(){
                var params = {
                    fileInput: $(&quot;#fileImage&quot;).get(0),
                    uploadInput: $(&quot;#fileSubmit&quot;).get(0),
                    dragDrop: $(&quot;#fileDragArea&quot;).get(0),
                    url: $(&quot;#uploadForm&quot;).attr(&quot;action&quot;),

                    filterFile: function(files) {
                        // 过滤合格的文件
                        return self.funFilterEligibleFile(files);
                    },
                    onSelect: function(selectFiles, allFiles) {
                        para.onSelect(selectFiles, allFiles);  // 回调方法
                        self.funSetStatusInfo(ZYFILE.funReturnNeedFiles());  // 显示统计信息
                        var html = &#x27;&#x27;, i = 0;
                        // 组织预览html
                        var funDealtPreviewHtml = function() {
                            file = selectFiles[i];
                            if (file) {
                                var reader = new FileReader()
                                reader.onload = function(e) {
                                    // 处理下配置参数和格式的html
                                    html += self.funDisposePreviewHtml(file, e);

                                    i++;
                                    // 再接着调用此方法递归组成可以预览的html
                                    funDealtPreviewHtml();
                                }
                                reader.readAsDataURL(file);
                            } else {
                                // 走到这里说明文件html已经组织完毕，要把html添加到预览区
                                funAppendPreviewHtml(html);
                            }
                        };

                        // 添加预览html
                        var funAppendPreviewHtml = function(html){
                            // 添加到添加按钮前
                            if(para.dragDrop){
                                $(&quot;#preview&quot;).append(html);
                            }else{
                                $(&quot;.add_upload&quot;).before(html);
                            }
                            // 绑定删除按钮
                            funBindDelEvent();
                            funBindHoverEvent();
                        };

                        // 绑定删除按钮事件
                        var funBindDelEvent = function(){
                            if($(&quot;.file_del&quot;).length&gt;0){
                                // 删除方法
                                $(&quot;.file_del&quot;).click(function() {
                                    ZYFILE.funDeleteFile(parseInt($(this).attr(&quot;data-index&quot;)), true);
                                    return false;
                                });
                            }

                            if($(&quot;.file_edit&quot;).length&gt;0){
                                // 编辑方法
                                $(&quot;.file_edit&quot;).click(function() {
                                    // 调用编辑操作
                                    //ZYFILE.funEditFile(parseInt($(this).attr(&quot;data-index&quot;)), true);
                                    return false;
                                });
                            }
                        };

                        // 绑定显示操作栏事件
                        var funBindHoverEvent = function(){
                            $(&quot;.upload_append_list&quot;).hover(
                                function (e) {
                                    $(this).find(&quot;.file_bar&quot;).addClass(&quot;file_hover&quot;);
                                },function (e) {
                                    $(this).find(&quot;.file_bar&quot;).removeClass(&quot;file_hover&quot;);
                                }
                            );
                        };

                        funDealtPreviewHtml();
                    },
                    onDelete: function(file, files) {
                        // 移除效果
                        $(&quot;#uploadList_&quot; + file.index).fadeOut();
                        // 重新设置统计栏信息
                        self.funSetStatusInfo(files);
                        console.info(&quot;剩下的文件&quot;);
                        console.info(files);
                    },
                    onProgress: function(file, loaded, total) {
                        var eleProgress = $(&quot;#uploadProgress_&quot; + file.index), percent = (loaded / total * 100).toFixed(2) + &#x27;%&#x27;;
                        if(eleProgress.is(&quot;:hidden&quot;)){
                            eleProgress.show();
                        }
                        eleProgress.css(&quot;width&quot;,percent);
                    },
                    onSuccess: function(file, response) {
                        $(&quot;#uploadProgress_&quot; + file.index).hide();
                        $(&quot;#uploadSuccess_&quot; + file.index).show();
                        $(&quot;#uploadInf&quot;).append(&quot;&lt;p&gt;上传成功，文件地址是：&quot; + response + &quot;&lt;/p&gt;&quot;);
                        // 根据配置参数确定隐不隐藏上传成功的文件
                        if(para.finishDel){
                            // 移除效果
                            $(&quot;#uploadList_&quot; + file.index).fadeOut();
                            // 重新设置统计栏信息
                            self.funSetStatusInfo(ZYFILE.funReturnNeedFiles());
                        }
                    },
                    onFailure: function(file) {
                        $(&quot;#uploadProgress_&quot; + file.index).hide();
                        $(&quot;#uploadSuccess_&quot; + file.index).show();
                        $(&quot;#uploadInf&quot;).append(&quot;&lt;p&gt;文件&quot; + file.name + &quot;上传失败！&lt;/p&gt;&quot;);
                        //$(&quot;#uploadImage_&quot; + file.index).css(&quot;opacity&quot;, 0.2);
                    },
                    onComplete: function(response){
                        console.info(response);
                    },
                    onDragOver: function() {
                        $(this).addClass(&quot;upload_drag_hover&quot;);
                    },
                    onDragLeave: function() {
                        $(this).removeClass(&quot;upload_drag_hover&quot;);
                    }

                };

                ZYFILE = $.extend(ZYFILE, params);
                ZYFILE.init();
            };

            /**
             * 功能：绑定事件
             * 参数: 无
             * 返回: 无
             */
            this.addEvent = function(){
                // 如果快捷添加文件按钮存在
                if($(&quot;.filePicker&quot;).length &gt; 0){
                    // 绑定选择事件
                    $(&quot;.filePicker&quot;).bind(&quot;click&quot;, function(e){
                        $(&quot;#fileImage&quot;).click();
                    });
                }

                // 绑定继续添加点击事件
                $(&quot;.webuploader_pick&quot;).bind(&quot;click&quot;, function(e){
                    $(&quot;#fileImage&quot;).click();
                });

                // 绑定上传点击事件
                $(&quot;.upload_btn&quot;).bind(&quot;click&quot;, function(e){
                    // 判断当前是否有文件需要上传
                    if(ZYFILE.funReturnNeedFiles().length &gt; 0){
                        $(&quot;#fileSubmit&quot;).click();
                    }else{
                        alert(&quot;请先选中文件再点击上传&quot;);
                    }
                });

                // 如果快捷添加文件按钮存在
                if($(&quot;#rapidAddImg&quot;).length &gt; 0){
                    // 绑定添加点击事件
                    $(&quot;#rapidAddImg&quot;).bind(&quot;click&quot;, function(e){
                        $(&quot;#fileImage&quot;).click();
                    });
                }
            };


            // 初始化上传控制层插件
            this.init();
        });
    };
})(jQuery);























    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
