module("Events",{setup:function(){this.input=$('<input type="text" value="31-03-2011">').appendTo("#qunit-fixture").datetimepicker({format:"dd-mm-yyyy"}).focus();this.dp=this.input.data("datetimepicker");this.picker=this.dp.picker},teardown:function(){this.picker.remove()}});test("Selecting a year from decade view triggers pickYear",function(){var b,a=0;this.input.on("changeYear",function(){a++});equal(this.dp.viewMode,2);b=this.picker.find(".datetimepicker-days thead th.switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datetimepicker-months").is(":visible"),"Month picker is visible");equal(this.dp.viewMode,3);datesEqual(this.dp.viewDate,UTCDate(2011,2,31));datesEqual(this.dp.date,UTCDate(2011,2,31));b=this.picker.find(".datetimepicker-months thead th.switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datetimepicker-years").is(":visible"),"Year picker is visible");equal(this.dp.viewMode,4);datesEqual(this.dp.viewDate,UTCDate(2011,2,31));datesEqual(this.dp.date,UTCDate(2011,2,31));b=this.picker.find(".datetimepicker-years tbody span:contains(2010)");b.click();equal(this.dp.viewMode,3);datesEqual(this.dp.viewDate,UTCDate(2010,2,1));datesEqual(this.dp.date,UTCDate(2011,2,31));equal(a,1)});test("Selecting a month from year view triggers pickMonth",function(){var b,a=0;this.input.on("changeMonth",function(){a++});equal(this.dp.viewMode,2);b=this.picker.find(".datetimepicker-days thead th.switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datetimepicker-months").is(":visible"),"Month picker is visible");equal(this.dp.viewMode,3);datesEqual(this.dp.viewDate,UTCDate(2011,2,31));datesEqual(this.dp.date,UTCDate(2011,2,31));b=this.picker.find(".datetimepicker-months tbody span:contains(Apr)");b.click();equal(this.dp.viewMode,2);datesEqual(this.dp.viewDate,UTCDate(2011,3,1));datesEqual(this.dp.date,UTCDate(2011,2,31));equal(a,1)});