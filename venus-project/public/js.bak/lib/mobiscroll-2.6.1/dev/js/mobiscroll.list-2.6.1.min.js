(function(c){var a=c.mobiscroll,d={invalid:[],showInput:true,inputClass:""},b=function(h){var g=c.extend({},h.settings),z=c.extend(h.settings,d,g),k=c(this),u,x,B=this.id+"_dummy",A=0,i=0,r={},p=z.wheelArray||v(k),D=t(A),l=[],o=C(p),q=f(o,A);function m(G,w,K,I){var H=0;while(H<w){var J=c(".dwwl"+H,G),s=E(I,H,K);c.each(s,function(M,L){c('.dw-li[data-val="'+L+'"]',J).removeClass("dw-v")});H++}}function E(J,G,K){var H=0,L,w=K,s=[];while(H<G){var I=J[H];for(L in w){if(w[L].key==I){w=w[L].children;break}}H++}H=0;while(H<w.length){if(w[H].invalid){s.push(w[H].key)}H++}return s}function F(G,w){var s=[];while(G){s[--G]=true}s[w]=false;return s}function t(w){var s=[],G;for(G=0;G<w;G++){s[G]=z.labels&&z.labels[G]?z.labels[G]:G}return s}function f(K,s,M){var J=0,H,I,L,N=[],G=p;if(s){for(H=0;H<s;H++){N[H]=[{}]}}while(J<K.length){N[J]=[j(G,D[J])];H=0;L=undefined;while(H<G.length&&L===undefined){if(G[H].key==K[J]&&((M!==undefined&&J<=M)||M===undefined)){L=H}H++}if(L!==undefined&&G[L].children){J++;G=G[L].children}else{if((I=e(G))&&I.children){J++;G=I.children}else{return N}}}return N}function e(H,w){if(!H){return false}var s=0,G;while(s<H.length){if(!(G=H[s++]).invalid){return w?s-1:G}}return false}function j(G,H){var w={keys:[],values:[],label:H},s=0;while(s<G.length){w.values.push(G[s].value);w.keys.push(G[s].key);s++}return w}function n(s,w){c(".dwc",s).css("display","").slice(w).hide()}function C(I){var G=[],J=I,H,w=true,s=0;while(w){H=e(J);G[s++]=H.key;if(w=H.children){J=H.children}}return G}function y(G,J){var M=[],s=p,K=0,H=false,w,L,I;if(G[K]!==undefined&&K<=J){w=0;L=G[K];I=undefined;while(w<s.length&&I===undefined){if(s[w].key==G[K]&&!s[w].invalid){I=w}w++}}else{I=e(s,true);L=s[I].key}H=I!==undefined?s[I].children:false;M[K]=L;while(H){s=s[I].children;K++;H=false;I=undefined;if(G[K]!==undefined&&K<=J){w=0;L=G[K];I=undefined;while(w<s.length&&I===undefined){if(s[w].key==G[K]&&!s[w].invalid){I=w}w++}}else{I=e(s,true);I=I===false?undefined:I;L=s[I].key}H=I!==undefined&&e(s[I].children)?s[I].children:false;M[K]=L}return{lvl:K+1,nVector:M}}function v(s){var w=[];A=A>i++?A:i;s.children("li").each(function(I){var L=c(this),M=L.clone();M.children("ul,ol").remove();var H=M.html().replace(/^\s\s*/,"").replace(/\s\s*$/,""),G=L.data("invalid")?true:false,K={key:L.data("val")||I,value:H,invalid:G,children:null},J=L.children("ul,ol");if(J.length){K.children=v(J)}w.push(K)});i--;return w}c("#"+B).remove();if(z.showInput){u=c('<input type="text" id="'+B+'" value="" class="'+z.inputClass+'" readonly />').insertBefore(k);h.settings.anchor=u;if(z.showOnFocus){u.focus(function(){h.show()})}if(z.showOnTap){h.tap(u,function(){h.show()})}}if(!z.wheelArray){k.hide().closest(".ui-field-contain").trigger("create")}return{width:50,wheels:q,headerText:false,onBeforeShow:function(s){var w=h.temp;l=w.slice(0);h.settings.wheels=f(w,A,A);x=true},onSelect:function(s,w){if(u){u.val(s)}},onChange:function(s,w){if(u&&z.display=="inline"){u.val(s)}},onClose:function(){if(u){u.blur()}},onShow:function(s){c(".dwwl",s).on("mousedown touchstart",function(){clearTimeout(r[c(".dwwl",s).index(this)])})},validate:function(G,w,J){var I=h.temp;if((w!==undefined&&l[w]!=I[w])||(w===undefined&&!x)){h.settings.wheels=f(I,null,w);var s=[],H=(w||0)+1,K=y(I,w);if(w!==undefined){h.temp=K.nVector.slice(0)}while(H<K.lvl){s.push(H++)}n(G,K.lvl);l=h.temp.slice(0);if(s.length){x=true;h.settings.readonly=F(A,w);clearTimeout(r[w]);r[w]=setTimeout(function(){h.changeWheel(s);h.settings.readonly=false},J*1000);return false}m(G,K.lvl,p,h.temp)}else{var K=y(I,I.length);m(G,K.lvl,p,I);n(G,K.lvl)}x=false}}};c.each(["list","image","treelist"],function(f,e){a.presets[e]=b;a.presetShort(e)})})(jQuery);