(function(a){var b={inputClass:"",invalid:[],rtl:false,group:false,groupLabel:"Groups"};a.mobiscroll.presetShort("select");a.mobiscroll.presets.select=function(f){var e=a.extend({},f.settings),t=a.extend(f.settings,b,e),h=a(this),G=h.prop("multiple"),x=this.id+"_dummy",r=G?(h.val()?h.val()[0]:a("option",h).attr("value")):h.val(),j=h.find('option[value="'+r+'"]').parent(),u=j.index()+"",y=u,q,A=a('label[for="'+this.id+'"]').attr("for",x),z=a('label[for="'+x+'"]'),k=t.label!==undefined?t.label:(z.length?z.text():h.attr("name")),D=[],d=[],g={},l,F,n,p,C=t.readonly,m;function E(){var i,I=0,v=[],J=[],s=[[]];if(t.group){if(t.rtl){I=1}a("optgroup",h).each(function(w){v.push(a(this).attr("label"));J.push(w)});s[I]=[{values:v,keys:J,label:t.groupLabel}];i=j;I+=(t.rtl?-1:1)}else{i=h}v=[];J=[];a("option",i).each(function(){var w=a(this).attr("value");v.push(a(this).text());J.push(w);if(a(this).prop("disabled")){D.push(w)}});s[I]=[{values:v,keys:J,label:k}];return s}function c(s,K){var J=[];if(G){var I=[],w=0;for(w in f._selectedValues){I.push(g[w]);J.push(w)}p.val(I.join(", "))}else{p.val(s);J=K?f.values[F]:null}if(K){q=true;h.val(J).trigger("change")}}function H(i){if(G&&i.hasClass("dw-v")&&i.closest(".dw").find(".dw-ul").index(i.closest(".dw-ul"))==F){var v=i.attr("data-val"),s=i.hasClass("dw-msel");if(s){i.removeClass("dw-msel").removeAttr("aria-selected");delete f._selectedValues[v]}else{i.addClass("dw-msel").attr("aria-selected","true");f._selectedValues[v]=v}if(t.display=="inline"){c(v,true)}return false}}if(t.group&&!a("optgroup",h).length){t.group=false}if(!t.invalid.length){t.invalid=D}if(t.group){if(t.rtl){l=1;F=0}else{l=0;F=1}}else{l=-1;F=0}a("#"+x).remove();p=a('<input type="text" id="'+x+'" class="'+t.inputClass+'" readonly />').insertBefore(h),a("option",h).each(function(){g[a(this).attr("value")]=a(this).text()});if(t.showOnFocus){p.focus(function(){f.show()})}if(t.showOnTap){f.tap(p,function(){f.show()})}var o=h.val()||[],B=0;for(B;B<o.length;B++){f._selectedValues[o[B]]=o[B]}c(g[r]);h.off(".dwsel").on("change.dwsel",function(){if(!q){f.setValue(G?h.val()||[]:[h.val()],true)}q=false}).hide().closest(".ui-field-contain").trigger("create");if(!f._setValue){f._setValue=f.setValue}f.setValue=function(K,O,w,s,N){var L,M=a.isArray(K)?K[0]:K;r=M!==undefined?M:a("option",h).attr("value");if(G){f._selectedValues={};var J=0;for(J;J<K.length;J++){f._selectedValues[K[J]]=K[J]}}if(t.group){j=h.find('option[value="'+r+'"]').parent();y=j.index();L=t.rtl?[r,j.index()]:[j.index(),r];if(y!==u){t.wheels=E();f.changeWheel([F]);u=y+""}}else{L=[r]}f._setValue(L,O,w,s,N);if(O){var I=G?true:r!==h.val();c(g[r],I)}};f.getValue=function(i){var s=i?f.temp:f.values;return s[F]};return{width:50,wheels:m,headerText:false,multiple:G,anchor:p,formatResult:function(i){return g[i[F]]},parseValue:function(){var s=h.val()||[],w=0;if(G){f._selectedValues={};for(w;w<s.length;w++){f._selectedValues[s[w]]=s[w]}}r=G?(h.val()?h.val()[0]:a("option",h).attr("value")):h.val();j=h.find('option[value="'+r+'"]').parent();y=j.index();u=y+"";return t.group&&t.rtl?[r,y]:t.group?[y,r]:[r]},validate:function(I,K,L){if(K===undefined&&G){var s=f._selectedValues,w=0;a(".dwwl"+F+" .dw-li",I).removeClass("dw-msel").removeAttr("aria-selected");for(w in s){a(".dwwl"+F+' .dw-li[data-val="'+s[w]+'"]',I).addClass("dw-msel").attr("aria-selected","true")}}if(K===l){y=f.temp[l];if(y!==u){j=h.find("optgroup").eq(y);y=j.index();r=j.find("option").eq(0).val();r=r||h.val();t.wheels=E();if(t.group){f.temp=t.rtl?[r,y]:[y,r];t.readonly=[t.rtl,!t.rtl];clearTimeout(n);n=setTimeout(function(){f.changeWheel([F]);t.readonly=C;u=y+""},L*1000);return false}}else{t.readonly=C}}else{r=f.temp[F]}var J=a(".dw-ul",I).eq(F);a.each(t.invalid,function(N,M){a('.dw-li[data-val="'+M+'"]',J).removeClass("dw-v")})},onBeforeShow:function(i){t.wheels=E();if(t.group){f.temp=t.rtl?[r,j.index()]:[j.index(),r]}},onMarkupReady:function(s){a(".dwwl"+l,s).on("mousedown touchstart",function(){clearTimeout(n)});if(G){s.addClass("dwms");a(".dwwl",s).eq(F).addClass("dwwms").attr("aria-multiselectable","true");a(".dwwl",s).on("keydown",function(i){if(i.keyCode==32){i.preventDefault();i.stopPropagation();H(a(".dw-sel",this))}});d={};var v;for(v in f._selectedValues){d[v]=f._selectedValues[v]}}},onValueTap:H,onSelect:function(i){c(i,true);if(t.group){f.values=null}},onCancel:function(){if(t.group){f.values=null}if(G){f._selectedValues={};var s;for(s in d){f._selectedValues[s]=d[s]}}},onChange:function(i){if(t.display=="inline"&&!G){p.val(i);q=true;h.val(f.temp[F]).trigger("change")}},onClose:function(){p.blur()}}}})(jQuery);