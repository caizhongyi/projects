!function(e){var t=function(n,r){this.options=e.extend({},t.DEFAULTS,r),this.$elem=e(n),this.page=this.options.page,this.index=this.options.index,this.debug=this.options.debug,this.init.call(this)};t.prototype={init:function(){var e=this;this.$list=this.$elem.find(this.options.list),this.resize(),this.bindEvent(),this.change(this.options.index)},console:function(e){return this.debug&&console.log(e),this},resize:function(){this.options.full&&this.$elem.height(e(window).height());var t=this.$list.children();return this.options.axis=="x"?(this.$list.width(t.length*100+"%"),t.width(1/t.length*100+"%")):this.options.axis=="y"&&(this.$list.width("auto"),t.width("auto").css("float","none")),t.height(this.$elem.height()),this},bindEvent:function(){var t={},n={},r={},i={},s=this.$elem,o=this;return this.options.resize&&e(window).off("resize.touch").on("resize.touch",function(){o.resize(),o.change(o.index)}),s.off("touchstart.touch touchmove.touch touchend.touch").on("touchstart.touch",function(e){var n=e.originalEvent;if(n.targetTouches.length>=1){var r=n.targetTouches[0];t={left:r.pageX,top:r.pageY},i=o.indexToCell(o.index),o.$list.addClass("untransition")}}),s.on("touchmove.touch",function(e){var s=e.originalEvent;if(s.changedTouches.length>=1){var u=s.changedTouches[0];n={left:u.pageX,top:u.pageY},r.left=(t.left-n.left)/o.$elem.width(),r.top=(t.top-n.top)/o.$elem.height(),o.options.axis=="y"?o.$list.css({top:-((r.top+i.row)*100)+"%"}):o.options.axis=="x"?o.$list.css({left:-((r.left+i.col)*100)+"%"}):o.$list.css({left:-((r.left+i.col)*100)+"%",top:-((r.top+i.row)*100)+"%"})}}),s.on("touchend.touch",function(e){var t=e.originalEvent;t.changedTouches.length>=1&&(o.$list.removeClass("untransition"),o.touchEnd(o.index,r),r={})}),this},change:function(e){return this.touchEnd(e,{left:0,top:0})},touchEnd:function(e,t){var n=this.indexToCell(e),r=this.totalCell(),i=.25;return t.left>=i?n.col=n.col+1>=r.col?r.col-1:n.col+1:t.left<-i&&(n.col=n.col-1<0?0:n.col-1),t.top>=i?n.row=n.row+1>=r.row?r.row-1:n.row+1:t.top<-i&&(n.row=n.row-1<0?0:n.row-1),this.console("当前位置 row :"+n.row+",col："+n.col),this.options.axis=="y"?this.$list.css({top:-n.row*this.$elem.height()}):this.options.axis=="x"?this.$list.css({left:-n.col*this.$elem.width()}):this.$list.css({left:-n.col*this.$elem.width(),top:-n.row*this.$elem.height()}),this.index=this.cellToIndex(n),this},totalCell:function(){var e=this.$list.width()/this.$elem.width(),t=this.$list.height()/this.$elem.height();return e=this.$list.width()%this.$elem.width()>5?parseInt(e)+1:parseInt(e),{row:t,col:e}},cellSize:function(){return{width:this.$elem.width(),height:this.$elem.height()}},cellToIndex:function(e){var t=this.totalCell(),n=e.row*t.col+e.col;return n},indexToCell:function(e){var t=this.totalCell(),n=parseInt(e/t.col),r=0;return e%t.col!=0&&(r=parseInt(e%t.col)),e==0?{row:0,col:0}:{row:n,col:r}},getPos:function(e){var t=this.indexToCell(e),n=t.row*this.$elem.height(),r=t.col*this.$elem.width();return{left:n,top:r}}},t.DEFAULTS={resize:!1,axis:"xy",index:0,debug:!1,list:"[data-list]"},e.fn.touchslider=function(n){var r=arguments;return e(this).each(function(){var i=e(this).data("touchslider");i||(i=new t(this,n),e(this).data("touch",i));var s=[];for(var o=1;o<r.length;o++)s.push(r[o]);var u=new Function("data","options","return data[ options ]("+s.join(",")+")");n&&i[n]&&u(i,n)})},e.fn.touchslider.Constructor=t}(window.jQuery||Zepto)
