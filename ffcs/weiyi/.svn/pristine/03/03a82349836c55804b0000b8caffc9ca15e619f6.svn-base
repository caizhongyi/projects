{template 'common/header'}
<ul class="nav nav-tabs">
	<li {if $do == 'post'}class="active"{/if}><a href="{php echo create_url('site/category/post')}">添加分类</a></li>
	<li {if $do == 'display'}class="active"{/if}><a href="{php echo create_url('site/category/display')}">管理分类</a></li>
</ul>
{if $do == 'post'}
<div class="main">
	<form action="" method="post" class="form-horizontal form" enctype="multipart/form-data">
	<input type="hidden" name="parentid" value="{$parent['id']}" />
		<h4>分类详细设置</h4>
		<table class="tb">
			{if !empty($parentid)}
			<tr>
				<th><label for="">上级分类</label></th>
				<td>
					{$parent['name']}
				</td>
			</tr>
			{/if}
			<tr>
				<th><label for="">排序</label></th>
				<td>
					<input type="text" name="displayorder" class="span6" value="{$category['displayorder']}" />
				</td>
			</tr>
			<tr>
				<th><label for="">分类名称</label></th>
				<td>
					<input type="text" name="name" class="span6" value="{$category['name']}" />
				</td>
			</tr>
			<tr>
				<th><label for="">分类描述</label></th>
				<td>
					<textarea name="description" class="span6" cols="70">{$category['description']}</textarea>
				</td>
			</tr>
			<tr>
				<th><label for="">设为栏目</label></th>
				<td>
					<label for="isshow3" class="radio inline"><input type="radio" name="isnav" value="1" id="isshow3" {if $category['nid']}checked="true"{/if} onclick="$('#style').show();"> 是</label>&nbsp;&nbsp;&nbsp;<label for="isshow4" class="radio inline"><input type="radio" name="isnav" value="0" id="isshow4"  {if empty($category['nid'])}checked="true"{/if} onclick="$('#style').hide();"> 否</label>
					<span class="help-block">设置分类为栏目时，将会显示在微站首页。同时栏目分类也可在“导航管理”中查看和修改。</span>
				</td>
			</tr>
		</table>
		<div id="style" {if empty($category['nid'])}style="display:none;"{/if}>
			<h4>导航样式</h4>
			<table class="tb">
				<tr>
					<th>系统图标</th>
					<td>
						<div class="input-append" style="display:block; margin-top:5px;">
							<input class="span3" type="text" name="icon[icon]" id="icon" value="{$nav['css']['icon']['icon']}" placeholder=""><button class="btn" onclick="w = ajaxshow('{php echo create_url('site/icon')}', '图标列表', {width : 800});return false;">选择图标</button>
						</div>
						<span class="help-block">导航的背景图标，微擎系统提供丰富的图标ICON。</span>
					</td>
				</tr>
				<tr>
					<th><label for="">图标颜色</label></th>
					<td>
						<input type="text" class="span3" id="iconcolor" name="icon[color]" value="{$nav['css']['icon']['color']}" />
						<input class="colorpicker" target="iconcolor" value="{$nav['css']['icon']['color']}" />
						<span class="help-block">图标颜色，上传图标时此设置项无效</span>
					</td>
				</tr>
				<tr>
					<th>图标大小</th>
					<td>
						<input class="span2" type="text" name="icon[size]" id="icon" value="{if $nav['css']['icon']['size']}{$nav['css']['icon']['size']}{else}35{/if}"><span class="help-inline">PX</span>
						<span class="help-block">图标的尺寸大小，单位为像素，上传图标时此设置项无效</span>
					</td>
				</tr>
				<tr>
					<th><label for="">上传图标</label></th>
					<td>
						<div class="fileupload fileupload-new" data-provides="fileupload">
							<div class="fileupload-preview thumbnail">{if $nav['fileicon']}<img src="{$_W['attachurl']}{$nav['fileicon']}" width="50" />{/if}</div>
							<div>
								<span class="btn-file">
									<span class="btn fileupload-new">选择图片</span>
									<span class="btn fileupload-exists">更改</span>
									<input name="icon" type="file" />
								</span>
								{if $nav['fileicon']}<button type="submit" name="fileupload-delete" value="{$nav['fileicon']}" class="btn fileupload-new">删除</button>{/if}
								<a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
							</div>
						</div>
						<input type="hidden" name="icon_old" value="{$nav['fileicon']}" />
						<span class="help-block">自定义上传图标图片，“系统图标”优先于此项</span>
					</td>
				</tr>
			</table>
		</div>
		<table class="tb">
		<tr>
			<th></th>
			<td>
				<input name="submit" type="submit" value="提交" class="btn btn-primary span3">
				<input type="hidden" name="token" value="{$_W['token']}" />
			</td>
		</tr>
		</table>
	</form>
</div>
<script type="text/javascript" src="./resource/script/colorpicker/spectrum.js"></script>
<link type="text/css" rel="stylesheet" href="./resource/script/colorpicker/spectrum.css" />
<script type="text/javascript">
<!--
	$(function(){
		colorpicker();
	});
//-->
</script>
{elseif $do == 'display'}
<div class="main">
	<div class="category">
		<form action="" method="post" onsubmit="return formcheck(this)">
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th style="width:10px;"></th>
					<th style="width:60px;">显示顺序</th>
					<th>分类名称</th>
					<th>链接</th>
					<th style="width:80px;">设为栏目</th>
					<th style="width:80px;">操作</th>
				</tr>
			</thead>
			<tbody>
			{loop $category $row}
				<tr>
					<td>{if count($children[$row['id']]) > 0}<a href="javascript:;"><i class="icon-chevron-down"></i></a>{/if}</td>
					<td><input type="text" class="span1" name="displayorder[{$row['id']}]" value="{$row['displayorder']}"></td>
					<td><div class="type-parent">{$row['name']}&nbsp;&nbsp;{if empty($row['parentid'])}<a href="{php echo create_url('site/category/post', array('parentid' => $row['id']))}" title="添加子分类"><i class="icon-plus-sign-alt"></i></a>{/if}</div></td>
					<td><input type="text" class="span3" value="{php echo create_url('mobile/channel', array('name' => 'list', 'cid' => $row['id'], 'weid' => $_W['weid']))}"></td>
					<td>{php echo $row['enabled'] ? '是' : '否'}</td>
					<td><a href="{php echo create_url('site/article/post', array('pcate' => $row['id']))}" title="添加文章"><i class="icon-plus-sign"></i></a>&nbsp;&nbsp;<a href="{php echo create_url('site/category/post', array('id' => $row['id']))}" title="编辑"><i class="icon-edit"></i></a>&nbsp;&nbsp;<a href="{php echo create_url('site/category/delete', array('id' => $row['id']))}" onclick="return confirm('确认删除此分类吗？');return false;" title="删除"><i class="icon-remove-circle"></i></a></td>
				</tr>
				{loop $children[$row['id']] $row}
				<tr>
					<td></td>
					<td><input type="text" class="span1" name="displayorder[{$row['id']}]" value="{$row['displayorder']}"></td>
					<td><div class="type-child">{$row['name']}&nbsp;&nbsp;{if empty($row['parentid'])}<a href="{php echo create_url('site/category/post', array('parentid' => $row['id']))}"><i class="icon-plus-sign-alt" title="添加子分类"><i class="icon-plus-sign-alt"></i></a>{/if}</div></td>
					<td><input type="text" class="span3" value="{php echo create_url('mobile/channel', array('name' => 'list', 'cid' => $row['id'], 'weid' => $_W['weid']))}"></td>
					<td>{php echo $row['enabled'] ? '是' : '否'}</td>
					<td><a href="{php echo create_url('site/article/post', array('pcate' => $row['parentid'], 'ccate' => $row['id']))}" title="添加文章"><i class="icon-plus-sign"></i></a>&nbsp;&nbsp;<a href="{php echo create_url('site/category/post', array('id' => $row['id']))}" title="编辑"><i class="icon-edit"></i></a>&nbsp;&nbsp;<a href="{php echo create_url('site/category/delete', array('id' => $row['id']))}" onclick="return confirm('确认删除此分类吗？');return false;" title="删除"><i class="icon-remove-circle"></i></a></td>
				</tr>
				{/loop}
			{/loop}
				<tr>
					<td></td>
					<td colspan="4">
						<a href="{php echo create_url('site/category/post')}"><i class="icon-plus-sign-alt"></i> 添加新分类</a>
					</td>
				</tr>
				<tr>
					<td></td>
					<td colspan="4">
						<input name="submit" type="submit" class="btn btn-primary" value="提交">
						<input type="hidden" name="token" value="{$_W['token']}" />
					</td>
				</tr>
			</tbody>
		</table>
		</form>
	</div>
</div>
{/if}
{template 'common/footer'}