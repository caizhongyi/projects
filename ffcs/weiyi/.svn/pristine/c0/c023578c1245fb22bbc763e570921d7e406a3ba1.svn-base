{if $do == 'post'}{php $_W['breadcrumb'] = array(array('title'=>'系统管理'),array('title'=>'用户组管理 '),array('title'=>'添加用户组 '))}{/if}
{if $do == 'display'}{php $_W['breadcrumb'] = array(array('title'=>'系统管理'),array('title'=>'用户组管理 '),array('title'=>'用户组列表 '))}{/if}
{template 'common/header'}
<div class="page-header">
    <h1>
        {if $do == 'post'}<i class="icon-pencil"></i> 添加用户组{else}<i class="icon-user"></i> 用户组列表{/if}
    </h1>
</div>
{if $do != 'display'}
<ul class="nav nav-tabs" style="margin-bottom: 20px;">
	<li {if $do == 'post'}class="active"{/if}><a href="{php echo create_url('member/group/post');}">{if $id}编辑{else}添加{/if}用户组</a></li>
	<li {if $do == 'display'}class="active"{/if}><a href="{php echo create_url('member/group/display');}">用户组列表</a></li>
</ul>
{/if}
{if $do == 'post'}
<form class="form-horizontal form" action="" method="post" enctype="multipart/form-data">
<div class="main">
	<input type="hidden" name="id" value="{$id}" />
	<input type="hidden" name="templateid" value="{$template['id']}">
	
	<div class="widget-box" >
		<div id="accordion" class="accordion-style1 panel-group">
			<!-- one begin -->
			<div class="panel-heading">
				<h4 class="panel-title">
					<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
						<i class="bigger-110 icon-angle-down" data-icon-hide="icon-angle-down" data-icon-show="icon-angle-right"></i>
						基本信息
					</a>
				</h4>
			</div>
			<div class="panel-collapse in" id="collapseOne" style="height: auto;">
				<div class="panel-body" style="border:none;">
					<table class="tb" style="margin-top:-15px;">
						<tr>
							<th><label for="">名称</label></th>
							<td>
								<input type="text" class="span4" name="name" id="name" value="{$item['name']}" />
							</td>
						</tr>
						<tr>
							<th><label for="">公众号数量</label></th>
							<td>
								<input type="text" class="span4" name="maxaccount" value="{$item['maxaccount']}" />
								<span class="help-block">限制公众号的数量，为0则不限制。</span>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div class="panel-heading">
				<h4 class="panel-title">
					<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
						<i class="bigger-110 icon-angle-down" data-icon-hide="icon-angle-down" data-icon-show="icon-angle-right"></i>
						设置当前用户允许访问的模块
					</a>
				</h4>
			</div>
			<div class="panel-collapse in" id="collapseTwo" style="height: auto;">
				<div class="panel-body" style="border:none;">
				<table class="tb" style="margin-top:-15px;">
					<tr>
						<td colspan="2">
							<div class="sub-item" id="table-list">
								<div class="sub-content">
									<table class="table table-hover">
										<thead class="navbar-inner">
											<tr>
												<th style="width:40px;" class="row-first">选择</th>
												<th>模块名称</th>
												<th>模块标识</th>
												<th>功能简介</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											{loop $modules $module}
											<tr>
												<td class="row-first">{if !$module['issystem']}<input class="modules" type="checkbox" value="{$module['mid']}" name="modules[]" {if !empty($item['modules']) && in_array($module['mid'], $item['modules'])}checked{/if} />{else}<input class="modules" type="checkbox" value="{$module['mid']}" name="modules[]" disabled checked />{/if}</td>
												<td>{$module['title']}</td>
												<td>{$module['name']}</td>
												<td>{$module['ability']}</td>
												<td>{if $module['issystem']}<span class="label label-success">系统模块</span>{/if}</td>
											</tr>
											{/loop}
										</tbody>
									</table>
								</div>
							</div>
						</td>
					</tr>
				</table>
				</div>
			</div>
			<div class="panel-heading">
				<h4 class="panel-title">
					<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
						<i class="bigger-110 icon-angle-down" data-icon-hide="icon-angle-down" data-icon-show="icon-angle-right"></i>
						设置当前用户允许访问的模板
					</a>
				</h4>
			</div>
			<div class="panel-collapse in" id="collapseThree" style="height: auto;">
				<div class="panel-body" style="border:none;">
				<table class="tb" style="margin-top:-15px;">
					<tr>
						<td colspan="2">
							<div class="sub-item" id="table-list">
								<div class="sub-content">
									<table class="table table-hover">
										<thead class="navbar-inner">
											<tr>
												<th style="width:40px;" class="row-first">选择</th>
												<th>模板名称</th>
												<th>模板标识</th>
												<th>功能简介</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											{loop $templates $temp}
											<tr>
												<td class="row-first">{if $temp['name'] != 'default'}<input class="modules" type="checkbox" value="{$temp['id']}" name="templates[]" {if !empty($item['templates']) && in_array($temp['id'], $item['templates'])}checked{/if} />{else}<input class="modules" type="checkbox" value="{$temp['id']}" name="templates[]" disabled checked />{/if}</td>
												<td>{$temp['title']}</td>
												<td>{$temp['name']}</td>
												<td>{$temp['description']}</td>
												<td></td>
											</tr>
											{/loop}
										</tbody>
									</table>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<th></th>
						<td>
							<input name="token" type="hidden" value="{$_W['token']}" />
							<input type="submit" class="btn btn-primary" name="submit" value="提交" />
						</td>
					</tr>
				</table>
				</div>
			</div>
		</div>
	</div>
</div>
</form>
{elseif $do == 'display'}
<p>
    <a href="{php echo create_url('member/group/post');}" class="btn btn-sm btn-primary"><i class="icon-plus"></i> 添加用户组</a>
</p>
<form action="" method="post">
<div class="main">
	<div>
		<table class="table table-striped table-bordered table-hover">
			<thead class="navbar-inner">
				<tr>
					<th style="width:30px;">删？</th>
					<th style="width:150px;">名称</th>
					<th style="width:550px;">允许模块权限</th>
					<th>允许模板权限</th>
					<th>公众号数量</th>
					<th style="min-width:60px;">操作</th>
				</tr>
			</thead>
			<tbody>
				{loop $list $item}
				<tr>
					<td><input type="checkbox" name="delete[]" value="{$item['id']}" /></td>
					<td>{$item['name']}</td>
					<td>
					{loop $item['modules'] $module}
					<span class="label label-success">{$module['title']}</span>&nbsp;
					{/loop}
					</td>
					<td>
					{loop $item['templates'] $temp}
					<span class="label label-success">{$temp['title']}</span>&nbsp;
					{/loop}
					</td>
					<td>{if empty($item['maxaccount'])}不限{else}{$item['maxaccount']}{/if}</td>
					<td>
						<span><a class="btn btn-info btn-xs" href="{php echo create_url('member/group/post', array('id' => $item['id']))}">编辑</a></span>  &nbsp;
						<span>
							<a class="btn btn-primary btn-xs btn-priv" data-toggle="modal" data-target="#myModal2" data-id="{$item['id']}">设置权限</a>
						</span>
					</td>
				</tr>
				{/loop}
			</tbody>
		</table>
        <div>
            <input name="token" type="hidden" value="{$_W['token']}" />
            <input type="submit" class="btn btn-sm btn-primary" name="submit" value="提交" />
        </div>
	</div>
</div>
</form>
<script>
$(function(){
	$('.btn-priv').click(function(){
		var $id = $(this).attr('data-id');
		var $html = '<iframe id="iframe" src="member.php?act=group&do=priv&id='+$id+'" style="width:100%;height:500px;padding:10px 10px;" frameborder=0></iframe>';
		$('#modal-body').html($html);
	});
	$('#save-iframe').click(function(){
		$('#iframe').contents().find('[name=myform]').submit();
	});
});
</script>
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">用户组设置权限</h4>
      </div>
      <div class="modal-body" id="modal-body" style="width:100%;margin:0 auto;text-align:center;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" id="save-iframe">保存</button>
      </div>
    </div>
  </div>
</div>

{/if}
{template 'common/footer'}