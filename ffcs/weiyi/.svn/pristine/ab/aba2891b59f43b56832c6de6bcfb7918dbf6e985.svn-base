{php $_W['breadcrumb'] = array(array('title'=>'微官网 '),array('title'=>'导航管理'))}
{template 'common/header'}
{if $visiables['profile']}
<div class="page-header">
    <h1>
        <i class="icon-book"></i> 导航管理
    </h1>
</div>
{/if}

<ul class="nav nav-tabs">
    {if $visiables['home']}<li{if $do == 'display' && $position == '1'} class="active"{/if}><a href="{php echo create_url('site/nav', array('position' => 1, 'name' => $modulename));}">首页导航管理</a></li>{/if}
    {if $visiables['shortcut']}<li{if $do == 'display' && $position == '3'} class="active"{/if}><a href="{php echo create_url('site/nav', array('position' => 3, 'name' => $modulename));}">快捷导航管理</a></li>{/if}
    {if $visiables['profile']}<li{if $do == 'display' && $position == '2'} class="active"{/if}><a href="{php echo create_url('site/nav', array('position' => 2, 'name' => $modulename));}">个人中心导航管理</a></li>{/if}
    {if empty($modulename)}
    <li{if $do == 'post' && empty($id)} class="active"{/if}><a href="{php echo create_url('site/nav/post');}"><i class="icon-plus"></i> 添加导航条目</a></li>
    {if $do == 'post' && !empty($id)}<li class="active"><a href="{php echo create_url('site/nav/post', array('id' => $id));}"><i class="icon-edit"></i> 编辑导航条目</a></li>{/if}
    {/if}
</ul>

{if $do == 'post'}
<form class="form-horizontal form" action="" method="post" enctype="multipart/form-data">
<div class="main">
	<input type="hidden" name="id" value="{$id}" />
	<input type="hidden" name="templateid" value="{$template['id']}">
	<h4>微站导航</h4>
	<table class="tb">
		<!--<tr>
			<th><label for="">微站导航位置</label></th>
			<td>
				{if empty($item['position'])}
				<select name="position">
					{loop $positions $key $p}
					<option value="{$key}"{if $item['position'] == $p} selected="selected"{/if}>{$p['title']}</option>
					{/loop}
				</select>
				<span class="help-block">这个导航链接将显示在微站指定页面. 注意: 此项添加后不能修改.</span>
				{else}
				<span class="help-block">这个导航链接将显示在微站{$positions[$item['position']]['title']}页面</span>
				{/if}
			</td>
		</tr>-->
		<tr>
			<th><label for="">导航名称</label></th>
			<td>

				<input type="text" class="span5" name="title" id="name" value="{$item['name']}" />
			</td>
		</tr>
		<tr>
			<th><label for="">导航链接</label></th>
			<td>
				<input class="span5" type="text" name="url" id="url" value="{$item['url']}" />
                <button data-toggle="modal" data-target="#modal-link" class="btn btn-link link-icon" ><i class="icon-plus-sign"></i></button>
				<span class="help-block">指定这个导航的链接目标</span>

			</td>
		</tr>
		<tr>
			<th><label for="">状态</label></th>
			<td>
				<label for="status_1" class="radio inline"><input autocomplete="off" type="radio" name="status" id="status_1" value="1" {if $item['status'] == 1 || empty($item)} checked="checked"{/if} /> 显示</label>
				<label for="status_0" class="radio inline"><input autocomplete="off" type="radio" name="status" id="status_0" value="0" {if !empty($item) && $item['status'] == 0} checked="checked"{/if} /> 隐藏</label>
				<span class="help-block">设置导航菜单的显示状态</span>
			</td>
		</tr>
		<tr>
			<th><label for="">排序</label></th>
			<td>
				<input type="text" class="span2" name="displayorder" value="{$item['displayorder']}" />
				<span class="help-block">导航排序，越大越靠前</span>
			</td>
		</tr>
	</table>


    <div class="collapse-panel">
     <!--   <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#demo">
           高级
        </button>-->

        <div id="demo" class="collapse in">
            <div class="preview-container">
                <div class="mobile-preview">
                    <iframe src="{php echo create_url('site/preview')}&styleid={$_W['account']['styleid']}" frameborder="0"></iframe>
                </div>
                <div class="preview-main">
                    <h4>导航样式</h4>
                    <table class="tb">
                        <tr>
                            <th>系统图标</th>
                            <td>
                                <div class="input-append" style="display:block; margin-top:5px;">
                                    <input class="span3" type="text" name="icon[icon]" id="icon" value="{$item['css']['icon']['icon']}" placeholder=""><button class="btn btn-primary" onclick="w = ajaxshow('{php echo create_url('site/icon')}', '图标列表', {width : 800});return false;">选择图标</button>
                                </div>
                                <span class="help-block">导航的背景图标，微翼系统提供丰富的图标ICON。</span>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="">图标颜色</label></th>
                            <td>
                                <input type="text" class="span3" id="iconcolor" name="icon[color]" value="{$item['css']['icon']['color']}" />
                                <input class="colorpicker" target="iconcolor" value="{$item['css']['icon']['color']}" />
                                <span class="help-block">图标颜色，上传图标时此设置项无效</span>
                            </td>
                        </tr>
                        <tr>
                            <th>图标大小</th>
                            <td>
                                <input class="span2" type="text" name="icon[size]" id="icon" value="{if $item['css']['icon']['size']}{$item['css']['icon']['size']}{else}35{/if}"><span class="help-inline">PX</span>
                                <span class="help-block">图标的尺寸大小，单位为像素，上传图标时此设置项无效</span>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="">上传图标</label></th>
                            <td>
                                <div class="fileupload fileupload-new" data-provides="fileupload">
                                    <div class="fileupload-preview thumbnail" style="width: 200px; height: 200px;">{if $item['fileicon']}<img src="{$_W['attachurl']}{$item['fileicon']}" width="50" />{/if}</div>
                                    <div>
                                        <span class="btn btn-file btn-primary"><span class="fileupload-new">选择图片</span><span class="fileupload-exists">更改</span><input name="icon" type="file" /></span>
                                        {if $item['fileicon']}<button type="submit" name="fileupload-delete" value="{$item['fileicon']}" class="btn fileupload-new btn-danger">删除</button>{/if}
                                        <a href="#" class="btn fileupload-exists btn-danger" data-dismiss="fileupload">移除</a>
                                    </div>
                                </div>
                                <input type="hidden" name="icon_old" value="{$item['fileicon']}" />
                                <span class="help-block">自定义上传图标图片，“系统图标”优先于此项</span>
                            </td>
                        </tr>
                        <tr>
                            <th></th>
                            <td>
                                <input name="token" type="hidden" value="{$_W['token']}" />
                                <input type="submit" class="btn btn-primary" name="submit" value="提交" />
                            </td>
                        </tr>
                    </table>
                </div>
             </div>
        </div>
    </div>

</div>
</form>

<!-- Modal -->
<div class="modal fade modal-small" id="modal-link" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header modal-header-tab">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#link" data-toggle="tab">分类链接</a></li>
                    <li><a href="#custom" data-toggle="tab">自定义</a></li>
                </ul>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Tab panes -->
                <div class="tab-content">
                    <ul class="tab-pane active systemmenus" id="link">
                        {loop $systemmenus $menu}
                        <li>
                            <a href="javascript:;" class="icon-external-link">{$menu['title']}</a> &nbsp;<button type="button"  onclick="$('#url').val('{$menu['url']}');" class="btn btn-primary" data-dismiss="modal">选择</button>
                        </li>
                        {/loop}
                    </ul>
                    <div class="tab-pane" id="custom">
                        <form class="form form-default">
                            <div class="form-group">
                                <label class="form-label">自定义:</label>
                                <input type="text" class="span4" value="http://" placeholder="http://"/><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="$('#url').val($(this).prev().val())">确定</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript" src="./resource/script/colorpicker/spectrum.js"></script>
<link type="text/css" rel="stylesheet" href="./resource/script/colorpicker/spectrum.css" />
<link type="text/css" rel="stylesheet" href="./resource/script/kindeditor/themes/default/default.css" />
<script type="text/javascript">
	$(function(){
		colorpicker();
	});
</script>
{elseif $do == 'display'}
<script type="text/javascript">
$(function(){
/*	$('div.make-switch').on('switch-change', function (e, data) {
		var dat = data.el.attr('data');
		var ret = data.value;
		$.post(location.href, {dat: dat, ret: ret}, function(resp){
			if(resp == 'success') {

				window.setTimeout(function(){location.href = location.href;}, 300);
			}
		});
	});*/
});
</script>
<style>
.table td input{margin-bottom:0;}
</style>
<form action="" method="post">
<div class="main">
	<div class="stat"><br/>
		{if $position == '1'}
		<h4 class="sub-title">选择要显示在微站首页的信息 <small>这里提供了{if $mod}"{$mod['title']}"功能中{/if}能够显示在微站首页的信息, 你可以选择性的自定义或显示隐藏</small></h4>
		{/if}
        {if $position == '2'}
        <h4 class="sub-title">选择要显示在微站个人中心的信息 <small>这里提供了{if $mod}"{$mod['title']}"功能中{/if}能够显示在微站个人中心的信息, 你可以选择性的自定义或显示隐藏</small></h4>
        {/if}
		{if $position == '3'}
		<h4 class="sub-title">选择要显示在微站快捷选项的信息 <small>这里提供了{if $mod}"{$mod['title']}"功能中{/if}能够显示在微站快捷选项的信息(需要微站模板支持), 你可以选择性的自定义或显示隐藏</small></h4>
		{/if}
		<div class="preview-container">
            <div class="mobile-preview">
                <iframe src="{php echo create_url('site/preview')}&styleid={$_W['account']['styleid']}" frameborder="0"></iframe>
            </div>
            <div class="preview-main">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="navbar-inner">
                    <tr>
                        <th style="width:10%;">图标</th>
                        <th style="width:10%;">标题</th>
                        <th style="width:30%;">链接</th>
                        <th style="width:15%;">来源</th>
                        <th style="width:5%;">排序</th>
                        <th style="width:30%;">是否在微站上显示此导航?</th>
                    </tr>
                    </thead>
                    <tbody>
                    {loop $ds $item}
                    <tr>
                        <td>{if $item['css']['icon']['icon'] && empty($item['icon'])}<i class="{$item['css']['icon']['icon']} icon-2x"></i>{else}{if $item['icon']}<img src="{$_W['attachurl']}{$item['icon']}" width="30" />{/if}{/if}</td>
                        <td>{if $item['remove']}<span>{$item['title']}</span><!--<input type="text" class="span3" name="title[{$item['id']}]" value="{$item['title']}" />-->{else}{$item['title']}{/if}</td>
                        <td>
                            <span>{$item['url']}</span>
                            <!-- <input class="span5" type="text" value="{$item['url']}">-->
                        </td>
                        <td>{if $item['module']}"{$_W['modules'][$item['module']]['title']}" {/if}{$froms[$item['from']]}</td>
                        <td>{if $item['remove']}<span>{$item['displayorder']}</span><!--<input type="text" class="span1" name="displayorder[{$item['id']}]" value="{$item['displayorder']}" />-->{else}无效{/if}</td>
                        <td style="text-align:right;">
                            <a href="{php echo create_url('site/nav/post', array('id' => $item['id']));}" class="btn btn-xs btn-info edit"{if !$item['checked']} style="display:none;"{/if} title="编辑"><i class="icon-edit bigger-120"></i></a>
                            <a href="{php echo create_url('site/nav/delete', array('id' => $item['id'], 'name' => $modulename));}" class="btn btn-xs btn-danger "{if !$item['remove']} style="display:none;"{/if} title="删除"><i class="icon-trash bigger-120"></i></a>
                        <span   class="make-switch switch-small" data-on-label="是" data-off-label="否">
                            <label style="margin: 0px;">
                                <input class="ace ace-switch " type="checkbox" value="20"{if $item['checked']} checked="checked"{/if} data="{php echo base64_encode(json_encode($item));}" />
                                <span class="lbl"></span>
                            </label>
                        </span>
                        </td>
                    </tr>
                    {/loop}
                    <script type="text/javascript">
                        $('.ace-switch ').on('change',function(){
                            if($(this).prop('checked')){
                                var ret = true;
                            }else{
                                var ret = false;
                            }
                            $(this).closest('.make-switch').parent().find('.edit').toggle();
                            var dat = $(this).attr('data');
                            $.post(location.href, {dat: dat, ret: ret}, function(resp){
                                if(resp == 'success') {
                                    $('.mobile-preview iframe').contents()[0].location.reload()
                                }
                            });
                        })
                    </script>
                    </tbody>
                    <tr>
                        <td colspan="6">
                            <span class="text-danger">*</span>部分风格模板不支持图标显示，可不必设置 <br><br>
                            <!--  <input name="token" type="hidden" value="{$_W['token']}" />
                              <input type="hidden" name="do" value="saves" />
                              <input type="submit" class="btn btn-primary" name="submit" value="提交" />-->
                        </td>
                    </tr>
                </table>

            </div>
		</div>

	</div>
</div>
</form>
{/if}
{template 'common/footer'}
