{php $_W['breadcrumb'] = array(array('title'=>'微商城'),array('title'=>'商品分类'))}
{template 'common/header'}
{if $operation == 'post'}
<div class="page-header">
    <h1>
        <i class="icon-book"></i> 分类详细设置
    </h1>
</div>
<div class="main">
    <form action="" method="post" class="form-horizontal form" enctype="multipart/form-data">
        <table class="tb">
            <tr>
                <th><label for="">所属商品类型</label></th>
                <td>
                    <select name="type_id">
                        {loop $goods_types $goods_type}
                        <option value="{$goods_type['type_id']}"  {if $goods_type['type_id'] == $type_id }selected{/if}>{$goods_type['type_name']}</option>
                        {/loop}
                    </select>
                </td>
            </tr>
            <tr>
                <th><label for="">属性名称</label></th>
                <td>
                    <input type="text" name="attr_name" class="span6" value="{$attr['attr_name']}" />
                </td>
            </tr>
            <tr>
                <th><label for="">属性是否可选</label></th>
                <td>
                    <input type="radio" value="0" {if $attr['attr_input_type']=='0'}checked{/if} name="attr_type"> 唯一属性
                    <input type="radio" value="1" {if $attr['attr_input_type']=='1'|| ($attr['attr_input_type']=='3'&&$attr['attr_type']=='3')}checked{/if} name="attr_type"> 单选属性
                    <input type="radio" value="2" {if $attr['attr_input_type']=='2'}checked{/if} name="attr_type"> 复选属性
                    <br><span id="noticeAttrType" style="display:block" class="notice-span">选择"单选/复选属性"时，可以对商品该属性设置多个值，同时还能对不同属性值指定不同的价格加价，用户购买商品时需要选定具体的属性值。选择"唯一属性"时，商品的该属性值只能设置一个值，用户只能查看该值。</span>
                </td>
            </tr>
            <tr>
                <th><label for="">属性录入方式</label></th>
                <td>
                    <input type="radio"  checked="true" value="0" {if $attr['attr_type']=='0'}checked{/if} name="attr_input_type">
                    手工录入<input type="radio" value="1" {if $attr['attr_type']=='1'}checked{/if}  name="attr_input_type">
                    从下面的列表中选择（一行代表一个可选值）<input type="radio"  value="2" {if $attr['attr_type']=='2'}checked{/if} name="attr_input_type">
                    多行文本框
                </td>
            </tr>
            <tr>
                <th><label for="">可选值列表</label></th>
                <td>
                    <textarea rows="5" cols="30" name="attr_values" >{$attr['attr_values']}</textarea>
                </td>
            </tr>
            <tr>
                <th></th>
                <td>
                    <input name="attr_id" type="hidden" value="{$attr['attr_id']}" class="btn btn-sm btn-primary">
                    <input name="submit" type="submit" value="提交" class="btn btn-sm btn-primary">
                    <input type="hidden" name="token" value="{$_W['token']}" />
                </td>
            </tr>
        </table>
    </form>
</div>
<script type="text/javascript" src="./resource/script/colorpicker/spectrum.js"></script>
<link type="text/css" rel="stylesheet" href="./resource/script/colorpicker/spectrum.css" />
<script type="text/javascript">
    <!--
    $(function(){
        colorpicker();
    });
    //-->
</script>
{elseif $operation == 'display'}

<div class="page-header">
    <h1>
        <i class="icon-book"></i> 商品属性管理
    </h1>
</div>
<div class="main">
    <p>
        <a href="{php echo $this->createWebUrl('attr', array('name' => 'businesshall', 'op' => 'post','type_id'=>$type_id))}" class="btn btn-sm btn-primary"><i class="icon-pencil"></i>添加属性</a>
    </p>
    <form method="get" action="">
        <input type="hidden" value="module" name="act">
        <input type="hidden" value="display" name="op">
        <input type="hidden" value="businesshall" name="name">
        <input type="hidden" value="attr" name="do">
        <table class="table table-striped table-bordered table-hover">
            <tbody>
            <tr>
                <th style="width:100px;">商品类型</th>
                <td>
                    <select name="type_id">
                        {loop $goods_types $goods_type}
                        <option value="{$goods_type['type_id']}"  {if $goods_type['type_id'] == $type_id }selected{/if}>{$goods_type['type_name']}</option>
                        {/loop}
                    </select>
                </td>
            </tr>
            <tr class="search-submit">
                <td colspan="2"><button class="btn btn-sm btn-primary"><i class="icon-search"></i> 搜索</button></td>
            </tr>
            </tbody>
        </table>
    </form>
    <div class="category">
        <form action="" method="post" onsubmit="return formcheck(this)">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th style="width:100px;">显示顺序</th>
                    <th>属性名称</th>
                    <th>商品类型</th>
                    <th>属性值录入方式</th>
                    <th>可选值列表</th>
                    <th style="width:180px;">操作</th>
                </tr>
                </thead>
                <tbody>
                {php $input_type=array('0'=>'手工输入','1'=>'从列表中选择','2'=>'可选值列表','3'=>'单独页面配置',)}
                {loop $goods_attrs $row}
                <tr>
                    <td><input {if $row['displayorder']>=0}type="text"{else}type="hidden"{/if}  class="span1" name="displayorder[{$row['attr_id']}]" value="{$row['displayorder']}"></td>
                    <td>{$row['attr_name']}</td>
                    <td>{$goods_types_name}</td>
                    <td>{$input_type[$row['attr_input_type']]}</td>
                    <td>{php echo preg_replace("/\s+/", "、",trim($row['attr_values']))}</td>
                    <td><a {if $row['displayorder']>=0 ||$row['attr_name']=='颜色列表' }href="{php echo $this->createWebUrl('attr', array('op' => 'post', 'attr_id' => $row['attr_id'],'type_id' => $row['type_id']))}"
                            {elseif $row['attr_name']=='合约列表'} href="site.php?act=module&do=contract&name=businesshall"
                            {elseif $row['attr_name']=='号码套餐列表'} href="site.php?act=module&do=phonenum&name=businesshall"
                            {/if}
                            >编辑</a>
                        {if $row['displayorder']>=0}&nbsp;&nbsp;<a href="{php echo $this->createWebUrl('attr', array('op' => 'delete', 'attr_id' => $row['attr_id'],'type_id' => $row['type_id']))}" onclick="return confirm('确认删除此分类吗？');return false;">删除</a></td>
                        {/if}
                </tr>
                {/loop}
                <tr>
                    <td colspan="3">
                        <input name="submit" type="submit" class="btn btn-primary" value="排序">
                        <input type="hidden" name="token" value="{$_W['token']}" />
                        <input type="hidden" name="type_id" value="{$type_id}" />
                    </td>
                </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>
{/if}
{template 'common/footer'}