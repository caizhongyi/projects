{template 'mobile/header'}
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link type="text/css" rel="stylesheet" href="./source/modules/scratch/template/new.min.css" />
<link type="text/css" rel="stylesheet" href="./source/modules/scratch/template/common.css?v={TIMESTAMP}" />
<link type="text/css" rel="stylesheet" href="./source/modules/scratch/template/css/scrattchpad.css"/>
<script type="text/javascript" src="./source/modules/scratch/template/js/scratchpad.js"></script>

<div data-role="popup" id="list_winner" data-overlay-theme="c" data-theme="c" data-dismissible="false" class="ui-corner-all">
	<div data-role="header" data-theme="c">
		<span style="color:red;font-weight:600;float:right;line-height:35px;padding-right:10px;">可划动 ^</span>
		<a href="#" data-rel="back" data-icon="delete" data-iconpos="notext">关闭</a>
		<h1>中奖名单</h1>
	</div>
	<div style="height:150px;" class="scroll">
		<table class="list_table">
			<thead>
				<tr>
					<th data-priority="persist" style="width:200px; ">姓名</th>
					<th data-priority="persist" style="width:500px;">奖品</th>
				</tr>
			</thead>
			<tbody>
				{loop $otheraward $index $row}
				{if strexists($row['award'], '兑换码')}
				{php $row['award'] = explode('兑换码', $row['award'])}
				{php $row['award'] = $row['award'][0]}
				{/if}
				<tr>
					<td>{$row['realname']}</td>
					<td>{$row['award']}</td>
				</tr>
				{/loop}
			</tbody>
		</table>
	</div>
</div>
<div data-role="popup" id="my_prize" data-overlay-theme="a" data-theme="c" data-dismissible="false" class="ui-corner-all">
	<div data-role="header" data-theme="c">
		<a href="#" data-rel="back" data-icon="delete" data-iconpos="notext">关闭</a>
		<h1>我的奖品</h1>
	</div>
	<div style="height:150px;" class="scroll">
		<table class="list_table">
			<thead>
				<tr>
					<th data-priority="persist" style="width:300px;">奖品</th>
					<th data-priority="persist" style="width:400px;">描述</th>
				</tr>
			</thead>
			<tbody>
				{loop $myaward $index $row}
				<tr>
					<td>{$row['award']}</td>
					<td>{$row['description']}</td>
				</tr>
				{/loop}
			</tbody>
		</table>
	</div>
</div>
<div class="main">
	<div class="ggk">
        <div class="ggk-info">
            <h3>大奖刮出来</h3>
            <span class="ggk-title">刮奖区</span>
            <span class="scratchpad">
                <span id="result" class="scratchpad-result">谢谢参与</span>
                <!-- <span class="scratchpad-name">我要刮奖</span>-->
                <span id="scratchpad"></span>
            </span>
        </div>
    </div>
	
	<div data-role="collapsible-set">
		<div data-role="collapsible" data-collapsed="true" data-theme="a">
			<h3>游戏规则</h3>
			{$scratch['rule']}
		</div>
	</div>
	<div style="margin:30px 0;">
		<ul data-role="listview" data-inset="true" class="ui-icon-alt" data-theme="a">
			<li><a href="#list_winner" data-rel="popup" data-transition="pop">中奖名单</a></li>
			<li>{if !empty($member['mobile']) && !empty($member['realname'])}<a href="#my_prize" data-rel="popup" data-position-to="window" data-transition="pop">我的奖品</a>{else}<a href="{php echo create_url('index/module', array('do' => 'register', 'name' => 'scratch', 'id' => $id, 'weid'=>$weid , 'from_user' => $_GPC['from_user']))}">登记后领奖</a>{/if}</li>
		</ul>
	</div>
</div>
 <script type="text/javascript">
         jQuery(function($){
             $.getJSON("{php echo create_url('index/module', array('do' => 'getaward', 'name' => 'scratch', 'id' => $id, 'weid'=>$weid, 'from_user' => $_GPC['from_user']))}&r="+new Date().getTime(),function(res){
                    if(res.message.message='您已经超过当日刮刮卡次数限制'){
                        alert(res.message.message);
                        exit;
                    }
                    if(res.message.status == -1){
                        $("#result").html("谢谢参与");
                    }else{
                        $("#result").html(res.message.level);

                        /*我的奖品*/
                        for(i=0; i<res.message.myaward.length; i++) {
                            myaward += '<tr><td>'+res.message.myaward[i].award+'</td><td>'+res.message.myaward[i].description+'</td></tr>';
                        }
                        $("#my_prize tbody").html(myaward);

                        /*中奖名单*/
                        for(i=0; i<res.message.otheraward.length; i++) {
                            var award = res.message.otheraward[i].award;
                            var realname = res.message.otheraward[i].realname;
                            /*兑换码转化*/
                            if(award.indexOf("兑换码") > 0){
                                var award_arr = award.split("兑换码");
                                award = award_arr[0];
                            }
                            otheraward += '<tr><td>'+realname+'</td><td>'+award+'</td></tr>';
                        }
                        $("#list_winner tbody").html(otheraward);
                    }
             });
         });

        $('#scratchpad').wScratchPad({
            width : 150,
            height :40,
            image : '',
            color : '#999',
            scratchUp : function(){  }   // mouse up
        });

    </script>
