<?php

function site_system_menus() {
	global $_W;
	return array(
		array('title'=>'首页', 'url'=> 'mobile.php?act=channel&name=index&weid='.$_W['weid']),
		array('title'=>'个人中心', 'url'=> 'mobile.php?act=channel&name=home&weid='.$_W['weid']),
		array('title'=>'相册列表', 'url'=> 'mobile.php?act=channel&name=album&weid='.$_W['weid']),
	);
}

function site_article_search($cid, $type = '', $psize = 20, $orderby = 'id DESC') {
	global $_GPC;
	$pindex = max(1, intval($_GPC['page']));
	$result = array();
	$condition = " WHERE ";
	if(!empty($cid)) {
		$category = pdo_fetch("SELECT parentid FROM ".tablename('category')." WHERE id = '{$cid}'");
		if (!empty($category['parentid'])) {
			$condition .= "ccate = '{$cid}'";
		} else {
			$condition .= "pcate = '{$cid}'";
		}
	}
	if(!empty($cid) && !empty($type)) $condition .= " OR ";
	if (!empty($type)) {
		$type = explode(',', $type);
		foreach ($type as $item) {
			$condition .= "type LIKE '%$item,%'";
		}
	}
	$sql = "SELECT * FROM ".tablename('article'). $condition. ' ORDER BY '. $orderby;
	$result['list'] = pdo_fetchall($sql . " LIMIT " . ($pindex - 1) * $psize .',' .$psize);
	$total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('article') . $condition);
	$result['pager'] = pagination($total, $pindex, $psize);
	return $result;
}